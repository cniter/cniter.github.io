"use strict";!function(){const e=window.innerWidth<=640,d=800<window.innerWidth,a=d&&window.innerHeight<300;var t=!!(t=navigator.hardwareConcurrency)&&(window.innerWidth<=1024?4:8)<=t;let p=1;const i={cache:{},canvas:null,ctx:null,init(){this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d",{willReadFrequently:!0})},getPoints(e){if(this.cache[e])return this.cache[e];this.ctx||this.init();var t="bold 100px Arial";this.ctx.font=t;var a=this.ctx.measureText(e).width;this.canvas.width=a+20,this.canvas.height=140,this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.font=t,this.ctx.fillStyle="#ffffff",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText(e,this.canvas.width/2,this.canvas.height/2);var i=this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height).data;const s=[];var o,r;for(let t=0;t<this.canvas.height;t+=4)for(let e=0;e<this.canvas.width;e+=4)128<i[3+4*(t*this.canvas.width+e)]&&(o=(e-this.canvas.width/2)/(this.canvas.width/2),r=-((t-this.canvas.height/2)/(this.canvas.height/2)),s.push({x:-r,y:o}));return this.cache[e]=s,s}},s=["♡","☆","♤","♧","♡","☺︎","✡︎","✫"];let f,m,M=1,g=!1,o=!0,L=!1;const r=1,n=2,l=3,y=0,k={Red:"#ff0043",Green:"#14fc56",Blue:"#1e7fff",Purple:"#e60aff",Gold:"#ffbf36",White:"#ffffff"},v="_INVISIBLE_",S=2*Math.PI,x=.5*Math.PI,b=new Stage("trails-canvas"),w=new Stage("main-canvas"),h=[b,w];function c(){return fscreen.fullscreenEnabled}function u(){return!!fscreen.fullscreenElement}function C(){c()&&(u()?fscreen.exitFullscreen():fscreen.requestFullscreen(document.getElementsByClassName("canvas-container")[0]))}fscreen.addEventListener("fullscreenchange",()=>{z.setState({fullscreen:u()})});const z={_listeners:new Set,_dispatch(t){this._listeners.forEach(e=>e(this.state,t))},state:{paused:!0,soundEnabled:!1,menuOpen:!1,openHelpTopic:null,fullscreen:u(),config:{quality:String(t?l:n),shell:"Random",size:d?"3":a?"1.2":"2",autoLaunch:!0,finale:!1,skyLighting:"2",hideControls:a,longExposure:!1,scaleFactor:e?.9:a?.75:1}},setState(e){var t=this.state;this.state=Object.assign({},this.state,e),this._dispatch(t),this.persist()},subscribe(e){return this._listeners.add(e),()=>this._listeners.remove(e)},load(){var e=localStorage.getItem("cm_fireworks_data");if(e){var{schemaVersion:e,data:t}=JSON.parse(e);const i=this.state.config;switch(e){case"1.1":i.quality=t.quality,i.size=t.size,i.skyLighting=t.skyLighting;break;case"1.2":i.quality=t.quality,i.size=t.size,i.skyLighting=t.skyLighting,i.scaleFactor=t.scaleFactor;break;default:throw new Error("version switch should be exhaustive")}console.log(`Loaded config (schema version ${e})`)}else if("1"===localStorage.getItem("schemaVersion")){let e;try{var a=localStorage.getItem("configSize");e="string"==typeof a&&JSON.parse(a)}catch(e){return console.log("Recovered from error parsing saved config:"),void console.error(e)}a=parseInt(e,10);0<=a&&a<=4&&(this.state.config.size=String(a))}},persist(){var e=this.state.config;localStorage.setItem("cm_fireworks_data",JSON.stringify({schemaVersion:"1.2",data:{quality:e.quality,size:e.size,skyLighting:e.skyLighting,scaleFactor:e.scaleFactor}}))}};function T(e){var t=z.state.paused;let a;a="boolean"==typeof e?e:!t,t!==a&&z.setState({paused:a})}function E(e){"boolean"==typeof e?z.setState({soundEnabled:e}):z.setState({soundEnabled:!z.state.soundEnabled})}function F(e){"boolean"==typeof e?z.setState({menuOpen:e}):z.setState({menuOpen:!z.state.menuOpen})}function q(e){e=e||{quality:Y.quality.value,shell:Y.shellType.value,size:Y.shellSize.value,autoLaunch:Y.autoLaunch.checked,finale:Y.finaleMode.checked,skyLighting:Y.skyLighting.value,longExposure:Y.longExposure.checked,hideControls:Y.hideControls.checked,scaleFactor:parseFloat(Y.scaleFactor.value)},z.setState({config:Object.assign({},z.state.config,e)}),_()}function _(){z.state.config;M=D(),g=M===r,o=M===n,L=M===l,G()===y&&(Y.canvasContainer.style.backgroundColor="#000"),Ge.drawWidth=M===l?.75:1}a||z.load();const R=(e=z.state)=>!e.paused&&!e.menuOpen,W=(e=z.state)=>e.soundEnabled,I=(e=z.state)=>R(e)&&W(e),D=()=>+z.state.config.quality,V=()=>z.state.config.shell,O=()=>+z.state.config.size,A=()=>z.state.config.finale,G=()=>+z.state.config.skyLighting,H=()=>z.state.config.scaleFactor,P={shellType:{header:"Shell Type",body:'The type of firework that will be launched. Select "Random" for a nice assortment!'},shellSize:{header:"Shell Size",body:"The size of the fireworks. Modeled after real firework shell sizes, larger shells have bigger bursts with more stars, and sometimes more complex effects. However, larger shells also require more processing power and may cause lag."},quality:{header:"Quality",body:"Overall graphics quality. If the animation is not running smoothly, try lowering the quality. High quality greatly increases the amount of sparks rendered and may cause lag."},skyLighting:{header:"Sky Lighting",body:'Illuminates the background as fireworks explode. If the background looks too bright on your screen, try setting it to "Dim" or "None".'},scaleFactor:{header:"Scale",body:"Allows scaling the size of all fireworks, essentially moving you closer or farther away. For larger shell sizes, it can be convenient to decrease the scale a bit, especially on phones or tablets."},autoLaunch:{header:"Auto Fire",body:"Launches sequences of fireworks automatically. Sit back and enjoy the show, or disable to have full control."},finaleMode:{header:"Finale Mode",body:'Launches intense bursts of fireworks. May cause lag. Requires "Auto Fire" to be enabled.'},hideControls:{header:"Hide Controls",body:"Hides the translucent controls along the top of the screen. Useful for screenshots, or just a more seamless experience. While hidden, you can still tap the top-right corner to re-open this menu."},fullscreen:{header:"Fullscreen",body:"Toggles fullscreen mode."},longExposure:{header:"Open Shutter",body:"Experimental effect that preserves long streaks of light, similar to leaving a camera shutter open."}},B={shellTypeLabel:"shellType",shellSizeLabel:"shellSize",qualityLabel:"quality",skyLightingLabel:"skyLighting",scaleFactorLabel:"scaleFactor",autoLaunchLabel:"autoLaunch",finaleModeLabel:"finaleMode",hideControlsLabel:"hideControls",fullscreenLabel:"fullscreen",longExposureLabel:"longExposure"},Y={stageContainer:".stage-container",canvasContainer:".canvas-container",controls:".controls",menu:".menu",menuInnerWrap:".menu__inner-wrap",pauseBtn:".pause-btn",pauseBtnSVG:".pause-btn use",soundBtn:".sound-btn",soundBtnSVG:".sound-btn use",shellType:".shell-type",shellTypeLabel:".shell-type-label",shellSize:".shell-size",shellSizeLabel:".shell-size-label",quality:".quality-ui",qualityLabel:".quality-ui-label",skyLighting:".sky-lighting",skyLightingLabel:".sky-lighting-label",scaleFactor:".scaleFactor",scaleFactorLabel:".scaleFactor-label",autoLaunch:".auto-launch",autoLaunchLabel:".auto-launch-label",finaleModeFormOption:".form-option--finale-mode",finaleMode:".finale-mode",finaleModeLabel:".finale-mode-label",hideControls:".hide-controls",hideControlsLabel:".hide-controls-label",fullscreenFormOption:".form-option--fullscreen",fullscreen:".fullscreen",fullscreenLabel:".fullscreen-label",longExposure:".long-exposure",longExposureLabel:".long-exposure-label",helpModal:".help-modal",helpModalOverlay:".help-modal__overlay",helpModalHeader:".help-modal__header",helpModalBody:".help-modal__body",helpModalCloseBtn:".help-modal__close-btn"};function X(e){var t="#icon-"+(e.paused?"play":"pause"),a="#icon-sound-"+(W()?"on":"off");Y.pauseBtnSVG.setAttribute("href",t),Y.pauseBtnSVG.setAttribute("xlink:href",t),Y.soundBtnSVG.setAttribute("href",a),Y.soundBtnSVG.setAttribute("xlink:href",a),Y.controls.classList.toggle("hide",e.menuOpen||e.config.hideControls),Y.canvasContainer.classList.toggle("blur",e.menuOpen),Y.menu.classList.toggle("hide",!e.menuOpen),Y.finaleModeFormOption.style.opacity=e.config.autoLaunch?1:.32,Y.quality.value=e.config.quality,Y.shellType.value=e.config.shell,Y.shellSize.value=e.config.size,Y.autoLaunch.checked=e.config.autoLaunch,Y.finaleMode.checked=e.config.finale,Y.skyLighting.value=e.config.skyLighting,Y.hideControls.checked=e.config.hideControls,Y.fullscreen.checked=e.fullscreen,Y.longExposure.checked=e.config.longExposure,Y.scaleFactor.value=e.config.scaleFactor.toFixed(2),Y.menuInnerWrap.style.opacity=e.openHelpTopic?.12:1,Y.helpModal.classList.toggle("active",!!e.openHelpTopic),e.openHelpTopic&&({header:a,body:e}=P[e.openHelpTopic],Y.helpModalHeader.textContent=a,Y.helpModalBody.textContent=e)}Object.keys(Y).forEach(e=>{Y[e]=document.querySelector(Y[e])}),c()||Y.fullscreenFormOption.classList.add("remove"),z.subscribe(X),z.subscribe(function(e,t){(e=I(e))!==I(t)&&(e?He.resumeAll():He.pauseAll())});t=()=>q();Y.quality.addEventListener("input",t),Y.shellType.addEventListener("input",t),Y.shellSize.addEventListener("input",t),Y.autoLaunch.addEventListener("click",()=>setTimeout(q,0)),Y.finaleMode.addEventListener("click",()=>setTimeout(q,0)),Y.skyLighting.addEventListener("input",t),Y.longExposure.addEventListener("click",()=>setTimeout(q,0)),Y.hideControls.addEventListener("click",()=>setTimeout(q,0)),Y.fullscreen.addEventListener("click",()=>setTimeout(C,0)),Y.scaleFactor.addEventListener("input",()=>{q(),we()}),Object.keys(B).forEach(e=>{const t=B[e];Y[e].addEventListener("click",()=>{z.setState({openHelpTopic:t})})}),Y.helpModalCloseBtn.addEventListener("click",()=>{z.setState({openHelpTopic:null})}),Y.helpModalOverlay.addEventListener("click",()=>{z.setState({openHelpTopic:null})});const N=Object.keys(k),$=N.map(e=>k[e]),j=[...$,v];j.reduce((e,t,a)=>(e[t]=a,e),{});const J={};function U(){return $[Math.random()*$.length|0]}$.forEach(e=>{J[e]={r:parseInt(e.substr(1,2),16),g:parseInt(e.substr(3,2),16),b:parseInt(e.substr(5,2),16)}});let Q;function K(e){var t=e&&e.notSame,a=e&&e.notColor,e=e&&e.limitWhite;let i=U();if(e&&i===k.White&&Math.random()<.6&&(i=U()),t)for(;i===Q;)i=U();else if(a)for(;i===a;)i=U();return Q=i,i}function Z(){return Math.random()<.5?k.Gold:k.White}function ee(e){return e===k.White||e===k.Gold?K({notColor:e}):Z()}const te=(e=1)=>{var t=Math.random()<.25,a=Math.random()<.72,i=a?K({limitWhite:!0}):[K(),K({notSame:!0})],s=a&&Math.random()<.42,o=s&&ee(i),r=a&&(Math.random()<.2||i===k.White)?o||K({notColor:i,limitWhite:!0}):null,a=!s&&i!==k.White&&Math.random()<.42;let n=t?1.1:1.25;return g&&(n*=.8),L&&(n=1.2),{shellSize:e,spreadSize:300+100*e,starLife:900+200*e,starDensity:n,color:i,secondColor:r,glitter:t?"light":"",glitterColor:Z(),pistil:s,pistilColor:o,streamers:a}};const ae=(e=1)=>{var t=K(),a=Math.random()<.75;return{shellSize:e,ring:!0,color:t,spreadSize:300+100*e,starLife:900+200*e,starCount:2.2*S*(e+1),pistil:a,pistilColor:ee(t),glitter:a?"":"light",glitterColor:t===k.Gold?k.Gold:k.White,streamers:Math.random()<.3}};function ie(){return Math.random()<.1?"Crysanthemum":he[Math.random()*(he.length-1)+1|0]}function se(e){return a?ne()(e):le[ie()](e)}function oe(e){return le[V()](e)}const re=["Falling Leaves","Floral","Willow"];function ne(){var e="Random"===V();let t=(e?ie:V)();if(e)for(;re.includes(t);)t=ie();return le[t]}const le={Random:se,Crackle:(e=1)=>{var t=Math.random()<.75?k.Gold:K();return{shellSize:e,spreadSize:380+75*e,starDensity:g?.65:1,starLife:600+100*e,starLifeVariation:.32,glitter:"light",glitterColor:k.Gold,color:t,crackle:!0,pistil:Math.random()<.65,pistilColor:ee(t)}},Crossette:(e=1)=>{var t=K({limitWhite:!0});return{shellSize:e,spreadSize:300+100*e,starLife:750+160*e,starLifeVariation:.4,starDensity:.85,color:t,crossette:!0,pistil:Math.random()<.5,pistilColor:ee(t)}},Crysanthemum:te,"Falling Leaves":(e=1)=>({shellSize:e,color:v,spreadSize:300+120*e,starDensity:.12,starLife:500+50*e,starLifeVariation:.5,glitter:"medium",glitterColor:k.Gold,fallingLeaves:!0}),Floral:(e=1)=>({shellSize:e,spreadSize:300+120*e,starDensity:.12,starLife:500+50*e,starLifeVariation:.5,color:Math.random()<.65?"random":Math.random()<.15?K():[K(),K({notSame:!0})],floral:!0}),Ghost:(e=1)=>{const t=te(e);t.starLife*=1.5;e=K({notColor:k.White});t.streamers=!0;Math.random()<.42&&ee(e);return t.color=v,t.secondColor=e,t.glitter="",t},"Horse Tail":(e=1)=>{var t=K();return{shellSize:e,horsetail:!0,color:t,spreadSize:250+38*e,starDensity:.9,starLife:2500+300*e,glitter:"medium",glitterColor:Math.random()<.5?Z():t,strobe:t===k.White}},Palm:(e=1)=>{var t=K(),a=Math.random()<.5;return{shellSize:e,color:t,spreadSize:250+75*e,starDensity:a?.15:.4,starLife:1800+200*e,glitter:a?"thick":"heavy"}},Ring:ae,Strobe:(e=1)=>{var t=K({limitWhite:!0});return{shellSize:e,spreadSize:280+92*e,starLife:1100+200*e,starLifeVariation:.4,starDensity:1.1,color:t,glitter:"light",glitterColor:k.White,strobe:!0,strobeColor:Math.random()<.5?k.White:null,pistil:Math.random()<.5,pistilColor:ee(t)}},Willow:(e=1)=>({shellSize:e,spreadSize:300+100*e,starDensity:.6,starLife:3e3+300*e,glitter:"willow",glitterColor:k.Gold,color:v}),Text:(e=1)=>{var t=s[Math.floor(Math.random()*s.length)],t=i.getPoints(t);return{shellSize:e,spreadSize:250+60*e,starDensity:1,starLife:1800+200*e,starLifeVariation:.2,color:K(),glitter:"medium",glitterColor:k.White,text:!0,textPoints:t}}},he=Object.keys(le);function ce(){function e(e,t){e.innerHTML=t.reduce((e,t)=>e+=`<option value="${t.value}">${t.label}</option>`,"")}document.querySelector(".loading-init").remove(),Y.stageContainer.classList.remove("remove");let a="";he.forEach(e=>a+=`<option value="${e}">${e}</option>`),Y.shellType.innerHTML=a,a="",['3"','4"','6"','8"','12"','16"'].forEach((e,t)=>a+=`<option value="${t}">${e}</option>`),Y.shellSize.innerHTML=a,e(Y.quality,[{label:"Low",value:r},{label:"Normal",value:n},{label:"High",value:l}]),e(Y.skyLighting,[{label:"None",value:y},{label:"Dim",value:1},{label:"Normal",value:2}]),e(Y.scaleFactor,[.5,.62,.75,.9,1,1.5,2].map(e=>({value:e.toFixed(2),label:100*e+"%"}))),T(!1),X(z.state),_()}function de(e){return.64*e+.18}function ue(){var e=O(),t=Math.min(2.5,e),a=Math.random()*t,e=e-a,a=0===t?Math.random():1-a/t,t=Math.random()*(1-.65*a)*.5;return{size:e,x:de(Math.random()<.5?.5-t:.5+t),height:.75*a}}function pe(e){const t=new De(oe(O()));var a=w.width,i=w.height;t.launch(e?e.x/a:de(Math.random()),e?1-e.y/i:.75*Math.random())}function fe(){var e=ue();const t=new De(oe(e.size));t.launch(e.x,e.height);let a=t.starLife;return t.fallingLeaves&&(a=4600),900+600*Math.random()+a}function me(){var e=ue();const t=ue(),a=new De(oe(e.size)),i=new De(oe(t.size));var s=.2*Math.random()-.1;const o=.2*Math.random()-.1;a.launch(.3+s,e.height),setTimeout(()=>{i.launch(.7+o,t.height)},100);let r=Math.max(a.starLife,i.starLife);return(a.fallingLeaves||i.fallingLeaves)&&(r=4600),900+600*Math.random()+r}function ge(){const a=ne();var e=O();const i=Math.max(0,e-1.25);var t=.08*Math.random()-.04;const s=new De(a(e));s.launch(.5+t,.7);e=1e3+400*Math.random(),t=1e3+400*Math.random();return setTimeout(()=>{var e=.08*Math.random()-.04;const t=new De(a(i));t.launch(.2+e,.1)},e),setTimeout(()=>{var e=.08*Math.random()-.04;const t=new De(a(i));t.launch(.8+e,.1)},t),4e3}function ye(){var e=d?7:4;const s=O(),o=Math.max(0,s-3),r=Math.random()<.78?te:ae,n=se;function t(e,t){let a="Random"===V()?t?n:r:le[V()];const i=new De(a(t?s:o));i.launch(e,t?.75:.42*(e<=.5?e/.5:(1-e)/.5))}let a=0,i=0;for(;a<=e;){if(a===e)setTimeout(()=>{t(.5,!0)},i);else{const h=a/e*.5;var l=30*Math.random()+30;setTimeout(()=>{t(h,!1)},i),setTimeout(()=>{t(1-h,!1)},i+l)}a++,i+=200}return 3400+250*e}function ve(){ve.lastCalled=Date.now();var e=d?11:5,t=d?3:1;const s=Math.max(0,O()-2),o=Math.random()<.78?te:ae,r=ne();function a(e,t){let a="Random"===V()?t?r:o:le[V()];const i=new De(a(s));t=(Math.cos(5*e*Math.PI+x)+1)/2;i.launch(e,.75*t)}let i=0,n=0;for(;i<e;){if(0===i)a(.5,!1),i+=1;else{const h=(i+1)/e/2;var l=30*Math.random()+30;const c=i===t;setTimeout(()=>{a(.5+h,c)},n),setTimeout(()=>{a(.5-h,c)},n+l),i+=2}n+=200}return 3400+120*e}ve.cooldown=15e3,ve.lastCalled=Date.now();let be=!0;const Me=32;let Le=0;function ke(){if(be){if(be=!1,a)return me();{const t=new De(te(O()));return t.launch(.5,.5),2400}}if(A())return function(){const e=ne();var t=ue();const a=new De(e(t.size));a.launch(t.x,t.height),t=a.starLife,Math.random()}(),Le<Me?(Le++,170):(Le=0,6e3);var e=Math.random();return e<.08&&Date.now()-ve.lastCalled>ve.cooldown?ve():e<.1?ye():e<.6&&!a?fe():e<.8?me():e<1?ge():void 0}let Se=0,xe=!1;function we(){var e=window.innerWidth,t=window.innerHeight;const a=Math.min(e,7680),i=e<=420?t:Math.min(t,4320);Y.stageContainer.style.width=a+"px",Y.stageContainer.style.height=i+"px",h.forEach(e=>e.resize(a,i));t=H();f=a/t,m=i/t}w.addEventListener("pointerstart",function(e){if(Se++,e.y<50){if(e.x<50)return void T();if(e.x>w.width/2-25&&e.x<w.width/2+25)return void E();if(e.x>w.width-50)return void F()}R()&&(Ee(e)?xe=!0:e.onCanvas&&pe(e))}),w.addEventListener("pointerend",function(e){Se--,xe=!1}),w.addEventListener("pointermove",function(e){R()&&xe&&Ee(e)}),window.addEventListener("keydown",function(e){80===e.keyCode?T():79===e.keyCode?F():27===e.keyCode?F(!1):121===e.keyCode&&(e.preventDefault(),e=u(),C(),e?W()&&E(!1):W()||(E(!0),He.resumeAll()))}),we(),window.addEventListener("resize",we);let Ce=0,ze=0,Te=0;function Ee(e){if(xe||e.y>=w.height-44){e=(e.x-16)/(w.width-32);return p=Math.min(Math.max(e,0),1),ze=1}}const Fe={r:0,g:0,b:0},qe={r:0,g:0,b:0};function _e(t,e,a,i,s){var o=e/a,r=t+e-.5*o;if(t<r)for(let e=t;e<r;e+=o)s(e+Math.random()*o*i);else for(let e=t;e>r;e+=o)s(e+Math.random()*o*i)}function Re(e,t,a=0,i=S){var s=2*(.5*Math.sqrt(e/Math.PI))*Math.PI,o=s/2;for(let e=0;e<=o;e++){var r=e/o*x,n=Math.cos(r),r=s*n,l=r*(i/S),h=S/r,c=Math.random()*h+a,d=.33*h;for(let e=0;e<l;e++){var u=Math.random()*d;t(h*e+c+u,n)}}}function We(a){Re(12+6*M,(e,t)=>{Ae.add(a.x,a.y,a.color,e,2.4*t,1e3+300*Math.random(),a.speedX,a.speedY)}),Ve.add(a.x,a.y,46),He.playSound("burstSmall")}function Ie(i){Re(7,(e,t)=>{const a=Ae.add(i.x,i.y,v,e,2.4*t,2400+600*Math.random(),i.speedX,i.speedY);a.sparkColor=k.Gold,a.sparkFreq=144/M,a.sparkSpeed=.28,a.sparkLife=750,a.sparkLifeVariation=3.2}),Ve.add(i.x,i.y,46),He.playSound("burstSmall")}w.addEventListener("ticker",function(e,t){if(R()){f,m;const n=e*p,l=p*t;e=n,t=t,Ce++,xe||(ze-=t/30,ze<0&&(ze=0)),z.state.config.autoLaunch&&(Te-=e,Te<=0&&(Te=1.25*ke()));const h=1-(1-Ae.airDrag)*l,c=1-(1-Ae.airDragHeavy)*l,d=1-(1-Ge.airDrag)*l,u=n/1e3*.9;j.forEach(e=>{const t=Ae.active[e];for(let e=t.length-1;0<=e;e-=1){const o=t[e];if(o.updateFrame!==Ce)if(o.updateFrame=Ce,o.life-=n,o.life<=0)t.splice(e,1),Ae.returnInstance(o);else{var a=Math.pow(o.life/o.fullLife,.5),i=1-a;if(o.prevX=o.x,o.prevY=o.y,o.x+=o.speedX*l,o.y+=o.speedY*l,o.heavy?(o.speedX*=c,o.speedY*=c):(o.speedX*=h,o.speedY*=h),o.speedY+=u,o.spinRadius&&(o.spinAngle+=o.spinSpeed*l,o.x+=Math.sin(o.spinAngle)*o.spinRadius*l,o.y+=Math.cos(o.spinAngle)*o.spinRadius*l),o.sparkFreq)for(o.sparkTimer-=n;o.sparkTimer<0;)o.sparkTimer+=.75*o.sparkFreq+o.sparkFreq*i*4,Ge.add(o.x,o.y,o.sparkColor,Math.random()*S,Math.random()*o.sparkSpeed*a,.8*o.sparkLife+Math.random()*o.sparkLifeVariation*o.sparkLife);o.life<o.transitionTime&&(o.secondColor&&!o.colorChanged&&(o.colorChanged=!0,o.color=o.secondColor,t.splice(e,1),Ae.active[o.secondColor].push(o),o.secondColor===v&&(o.sparkFreq=0)),o.strobe&&(o.visible=Math.floor(o.life/o.strobeFreq)%3==0))}}const s=Ge.active[e];for(let e=s.length-1;0<=e;e-=1){const r=s[e];r.life-=n,r.life<=0?(s.splice(e,1),Ge.returnInstance(r)):(r.prevX=r.x,r.prevY=r.y,r.x+=r.speedX*l,r.y+=r.speedY*l,r.speedX*=d,r.speedY*=d,r.speedY+=u)}}),function(e){const t=w["dpr"],a=f,i=m,s=b.ctx,o=w.ctx;G()!==y&&function(e){var t=15*G();let a=0;qe.r=0,qe.g=0,qe.b=0,$.forEach(e=>{var t=J[e],e=Ae.active[e].length;a+=e,qe.r+=t.r*e,qe.g+=t.g*e,qe.b+=t.b*e});var i=Math.pow(Math.min(1,a/500),.3),s=Math.max(1,qe.r,qe.g,qe.b);qe.r=qe.r/s*t*i,qe.g=qe.g/s*t*i,qe.b=qe.b/s*t*i;Fe.r+=(qe.r-Fe.r)/10*e,Fe.g+=(qe.g-Fe.g)/10*e,Fe.b+=(qe.b-Fe.b)/10*e,Y.canvasContainer.style.backgroundColor=`rgb(${0|Fe.r}, ${0|Fe.g}, ${0|Fe.b})`}(e);var r=H();s.scale(t*r,t*r),o.scale(t*r,t*r),s.globalCompositeOperation="source-over",s.fillStyle=`rgba(0, 0, 0, ${z.state.config.longExposure?.0025:.175*e})`,s.fillRect(0,0,a,i),o.clearRect(0,0,a,i);for(;Ve.active.length;){var n=Ve.active.pop();const l=s.createRadialGradient(n.x,n.y,0,n.x,n.y,n.radius);l.addColorStop(.024,"rgba(255, 255, 255, 1)"),l.addColorStop(.125,"rgba(255, 160, 20, 0.2)"),l.addColorStop(.32,"rgba(255, 140, 20, 0.11)"),l.addColorStop(1,"rgba(255, 120, 20, 0)"),s.fillStyle=l,s.fillRect(n.x-n.radius,n.y-n.radius,2*n.radius,2*n.radius),Ve.returnInstance(n)}s.globalCompositeOperation="lighten",s.lineWidth=Ae.drawWidth,s.lineCap=g?"square":"round",o.strokeStyle="#fff",o.lineWidth=1,o.beginPath(),$.forEach(e=>{const t=Ae.active[e];s.strokeStyle=e,s.beginPath(),t.forEach(e=>{e.visible&&(s.moveTo(e.x,e.y),s.lineTo(e.prevX,e.prevY),o.moveTo(e.x,e.y),o.lineTo(e.x-1.6*e.speedX,e.y-1.6*e.speedY))}),s.stroke()}),o.stroke(),s.lineWidth=Ge.drawWidth,s.lineCap="butt",$.forEach(e=>{const t=Ge.active[e];s.strokeStyle=e,s.beginPath(),t.forEach(e=>{s.moveTo(e.x,e.y),s.lineTo(e.prevX,e.prevY)}),s.stroke()}),ze&&(o.globalAlpha=ze,o.fillStyle=k.Blue,o.fillRect(0,i-6,a*p,6),o.globalAlpha=1);s.setTransform(1,0,0,1,0,0),o.setTransform(1,0,0,1,0,0)}(l)}});class De{constructor(e){var t;Object.assign(this,e),this.starLifeVariation=e.starLifeVariation||.125,this.color=e.color||K(),this.glitterColor=e.glitterColor||this.color,this.starCount||(t=e.starDensity||1,e=this.spreadSize/54,this.starCount=Math.max(6,e*e*t))}launch(e,t){var a=f,i=m-.45*m,e=e*(a-120)+60,a=m,i=Math.pow(.04*(a-(i-t*(i-50))),.64);const s=this.comet=Ae.add(e,a,"string"==typeof this.color&&"random"!==this.color?this.color:k.White,Math.PI,i*(this.horsetail?1.2:1),i*(this.horsetail?100:400));s.heavy=!0,s.spinRadius=MyMath.random(.32,.85),s.sparkFreq=32/M,L&&(s.sparkFreq=8),s.sparkLife=320,s.sparkLifeVariation=3,"willow"!==this.glitter&&!this.fallingLeaves||(s.sparkFreq=20/M,s.sparkSpeed=.5,s.sparkLife=500),this.color===v&&(s.sparkColor=k.Gold),.4<Math.random()&&!this.horsetail&&(s.secondColor=v,s.transitionTime=700*Math.pow(Math.random(),1.5)+500),s.onDeath=e=>this.burst(e.x,e.y),He.playSound("lift")}burst(s,o){const r=this.spreadSize/96;let n,l,h,c,d,u=.25,a=!1;this.crossette&&(l=e=>{var t;a||(He.playSound("crackleSmall"),a=!0),t=e,_e(Math.random()*x,S,4,.5,e=>{Ae.add(t.x,t.y,t.color,e,.6*Math.random()+.75,600)})}),this.crackle&&(l=e=>{var t;a||(He.playSound("crackle"),a=!0),t=e,e=L?32:16,_e(0,S,e,1.8,e=>{Ge.add(t.x,t.y,k.Gold,e,2.4*Math.pow(Math.random(),.45),300+200*Math.random())})}),this.floral&&(l=We),this.fallingLeaves&&(l=Ie),"light"===this.glitter?(h=400,c=.3,d=300,u=2):"medium"===this.glitter?(h=200,c=.44,d=700,u=2):"heavy"===this.glitter?(h=80,c=.8,d=1400,u=2):"thick"===this.glitter?(h=16,c=L?1.65:1.5,d=1400,u=3):"streamer"===this.glitter?(h=32,c=1.05,d=620,u=2):"willow"===this.glitter&&(h=120,c=.34,d=1400,u=3.8),h/=M;var e,t,i,p=(e,t)=>{var a=this.spreadSize/1800;const i=Ae.add(s,o,n||K(),e,t*r,this.starLife+Math.random()*this.starLife*this.starLifeVariation,this.horsetail?this.comet&&this.comet.speedX:0,this.horsetail?this.comet&&this.comet.speedY:-a);this.secondColor&&(i.transitionTime=this.starLife*(.05*Math.random()+.32),i.secondColor=this.secondColor),this.strobe&&(i.transitionTime=this.starLife*(.08*Math.random()+.46),i.strobe=!0,i.strobeFreq=20*Math.random()+40,this.strobeColor&&(i.secondColor=this.strobeColor)),i.onDeath=l,this.glitter&&(i.sparkFreq=h,i.sparkSpeed=c,i.sparkLife=d,i.sparkLifeVariation=u,i.sparkColor=this.glitterColor,i.sparkTimer=Math.random()*i.sparkFreq)};if("string"==typeof this.color){if(n="random"===this.color?null:this.color,this.text){const f=this.textPoints,m=r;return f.forEach(e=>{var t=Math.atan2(e.y,e.x),e=Math.sqrt(e.x*e.x+e.y*e.y),e=Math.max(.2,e);Math.random(),m;const a=Ae.add(s,o,n||K(),t,e*m,this.starLife+Math.random()*this.starLife*this.starLifeVariation,0,0);this.glitter&&(a.sparkFreq=h,a.sparkSpeed=c,a.sparkLife=d,a.sparkLifeVariation=u,a.sparkColor=this.glitterColor,a.sparkTimer=Math.random()*a.sparkFreq)}),Ve.add(s,o,this.spreadSize/4),void(this.comet&&(i=.3*(1-Math.min(2,O()-this.shellSize)/2)+.7,He.playSound("burst",i)))}if(this.ring){const g=Math.random()*Math.PI,y=.85*Math.pow(Math.random(),2)+.15;_e(0,S,this.starCount,0,e=>{var t=Math.sin(e)*r*y,a=Math.cos(e)*r,e=MyMath.pointDist(0,0,t,a),a=MyMath.pointAngle(0,0,t,a)+g;const i=Ae.add(s,o,n,a,e,this.starLife+Math.random()*this.starLife*this.starLifeVariation);this.glitter&&(i.sparkFreq=h,i.sparkSpeed=c,i.sparkLife=d,i.sparkLifeVariation=u,i.sparkColor=this.glitterColor,i.sparkTimer=Math.random()*i.sparkFreq)})}else Re(this.starCount,p)}else{if(!Array.isArray(this.color))throw new Error("Invalid shell color. Expected string or array of strings, but got: "+this.color);Math.random()<.5?(t=(e=Math.random()*Math.PI)+Math.PI,i=Math.PI,n=this.color[0],Re(this.starCount,p,e,i),n=this.color[1],Re(this.starCount,p,t,i)):(n=this.color[0],Re(this.starCount/2,p),n=this.color[1],Re(this.starCount/2,p))}if(this.pistil){const v=new De({spreadSize:.5*this.spreadSize,starLife:.6*this.starLife,starLifeVariation:this.starLifeVariation,starDensity:1.4,color:this.pistilColor,glitter:"light",glitterColor:this.pistilColor===k.Gold?k.Gold:k.White});v.burst(s,o)}if(this.streamers){const b=new De({spreadSize:.9*this.spreadSize,starLife:.8*this.starLife,starLifeVariation:this.starLifeVariation,starCount:Math.floor(Math.max(6,this.spreadSize/45)),color:k.White,glitter:"streamer"});b.burst(s,o)}Ve.add(s,o,this.spreadSize/4),this.comet&&(p=.3*(1-Math.min(2,O()-this.shellSize)/2)+.7,He.playSound("burst",p))}}const Ve={active:[],_pool:[],_new(){return{}},add(e,t,a){const i=this._pool.pop()||this._new();return i.x=e,i.y=t,i.radius=a,this.active.push(i),i},returnInstance(e){this._pool.push(e)}};function Oe(){const t={};return j.forEach(e=>{t[e]=[]}),t}const Ae={drawWidth:3,airDrag:.98,airDragHeavy:.992,active:Oe(),_pool:[],_new(){return{}},add(e,t,a,i,s,o,r,n){const l=this._pool.pop()||this._new();return l.visible=!0,l.heavy=!1,l.x=e,l.y=t,l.prevX=e,l.prevY=t,l.color=a,l.speedX=Math.sin(i)*s+(r||0),l.speedY=Math.cos(i)*s+(n||0),l.life=o,l.fullLife=o,l.spinAngle=Math.random()*S,l.spinSpeed=.8,l.spinRadius=0,l.sparkFreq=0,l.sparkSpeed=1,l.sparkTimer=0,l.sparkColor=a,l.sparkLife=750,l.sparkLifeVariation=.25,l.strobe=!1,this.active[a].push(l),l},returnInstance(e){e.onDeath&&e.onDeath(e),e.onDeath=null,e.secondColor=null,e.transitionTime=0,e.colorChanged=!1,this._pool.push(e)}},Ge={drawWidth:0,airDrag:.9,active:Oe(),_pool:[],_new(){return{}},add(e,t,a,i,s,o){const r=this._pool.pop()||this._new();return r.x=e,r.y=t,r.prevX=e,r.prevY=t,r.color=a,r.speedX=Math.sin(i)*s,r.speedY=Math.cos(i)*s,r.life=o,this.active[a].push(r),r},returnInstance(e){this._pool.push(e)}},He={baseURL:"https://cniter.github.io/audio/",ctx:new(window.AudioContext||window.webkitAudioContext),sources:{lift:{volume:1,playbackRateMin:.85,playbackRateMax:.95,fileNames:["lift1.mp3","lift2.mp3","lift3.mp3"]},burst:{volume:1,playbackRateMin:.8,playbackRateMax:.9,fileNames:["burst1.mp3","burst2.mp3","explosion0.mp3","explosion1.mp3","explosion2.mp3"]},burstSmall:{volume:.25,playbackRateMin:.8,playbackRateMax:1,fileNames:["burst-sm-1.mp3","burst-sm-2.mp3"]},crackle:{volume:.2,playbackRateMin:1,playbackRateMax:1,fileNames:["crackle1.mp3"]},crackleSmall:{volume:.3,playbackRateMin:1,playbackRateMax:1,fileNames:["crackle-sm-1.mp3"]}},preload(){const s=[];function o(e){if(200<=e.status&&e.status<300)return e;const t=new Error(e.statusText);throw t.response=e,t}const e=Object.keys(this.sources);return e.forEach(e=>{const t=this.sources[e],a=t["fileNames"],i=[];a.forEach(e=>{e=this.baseURL+e,e=fetch(e).then(o).then(e=>e.arrayBuffer()).then(t=>new Promise(e=>{this.ctx.decodeAudioData(t,e)}));i.push(e),s.push(e)}),Promise.all(i).then(e=>{t.buffers=e})}),Promise.all(s)},pauseAll(){this.ctx.suspend()},resumeAll(){this.playSound("lift",0),setTimeout(()=>{this.ctx.resume()},250)},_lastSmallBurstTime:0,playSound(e,t=1){if(t=MyMath.clamp(t,0,1),I()&&!(p<.95)){if("burstSmall"===e){var a=Date.now();if(a-this._lastSmallBurstTime<20)return;this._lastSmallBurstTime=a}a=this.sources[e];if(!a)throw new Error(`Sound of type "${e}" doesn't exist.`);e=a.volume*t,t=MyMath.random(a.playbackRateMin,a.playbackRateMax)*(2-t);const i=this.ctx.createGain();i.gain.value=e;a=MyMath.randomChoice(a.buffers);const s=this.ctx.createBufferSource();s.playbackRate.value=t,s.buffer=a,s.connect(i),i.connect(this.ctx.destination),s.start(0)}}};a?ce():(document.querySelector(".loading-init__status").textContent="Lighting Fuses",setTimeout(()=>{He.preload().then(ce,e=>(ce(),Promise.reject(e)))},0))}();