import*as PIXI from"https://cdn.jsdelivr.net/npm/pixi.js@8.16.0/dist/pixi.min.mjs";const ANIM_CONFIG={walk:{type:"floor",loop:!0,step:{vx:4,vy:0,g:0,fx:0,fy:0}},walkslow:{type:"floor",loop:!0,step:{vx:1,vy:0,g:0,fx:0,fy:0}},run:{type:"floor",loop:!0,step:{vx:10,vy:0,g:0,fx:0,fy:0}},jog:{type:"floor",loop:!0,step:{vx:6,vy:0,g:0,fx:0,fy:0}},jogfast:{type:"floor",loop:!0,step:{vx:8,vy:0,g:0,fx:0,fy:0}},pinched:{type:"STATIC",anchor:{x:.385417,y:.302469},loop:!0},featherfall:{type:"air",loop:!0,step:{vx:0,vy:0,g:3,fx:.1,fy:.3}},flury:{type:"air",loop:!1},dash:{type:"air",loop:!1},airdash:{type:"air",loop:!1},runtoidle:{type:"floor",loop:!1},idletofacescreen:{type:"STATIC",anchor:{x:.58941,y:.41512},loop:!1},standidle:{type:"STATIC",anchor:{x:.58941,y:.41512},loop:!0},standidlerelax:{type:"STATIC",anchor:{x:.58941,y:.41512},loop:!0},yawn:{type:"STATIC",anchor:{x:.48611,y:.41667},loop:!1},standtosit:{type:"STATIC",anchor:{x:.5,y:.41667},loop:!1},sitidle:{type:"STATIC",anchor:{x:.5,y:.41667},loop:!0},sitandgreet:{type:"STATIC",anchor:{x:.5,y:.41667},loop:!1},sittosleep:{type:"STATIC",anchor:{x:.5,y:.41667},loop:!1},sleepidle:{type:"STATIC",anchor:{x:.5,y:.41667},loop:!1},awake:{type:"STATIC",anchor:{x:.5,y:.41667},loop:!1},crouch:{type:"floor",loop:!1},crouchwalk:{type:"floor",loop:!0,step:{vx:2,vy:0,g:0,fx:0,fy:0}},pushagainstwall:{type:"floor",loop:!1},grabwall:{type:"rightwall",loop:!1},climbup:{type:"rightwall",loop:!1,step:{vx:0,vy:-4,g:0,fx:0,fy:0}},climbdown:{type:"air",loop:!0,step:{vx:0,vy:16,g:0,fx:0,fy:0}},grabceiling:{type:"ceiling",loop:!0},ceilingmove:{type:"ceiling",loop:!1,step:{vx:6,vy:0,g:0,fx:0,fy:0}},jumpidle:{type:"air",loop:!1,step:{vx:0,vy:-30,g:2.4,fx:0,fy:0}},jumpidle2:{type:"air",loop:!1,step:{vx:0,vy:-30,g:2.4,fx:0,fy:0}},fallidle:{type:"air",loop:!1,step:{vx:0,vy:18,g:2.7,fx:0,fy:0}},bouncingone:{type:"floor",loop:!1},doublejump:{type:"air",loop:!1,step:{repeat:1,vx:0,vy:-27,g:2.7,fx:0,fy:0}},movingdoublejump:{type:"air",loop:!1,step:{repeat:1,vx:10,vy:-27,g:2.7,fx:0,fy:0}},fall:{type:"air",loop:!1,step:{vx:10,vy:18,g:2.7,fx:0,fy:0}},jump:{type:"air",loop:!1,step:{vx:10,vy:-26,g:2,fx:0,fy:0}},jump2:{type:"air",loop:!1,step:{vx:10,vy:-26,g:2,fx:0,fy:0}},falltorun:{type:"floor",loop:!1,step:{vx:10,vy:0,g:0,fx:0,fy:0}},fallroll:{type:"air",loop:!1},walljump1:{type:"air",loop:!1},walljump2:{type:"air",loop:!1,step:{vx:-10,vy:-26,g:2,fx:.1,fy:0}},walljumpaway1:{type:"air",loop:!1,step:{vx:10,vy:-26,g:2,fx:0,fy:0}},walljumpaway2:{type:"air",loop:!1},glidemove:{type:"air",loop:!1,step:{vx:10,vy:6,g:0,fx:0,fy:0}}},ACTION_MAP={walk:{resource:"walk",name:"走",cycleTimer:[[3,["walkslow"]],[5,["jog"]]],hitRight:[["walkLeft"],["pushagainstwall","climbup"]],tap:[["jog"],["jumpidle","fallidle"],["jumpidle2","fallidle"],["doublejump","fallidle"]]},walkslow:{resource:"walkslow",name:"慢走",cycleTimer:[[6,["walk"]]],hitRight:[["walkslowLeft"]],tap:[["walk"],["crouch","crouchwalk"]]},run:{resource:"run",name:"跑",cycleTimer:[[2,["jogfast"]],[2,["flury","run"]]],hitRight:[["runLeft"]],tap:[["dash","run"],["runtoidle","idletofacescreen","standidle","standidlerelax"],["movingdoublejump","fall"],["jump","fall"],["jump2","fall"]]},jog:{resource:"jog",name:"慢跑",cycleTimer:[[3,["jogfast"]],[4,["walk"]]],hitRight:[["jogLeft"],["pushagainstwall","climbup"]],tap:[["jogfast"],["doublejump","fallidle"]]},jogfast:{resource:"jogfast",name:"快一点的慢跑",cycleTimer:[[3,["run"]],[4,["jog"]]],hitRight:[["jogfastLeft"]],tap:[["run"],["movingdoublejump","fall"],["jump","fall"],["jump2","fall"]]},walkLeft:{resource:"walk",name:"向左走",flipX:!0,cycleTimer:[[3,["walkslowLeft"]],[5,["jogLeft"]]],hitLeft:[["walk"],["pushagainstwallLeft","climbupLeft"]],tap:[["jogLeft"],["jumpidle","fallidle"],["jumpidle2","fallidle"],["doublejump","fallidle"]]},walkslowLeft:{resource:"walkslow",name:"向左慢走",flipX:!0,cycleTimer:[[6,["walkLeft"]]],hitLeft:[["walkslow"]],tap:[["walkLeft"],["crouchLeft","crouchwalkLeft"]]},runLeft:{resource:"run",name:"向左跑",flipX:!0,cycleTimer:[[2,["jogfastLeft"]],[2,["fluryLeft","runLeft"]]],hitLeft:[["run"]],tap:[["dashLeft","runLeft"],["runtoidleLeft","idletofacescreenLeft","standidle","standidlerelax"],["movingdoublejump","fall"],["jump","fall"],["jump2","fall"]]},jogLeft:{resource:"jog",name:"向左慢跑",flipX:!0,cycleTimer:[[3,["jogfastLeft"]],[4,["walkLeft"]]],hitLeft:[["jog"],["pushagainstwallLeft","climbupLeft"]],tap:[["jogfastLeft"],["doublejump","fallidle"]]},jogfastLeft:{resource:"jogfast",name:"向左快一点的慢跑",flipX:!0,cycleTimer:[[3,["runLeft"]],[4,["jogLeft"]]],hitLeft:[["jogfast"]],tap:[["runLeft"],["movingdoublejump","fall"],["jump","fall"],["jump2","fall"]]},pinched:{resource:"pinched",name:"抓住鼠标",hitTop:[["grabceiling","ceilingmove"],["grabceilingLeft","ceilingmoveLeft"]],hitLeft:[["grabwallLeft","climbupLeft"]],hitRight:[["grabwall","climbup"]]},featherfall:{resource:"featherfall",name:"竖直羽落",hitBottom:[["walk"],["walkLeft"]]},flury:{resource:"flury",name:"跑步空翻",noclipRight:!0},fluryLeft:{resource:"flury",name:"向左跑步空翻",flipX:!0,noclipLeft:!0},dash:{resource:"dash",name:"冲刺",noclipRight:!0},dashLeft:{resource:"dash",name:"左冲刺",flipX:!0,noclipLeft:!0},dashUp:{resource:"dash",name:"上冲刺",rotate:-90,noclipTop:!0},airdash:{resource:"airdash",name:"空中冲刺"},airdashUp:{resource:"airdash",name:"空中向上冲刺",rotate:-90,noclipTop:!0},airdashUpLeft:{resource:"airdash",name:"朝左空中向上冲刺",rotate:90,flipX:!0,noclipTop:!0},runtoidle:{resource:"runtoidle",name:"跑步到站立"},runtoidleLeft:{resource:"runtoidle",name:"向左跑步到站立",flipX:!0},idletofacescreen:{resource:"idletofacescreen",name:"转向屏幕"},idletofacescreenReverse:{resource:"idletofacescreen",name:"转向里",reverse:!0},idletofacescreenLeft:{resource:"idletofacescreen",name:"左转向屏幕",flipX:!0},standidle:{resource:"standidle",name:"面向屏幕站立常态"},standidlerelax:{resource:"standidlerelax",name:"面向屏幕放松动作",tap:[["idletofacescreenReverse","yawn","standtosit","sitidle","sitandgreet","sitidle"]]},yawn:{resource:"yawn",name:"打哈欠"},standtosit:{resource:"standtosit",name:"坐下"},sitidle:{resource:"sitidle",name:"坐下时的常态",tap:[["sittosleep","sleepidle"]]},sitandgreet:{resource:"sitandgreet",name:"打招呼"},sittosleep:{resource:"sittosleep",name:"sittosleep"},sleepidle:{resource:"sleepidle",name:"sleepidle",tap:[["awake","dashLeft","jogfastLeft"]]},awake:{resource:"awake",name:"awake"},crouch:{resource:"crouch",name:"蹲伏"},crouchwalk:{resource:"crouchwalk",name:"蹲伏行走",hitRight:[["crouchwalkLeft"]],cycleTimer:[[5,["walkslow"]]]},crouchLeft:{resource:"crouch",name:"向左蹲伏",flipX:!0},crouchwalkLeft:{resource:"crouchwalk",name:"向左蹲伏行走",flipX:!0,hitLeft:[["crouchwalk"]],cycleTimer:[[5,["walkslowLeft"]]]},pushagainstwall:{resource:"pushagainstwall",name:"推墙"},grabwall:{resource:"grabwall",name:"抓墙",tap:[["walljump1","fallidle"],["walljump2","fallidle"]]},climbup:{resource:"climbup",name:"向上爬墙",cycleTimer:[[4,["grabwall","climbup"]]],hitTop:[["climbupReverse"],["grabceilingLeft","ceilingmoveLeft"],["climbdown","grabwall","climbup"]],tap:[["airdashUp","grabwall","climbup"],["climbdown","grabwall","climbup"],["walljump1","fallidle"],["walljump2","fallidle"]]},climbupReverse:{resource:"climbup",name:"爬下墙",stepY:.5,reverse:!0,cycleTimer:[[8,["grabwall","climbupReverse"]]],hitBottom:[["pushagainstwall","climbup"]],tap:[["climbdown","grabwall","climbupReverse"],["walljump1","fallidle"],["walljump2","fallidle"]]},pushagainstwallLeft:{resource:"pushagainstwall",name:"向左推墙",flipX:!0},grabwallLeft:{resource:"grabwall",name:"向左抓墙",flipX:!0,tap:[["walljumpaway1","fall"],["walljumpaway2","fall"]]},climbupLeft:{resource:"climbup",name:"向左向上爬墙",flipX:!0,cycleTimer:[[4,["grabwallLeft","climbupLeft"]]],hitTop:[["climbupLeftReverse"],["grabceiling","ceilingmove"],["climbdownLeft","grabwallLeft","climbupLeft"]],tap:[["airdashUpLeft","grabwallLeft","climbupLeft"],["climbdownLeft","grabwallLeft","climbupLeft"],["walljumpaway1","fall"],["walljumpaway2","fall"]]},climbupLeftReverse:{resource:"climbup",name:"向左爬下墙",stepY:.5,flipX:!0,reverse:!0,cycleTimer:[[8,["grabwallLeft","climbupLeftReverse"]]],hitBottom:[["pushagainstwallLeft","climbupLeft"]],tap:[["climbdownLeft","grabwallLeft","climbupLeftReverse"],["walljumpaway1","fall"],["walljumpaway2","fall"]]},climbdown:{resource:"climbdown",name:"墙上下滑",hitBottom:[["pushagainstwall","climbup"]]},climbdownLeft:{resource:"climbdown",name:"左墙上下滑",flipX:!0,hitBottom:[["pushagainstwallLeft","climbupLeft"]]},grabceiling:{resource:"grabceiling",name:"抓住屏幕顶端"},ceilingmove:{resource:"ceilingmove",name:"在屏幕顶部移动",cycleTimer:[[5,["grabceiling","ceilingmove"]],[5,["grabceiling","featherfall"]]],hitRight:[["ceilingmoveLeft"]],tap:[["grabceiling","ceilingmove"],["grabceiling","featherfall"]]},grabceilingLeft:{resource:"grabceiling",name:"向左抓住屏幕顶端",flipX:!0},ceilingmoveLeft:{resource:"ceilingmove",name:"在屏幕顶部向左移动",flipX:!0,cycleTimer:[[5,["grabceilingLeft","ceilingmoveLeft"]],[5,["grabceilingLeft","featherfall"]]],hitLeft:[["ceilingmove"]],tap:[["grabceilingLeft","ceilingmoveLeft"],["grabceilingLeft","featherfall"]]},jumpidle:{resource:"jumpidle",name:"竖直跳跃1",hitBottom:[["bouncingone","walk"]],tap:[["jumpidle","fallidle"],["jumpidle2","fallidle"]]},jumpidle2:{resource:"jumpidle2",name:"竖直跳跃2",hitBottom:[["bouncingone","walk"]],tap:[["jumpidle","fallidle"],["jumpidle2","fallidle"]]},fallidle:{resource:"fallidle",name:"竖直下落",cycleTimer:[[.2,["featherfall"]]],hitBottom:[["bouncingone","walk"]],tap:[["jumpidle","fallidle"],["jumpidle2","fallidle"]]},bouncingone:{resource:"bouncingone",name:"竖直落地"},doublejump:{resource:"doublejump",name:"二段跳"},movingdoublejump:{resource:"movingdoublejump",name:"移动二段跳"},fall:{resource:"fall",name:"斜着下落",cycleTimer:[[.2,["glidemove"]]],hitBottom:[["falltorun","run"],["fallroll","run"]]},jump:{resource:"jump",name:"跑步跳跃1",hitBottom:[["falltorun","run"],["fallroll","run"]]},jump2:{resource:"jump2",name:"跑步跳跃2",hitBottom:[["falltorun","run"],["fallroll","run"]]},falltorun:{resource:"falltorun",name:"移动落地接跑步"},fallroll:{resource:"fallroll",name:"掉落翻滚"},walljump1:{resource:"walljump1",name:"竖直跳墙1",hitBottom:[["bouncingone","walk"]]},walljump2:{resource:"walljump2",name:"竖直跳墙2",hitBottom:[["bouncingone","walk"]]},walljumpaway1:{resource:"walljumpaway1",name:"跳墙1",hitBottom:[["falltorun","run"],["fallroll","run"]]},walljumpaway2:{resource:"walljumpaway2",name:"跳墙2",hitBottom:[["falltorun","run"],["fallroll","run"]]},glidemove:{resource:"glidemove",name:"滑翔",hitBottom:[["falltorun","run"],["fallroll","run"]]}},CONFIG={colors:{select:16766720,selectFill:16766720},assets:{path:"/img/ori-assets/ori-0.json"},global:{autoWalk:!0,baseSpeed:12,spritePadding:10}};class AssetSystem{static spritesheet=null;static stepCache={};static async load(){this.spritesheet=await PIXI.Assets.load(CONFIG.assets.path),this.spritesheet.linkedSheets.forEach(e=>Object.assign(this.spritesheet.data.frames,e.data.frames)),["pinched","idletofacescreen","standidle","standidlerelax","yawn","standtosit","sitidle","sitandgreet","sittosleep","sleepidle","awake"].forEach(l=>{this.getTextures(l).forEach((e,t,i)=>{e.defaultAnchor=ANIM_CONFIG[l].anchor;t=this.getTextureOriJsonData(i,t);e.orig={type:"rectangle",x:0,y:0,width:t.sourceSize.w,height:t.sourceSize.h},e.trim={type:"rectangle",x:t.spriteSourceSize.x,y:t.spriteSourceSize.y,width:t.spriteSourceSize.w,height:t.spriteSourceSize.h}})})}static getTextures(e){return this.spritesheet.data.animations[e].map(e=>PIXI.Assets.get(e))}static getAnimNames(){return this.spritesheet?Object.keys(this.spritesheet.animations):[]}static getTextureOriJsonData(e,t){t=e[t],t=t.label||t.textureId;return this.spritesheet.data.frames[t]}static getSpriteHitArea(e,t,i=null){var l=this.getTextures(e),e=this.getTextureOriJsonData(l,t),l=e.spriteSourceSize.w,t=e.spriteSourceSize.h;return null==i&&(i=void 0!==e.anchor?e.anchor:{x:.5,y:.5}),{x:e.spriteSourceSize.x-e.sourceSize.w*i.x,y:e.spriteSourceSize.y-e.sourceSize.h*i.y,w:l,h:t}}static getAnimSteps(e){if(this.stepCache[e])return this.stepCache[e];var l=this.getTextures(e);if(!l)return[{dx:0,dy:0}];const a=[],s=ANIM_CONFIG[e];if(null!=s.step){let t=s.step.vx,i=s.step.vy;a.push({dx:t,dy:i});for(let e=1;e<l.length;e++)i+=s.step.g,t*=1-s.step.fx,i*=1-s.step.fy,s.step.repeat&&s.step.vy<0&&0<=i&&(--s.step.repeat,i=s.step.vy),a.push({dx:t,dy:i});return this.stepCache[e]=a,a}let r=0,o=0;for(let i=0;i<l.length;i++){var n=l[i],p=n.label||n.textureId,n=this.spritesheet.data.frames[p];if(n){let e,t;t=0===i?(p=l[l.length-1].label,e=this.spritesheet.data.frames[p].spriteSourceSize.x,this.spritesheet.data.frames[p].spriteSourceSize.y):(h=l[i-1].label,e=this.spritesheet.data.frames[h].spriteSourceSize.x,this.spritesheet.data.frames[h].spriteSourceSize.y);var h=n.spriteSourceSize.x-e,n=n.spriteSourceSize.y-t;0<i&&(r+=h,o+=n),a.push({dx:h,dy:n})}else a.push({dx:0,dy:0})}var t=r/(l.length-1),i=o/(l.length-1);return 50<Math.abs(a[0].dx)&&(a[0].dx=t),50<Math.abs(a[0].dy)&&(a[0].dy=i),this.stepCache[e]=a,a}}class Pet{constructor(e,t){this.currentAction="walk",this.sprite=new PIXI.AnimatedSprite(AssetSystem.getTextures(this._getAnimName())),this.sprite.eventMode="static",this.sprite.animationSpeed=CONFIG.global.baseSpeed/24,this.sprite.anchor.set(.5),e=Math.random()*(window.innerWidth-200-160)+160,t=window.innerHeight-this.sprite.height/2+CONFIG.global.spritePadding,this.sprite.x=e,this.sprite.y=t,this.selectionBorder=new PIXI.Graphics,this.selectionBorder.zIndex=100,this.selectionBorder.visible=!1,this.sprite.addChild(this.selectionBorder),this.isSelected=!1,this.isDragging=!1,this.dragOffset={x:0,y:0},this.downPoint=null,this.lastFrame=-1,this.isReverse=!1,this.isFlipX=!1,this.isFlipY=!1,this.isStop=!1,this.cycleTimer=0,this.cycleInterval=null,this.loopCount=0,this.seqPlayer=new SequencePlayer(this)}update(e){if(this.cycleTimer+=e/1e3,null!=this.cycleInterval&&this.cycleTimer>=this.cycleInterval[0])return this.cycleTimer=0,void this.onCycleTimer();e=this.sprite.currentFrame;e!==this.lastFrame&&(this.lastFrame=e,this._syncVisuals(),this.isStop||this._updatePhysics())}play(e,t=null,i=!1){if(this.currentAction!==e||!1===t){this._reset_flag(),this.currentAction=null!=e?e:this.currentAction;const a=this._getActionConfig();void 0===a.cycleTimer||2==(l=a.cycleTimer[Math.floor(Math.random()*a.cycleTimer.length)]).length&&(this.cycleInterval=l);var l,e=AssetSystem.getTextures(a.resource);e&&(void 0!==a.flipX&&(this.isFlipX=a.flipX),void 0!==a.flipY&&(this.isFlipY=a.flipY),void 0!==a.reverse&&(this.isReverse=a.reverse),void 0!==a.rotate?(l=a.rotate*Math.PI/180,this.sprite.rotation=l):this.sprite.rotation=0,this.sprite.textures=e,this.sprite.loop=null!==t?t:this._getAnimMeta().loop,(t=this._getAnimMeta().anchor)&&this.sprite.anchor.set(t.x,t.y),this.sprite.animationSpeed=Math.abs(this.sprite.animationSpeed),this.isReverse?(this.sprite.animationSpeed*=-1,this.sprite.gotoAndPlay(this.sprite.totalFrames-1)):this.sprite.gotoAndPlay(0),this.sprite.onComplete=()=>{if(this.isStop=!this.sprite.loop,!i&&a&&(a.transition||a.next)){const t=[];var e;return a.transition&&t.push(a.transition),a.next&&0<a.next.length&&(e=a.next[Math.floor(Math.random()*a.next.length)],t.push(e)),void this.playSequence(t,!1)}this.seqPlayer.onStepComplete()},this.sprite.onLoop=e=>{"featherfall"==this.currentAction&&(this.loopCount+=1)},this._syncVisuals())}}playSequence(e,t){this.seqPlayer.start(e,t)}onDown(e){return this.isDragging=!0,this.downPoint={x:e.global.x,y:e.global.y},this.dragOffset.x=e.global.x-this.sprite.x,this.dragOffset.y=e.global.y-this.sprite.y,!0}onMove(e){null!=this.downPoint&&(5<Math.abs(this.downPoint.x-e.global.x)||5<Math.abs(this.downPoint.y-e.global.y))&&this.onDrag(e)}onUp(e){"pinched"==this.currentAction&&this._checkBoundaries(),"pinched"==this.currentAction?this.play("featherfall"):null!=this.downPoint&&Math.abs(this.downPoint.x-e.global.x)<1&&Math.abs(this.downPoint.y-e.global.y)<1&&this.onTap(e),this.isDragging=!1,this.downPoint=null}onDrag(e){this.play("pinched"),this.sprite.x=e.global.x,this.sprite.y=e.global.y}onTap(e){var t=this._getActionConfig();void 0!==t.tap&&(t=t.tap[Math.floor(Math.random()*t.tap.length)],this.playSequence(t))}onCycleTimer(){this.playSequence(this.cycleInterval[1])}onHitLeft(){var e=this._getActionConfig();void 0!==e.hitLeft&&(e=e.hitLeft[Math.floor(Math.random()*e.hitLeft.length)],this.playSequence(e))}onHitRight(){var e=this._getActionConfig();void 0!==e.hitRight&&(e=e.hitRight[Math.floor(Math.random()*e.hitRight.length)],this.playSequence(e))}onHitTop(){var e=this._getActionConfig();void 0!==e.hitTop&&(e=e.hitTop[Math.floor(Math.random()*e.hitTop.length)],this.playSequence(e))}onHitBottom(){var e=this._getActionConfig();void 0!==e.hitBottom&&(e=e.hitBottom[Math.floor(Math.random()*e.hitBottom.length)],this.playSequence(e))}toggleReverse(){this.isReverse=!this.isReverse}toggleFlip(){this.isFlipX=!this.isFlipX}_getActionConfig(){return ACTION_MAP[this.currentAction]}_getAnimName(){return this._getActionConfig().resource}_getAnimMeta(){return ANIM_CONFIG[this._getAnimName()]}_reset_flag(){this.sprite.anchor.set(.5),this.lastFrame=-1,this.isReverse=!1,this.isFlipX=!1,this.isFlipY=!1,this.isStop=!1,this.cycleTimer=0,this.cycleInterval=null,this.loopCount=0}_syncVisuals(){var e=this.isDragging?1.15:1,t=this.isFlipX?-1:1,i=this.isFlipY?-1:1;this.sprite.scale.set(e*t,e*i);let l={x:-this.sprite.width/2,y:-this.sprite.height/2,w:this.sprite.width,h:this.sprite.height};"STATIC"===this._getAnimMeta().type&&(l=AssetSystem.getSpriteHitArea(this._getAnimName(),this.sprite.currentFrame,this.sprite.anchor)),0!=this.sprite.rotation&&(r=this.sprite.rotation,i=l.w*Math.abs(Math.cos(r))+l.h*Math.abs(Math.sin(r)),r=l.w*Math.abs(Math.sin(r))+l.h*Math.abs(Math.cos(r)),l={x:-i/2,y:-r/2,w:i,h:r});var a,s,r=CONFIG.global.spritePadding;this.sprite.hitArea=new PIXI.Rectangle(l.x+r,l.y+r,l.w-2*r,l.h-2*r),"floor"===this._getAnimMeta().type?(a=.5*this.sprite.hitArea.height,this.sprite.y=Application.app.screen.height-a):"rightwall"===this._getAnimMeta().type?null!=this._getActionConfig().flipX?(a=.5*this.sprite.hitArea.width,this.sprite.x=0+a):(s=.5*this.sprite.hitArea.width,this.sprite.x=Application.app.screen.width-s):"ceiling"===this._getAnimMeta().type&&(s=.5*this.sprite.hitArea.height,this.sprite.y=0+s)}_drawBorder(){const e=this.selectionBorder;e.clear();var t=this.sprite.width,i=this.sprite.height;t<=0||(e.lineStyle(3,CONFIG.colors.select),e.beginFill(CONFIG.colors.select,.1),e.drawRect(-t/2,-i/2,t,i),e.drawRect(this.sprite.hitArea.x,this.sprite.hitArea.y,this.sprite.hitArea.width,this.sprite.hitArea.height),e.endFill(),e.visible=!0)}_updatePhysics(){var t=this._getAnimMeta()||{type:"STATIC"};if(CONFIG.global.autoWalk){var a=this._getActionConfig(),s=this._getAnimName(),s=(ANIM_CONFIG[s],AssetSystem.getAnimSteps(s));let e=this.sprite.currentFrame+this.loopCount*s.length;0<this.loopCount&&(e=s.length-1);s=s[e]||{dx:0,dy:0};if("STATIC"!==t.type){let e=s.dx,t=s.dy;t*=a.stepY||1,this.isReverse&&(e=-e,t=-t),this.isFlipX&&(e=-e),this.isFlipY&&(t=-t);let i=e,l=t;0!=this.sprite.rotation&&(a=this.sprite.rotation,i=e*Math.cos(a)-t*Math.sin(a),l=e*Math.sin(a)+t*Math.cos(a)),this.sprite.x+=i,this.sprite.y+=l,this._checkBoundaries()}}}_checkBoundaries(){var e=Application.app.screen.width,t=Application.app.screen.height;const i=this.sprite;var l=.5*i.hitArea.width,a=.5*i.hitArea.width,s=.5*i.hitArea.height,r=.5*i.hitArea.height,o=this._getActionConfig();i.x-l<0&&(this.onHitLeft(i),null!=o.noclipLeft?i.x=e-a:i.x=0+l),e<i.x+a&&(this.onHitRight(i),null!=o.noclipRight?i.x=0+l:i.x=e-a),i.y-s<0&&(this.onHitTop(i),null!=o.noclipTop?i.y=t-r:i.y=0+s),t<i.y+r&&(this.onHitBottom(i),null!=o.noclipBottom?i.y=0+s:i.y=t-r)}}class SequencePlayer{constructor(e){this.owner=e,this.isActive=!1,this.queue=[],this.index=0,this.isManual=!1}start(e,t){this.isActive=!0,this.queue=e,this.index=0,this.isManual=t,this.playNext()}playNext(){var e;this.isActive&&(e=this.index>=this.queue.length-1,this.owner.play(this.queue[this.index],e,this.isManual))}onStepComplete(){this.isActive&&(this.index++,this.index>=this.queue.length?this.isActive=!1:this.playNext())}}class PetManager{static list=[];static selected=null;static add(e,t,i){const l=new Pet(e,t);l.play(),this.list.push(l),i.addChild(l.sprite),this.select(l)}static clear(){this.list.forEach(e=>e.sprite.destroy()),this.list=[],this.selected=null}static select(e){this.selected&&(this.selected.isSelected=!1,this.selected.selectionBorder.visible=!1),e?(e.isSelected=!0,this.selected=e):this.selected=null}static updateAll(t){this.list.forEach(e=>e.update(t))}static getSelected(){return this.selected}}class Application{static app;static async init(){this.app=new PIXI.Application,await this.app.init({resizeTo:window,backgroundAlpha:0,antialias:!0,autoDensity:!0,resolution:window.devicePixelRatio||1});const e=document.createElement("div");e.id="pet-container",e.style.cssText="position:fixed;top:0;left:0;height:100%;width:100%;z-index:9999;pointer-events:none;",e.appendChild(this.app.canvas),document.body.appendChild(e),await AssetSystem.load(),window.addEventListener("pointerdown",e=>{var t=this.app.canvas.getBoundingClientRect(),t={global:{x:e.clientX-t.left,y:e.clientY-t.top}};const i=this.app.renderer.events.rootBoundary.hitTest(t.global.x,t.global.y);if(i&&i instanceof PIXI.AnimatedSprite){e.stopPropagation();const l=PetManager.list.find(e=>e.sprite===i);l&&(l.onDown(t),PetManager.select(l),this.app.stage.setChildIndex(l.sprite,this.app.stage.children.length-1))}else PetManager.select(null)},!0),window.addEventListener("pointermove",e=>{const t=PetManager.getSelected();var i;t&&t.isDragging&&(e.stopPropagation(),i=this.app.canvas.getBoundingClientRect(),i={global:{x:e.clientX-i.left,y:e.clientY-i.top}},t.onMove(i))}),window.addEventListener("pointerup",e=>{const t=PetManager.getSelected();var i;t&&(e.stopPropagation(),i=this.app.canvas.getBoundingClientRect(),i={global:{x:e.clientX-i.left,y:e.clientY-i.top}},t.onUp(i))}),PetManager.add(Math.random()*(window.innerWidth-200),window.innerHeight,this.app.stage),this.app.ticker.add(e=>{PetManager.updateAll(e.deltaMS)})}}Application.init();