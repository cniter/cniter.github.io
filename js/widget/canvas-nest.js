const requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(t){return window.setTimeout(t,1e3/60)},cancelAnimationFrame=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.msCancelAnimationFrame||window.oCancelAnimationFrame||window.clearTimeout,range=t=>new Array(t).fill(0).map((t,e)=>e),canvasStyle=t=>`display:block;position:absolute;top:0;left:0;height:100%;width:100%;overflow:hidden;pointer-events:none;z-index:${t.zIndex};opacity:`+t.opacity;class CanvasNest{constructor(t,e){this.el=t,this.c={zIndex:-1,opacity:.5,color:"0,0,0",pointColor:"0,0,0",count:99,...e},this.canvas=this.newCanvas(),this.context=this.canvas.getContext("2d"),this.points=this.randomPoints(),this.current={x:null,y:null,max:2e4},this.all=this.points.concat([this.current]),this.stableAngleTolerance=Math.PI/180*2,this.roundAngle=Math.PI/180/3,this.roundPointsBuffer=[],this.currentMaxRadius=Math.sqrt(this.current.max),this.bindEvent(),this.requestFrame(this.drawCanvas)}bindEvent(){this.onresize=()=>{this.canvas.width=this.el.clientWidth,this.canvas.height=this.el.clientHeight},window.addEventListener("resize",this.onresize),this.onmousemove=t=>{this.current.x=t.clientX,this.current.y=t.clientY},window.addEventListener("mousemove",this.onmousemove),this.onmouseout=()=>{this.current.x=null,this.current.y=null},window.addEventListener("mouseout",this.onmouseout)}randomPoints=()=>range(this.c.count).map(()=>({x:Math.random()*this.canvas.width,y:Math.random()*this.canvas.height,xa:2*Math.random()-1,ya:2*Math.random()-1,max:6e3}));newCanvas(){"static"===getComputedStyle(this.el).position&&(this.el.style.position="relative");const t=document.createElement("canvas");return t.style.cssText=canvasStyle(this.c),t.width=this.el.clientWidth,t.height=this.el.clientHeight,this.el.appendChild(t),t}requestFrame(t){this.tid=requestAnimationFrame(()=>t.call(this))}drawCanvas(){const e=this.context;var n=this.canvas.width,a=this.canvas.height,i=this.current,s=this.points,o=this.all;e.clearRect(0,0,n,a);let h,r,l,m,c,d;const u=this.roundPointsBuffer;u.length=0;var x,w=s.length,v=o.length;e.fillStyle=`rgba(${this.c.pointColor})`;for(let t=0;t<w;t++){const F=s[t];for(F.x+=F.xa/3,F.y+=F.ya/3,F.xa*=F.x>n||F.x<0?-1:1,F.ya*=F.y>a||F.y<0?-1:1,e.fillRect(F.x-1.5,F.y-1.5,3,3),0==F.xa&&0==F.ya&&(F.xa=2*Math.random()-1,F.ya=2*Math.random()-1),(F.x>n+100||F.x<-100||F.y>a+100||F.y<-100)&&null!==i.x&&null!==i.y&&(F.xa=i.x-F.x,F.ya=i.y-F.y),r=t+1;r<v;r++)null!==(h=o[r]).x&&null!==h.y&&((d=(m=F.x-h.x)*m+(c=F.y-h.y)*c)<h.max&&(h===i&&d>=h.max/2&&(F.x-=.03*m,F.y-=.03*c),l=(h.max-d)/h.max,e.beginPath(),e.lineWidth=1.5*l,e.strokeStyle=`rgba(${this.c.color},${.2+l})`,e.moveTo(F.x,F.y),e.lineTo(h.x,h.y),e.stroke()),h===i&&.5*h.max<=d&&d<=.53*h.max&&(x=Math.atan2(c,m),u.push([F,x])))}var y=u.length;if(0<y){var M=2*Math.PI/y,t=this.stableAngleTolerance*(1+(y-1)/(this.c.count-1)*.36),g=[M-t,M+t];let e=!0;if(1<y)for(let t=1;t<y;t++){var p=u[t][1]-u[t-1][1];if(!(g[0]<=p&&p<=g[1]||g[0]<=p+2*Math.PI&&p+2*Math.PI<=g[1])){e=!1;break}}if(e)for(let n=0;n<y;n++){let[t,e]=u[n];e+=this.roundAngle;var A=this.currentMaxRadius*(.02*Math.random()+.7072);t.x=i.x+A*Math.cos(e),t.y=i.y+A*Math.sin(e),t.xa=0,t.ya=0}else for(let n=0;n<y;n++){let[t,e]=u[n];e=Math.min(Math.max(e,-Math.PI),Math.PI),e>=Math.PI&&(e=-Math.PI),e+=.01*(-Math.PI+M*n-e),e+=(2*Math.random()-1)*this.roundAngle,e=Math.min(Math.max(e,-Math.PI),Math.PI);var f=this.currentMaxRadius*(.02*Math.random()+.7072);t.x=i.x+f*Math.cos(e),t.y=i.y+f*Math.sin(e),t.xa=0,t.ya=0}}this.requestFrame(this.drawCanvas)}destroy(){window.removeEventListener("mousemove",this.onmousemove),window.removeEventListener("mouseout",this.onmouseout),window.removeEventListener("resize",this.onresize),cancelAnimationFrame(this.tid),this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas)}}