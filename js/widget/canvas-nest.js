const requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(t){return window.setTimeout(t,1e3/60)},cancelAnimationFrame=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.msCancelAnimationFrame||window.oCancelAnimationFrame||window.clearTimeout,range=t=>new Array(t).fill(0).map((t,n)=>n),canvasStyle=t=>`display:block;position:absolute;top:0;left:0;height:100%;width:100%;overflow:hidden;pointer-events:none;z-index:${t.zIndex};opacity:`+t.opacity;class CanvasNest{constructor(t,n){this.el=t,this.c={zIndex:-1,opacity:.5,color:"0,0,0",pointColor:"0,0,0",count:99,...n},this.canvas=this.newCanvas(),this.context=this.canvas.getContext("2d"),this.points=this.randomPoints(),this.current={x:null,y:null,max:2e4},this.all=this.points.concat([this.current]),this.stableAngleTolerance=Math.PI/180*2,this.roundAngle=Math.PI/180/3,this.bindEvent(),this.requestFrame(this.drawCanvas)}bindEvent(){window.onresize=t=>{this.canvas.width=this.el.clientWidth,this.canvas.height=this.el.clientHeight},this.onmousemove=window.onmousemove,window.onmousemove=t=>{this.current.x=t.clientX,this.current.y=t.clientY,this.onmousemove&&this.onmousemove(t)},this.onmouseout=window.onmouseout,window.onmouseout=()=>{this.current.x=null,this.current.y=null,this.onmouseout&&this.onmouseout()}}randomPoints=()=>range(this.c.count).map(()=>({x:Math.random()*this.canvas.width,y:Math.random()*this.canvas.height,xa:2*Math.random()-1,ya:2*Math.random()-1,max:6e3}));newCanvas(){"static"===getComputedStyle(this.el).position&&(this.el.style.position="relative");const t=document.createElement("canvas");return t.style.cssText=canvasStyle(this.c),t.width=this.el.clientWidth,t.height=this.el.clientHeight,this.el.appendChild(t),t}requestFrame(t){this.tid=requestAnimationFrame(()=>t.call(this))}drawCanvas(){const e=this.context,i=this.canvas.width,o=this.canvas.height,s=this.current,t=this.points,h=this.all;e.clearRect(0,0,i,o);let m,r,l,c,d,u,w=[];t.forEach((t,n)=>{for(t.x+=t.xa/3,t.y+=t.ya/3,t.xa*=t.x>i||t.x<0?-1:1,t.ya*=t.y>o||t.y<0?-1:1,e.fillStyle=`rgba(${this.c.pointColor})`,e.fillRect(t.x-1.5,t.y-1.5,3,3),0==t.xa&&0==t.ya&&(t.xa=2*Math.random()-1,t.ya=2*Math.random()-1),(t.x>i+100||t.x<-100||t.y>o+100||t.y<-100)&&null!==s.x&&null!==s.y&&(t.xa=s.x-t.x,t.ya=s.y-t.y),r=n+1;r<h.length;r++){var a;m=h[r],null!==m.x&&null!==m.y&&(c=t.x-m.x,d=t.y-m.y,u=c*c+d*d,u<m.max&&(m===s&&u>=m.max/2&&(t.x-=.03*c,t.y-=.03*d),l=(m.max-u)/m.max,e.beginPath(),e.lineWidth=1.5*l,e.strokeStyle=`rgba(${this.c.color},${.2+l})`,e.moveTo(t.x,t.y),e.lineTo(m.x,m.y),e.stroke()),m===s&&.5*m.max<=u&&u<=.53*m.max&&(a=Math.atan2(d,c),w.push([t,a])))}});const x=2*Math.PI/Math.max(w.length,1);var n=this.stableAngleTolerance*(1+(w.length-1)/(this.c.count-1)*.36);const a=[x-n,x+n];w.map((t,n)=>0<n?t[1]-w[n-1][1]:t[1]).slice(1).every(t=>[t,t+2*Math.PI].some(t=>a[0]<=t&&t<=a[1]))?w.forEach((t,n)=>{let[a,e]=t;e+=this.roundAngle;t=Math.sqrt(s.max)*(.02*Math.random()+.7072);a.x=s.x+t*Math.cos(e),a.y=s.y+t*Math.sin(e),a.xa=0,a.ya=0}):w.forEach((t,n)=>{let[a,e]=t;e=Math.min(Math.max(e,-Math.PI),Math.PI),e>=Math.PI&&(e=-Math.PI),e+=.01*(-Math.PI+x*n-e),e+=(2*Math.random()-1)*this.roundAngle,e=Math.min(Math.max(e,-Math.PI),Math.PI);n=Math.sqrt(s.max)*(.02*Math.random()+.7072);a.x=s.x+n*Math.cos(e),a.y=s.y+n*Math.sin(e),a.xa=0,a.ya=0}),this.requestFrame(this.drawCanvas)}destroy(){window.onmousemove=this.onmousemove,window.onmouseout=this.onmouseout,cancelAnimationFrame(this.tid),this.canvas.parentNode.removeChild(this.canvas)}}