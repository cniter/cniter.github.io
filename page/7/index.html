<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><title>Shaun&#39;s Space</title><meta name="description" content="Shaun之所见所学所想所得"><link rel="icon" href="/img/favicon.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha256-eSi1q2PG6J7g7ib17yAaWMcrr5GrtohYChqibrV7PBE=" crossorigin="anonymous"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/fork-awesome/1.1.5/css/fork-awesome.min.css" integrity="sha256-P64qV9gULPHiZTdrS1nM59toStkgjM0dsf5mK/UwBV4=" crossorigin="anonymous"><script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><script src="//cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha256-ZvOgfh+ptkpoa2Y4HkRY28ir89u/+VRyDE7sB7hEEcI=" crossorigin="anonymous"></script><script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha256-VsEqElsCHSGmnmHXGQzvoWjWwoznFSZc6hs7ARLRacQ=" crossorigin="anonymous"></script><script src="//cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/pace.min.js" integrity="sha256-EPrkNjGEmCWyazb3A/Epj+W7Qm2pB9vnfXw+X6LImPM=" crossorigin="anonymous"></script><script src="//cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/gitalk/1.7.2/gitalk.min.css" integrity="sha512-0hsIlRjJbiUWaKMhXXNDmjWI2qPvUlhNBLHMhqeF5jIma+bedec27N5FoT2JEeHz5TUmOGCsm1Y89EsX/P0wOg==" crossorigin="anonymous" referrerpolicy="no-referrer"><script src="//cdnjs.cloudflare.com/ajax/libs/gitalk/1.7.2/gitalk.min.js" integrity="sha512-EcTCcXV46teiNwe0VcnM5A038tcY+BaQYO4nW6Gh2i7v4/HjBVg7xx3+JBLl9WofDds//INJAiEGAtdgr8PWyA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><link rel="stylesheet" href="/css/style.css"><style>body{cursor:url(/img/cursor/normal.cur),auto}#navbar-toggler--btn,.code-copy,.copy-path,a,button{cursor:url(/img/cursor/link.cur),auto}#site-bg{position:fixed;left:0;top:0;width:100%;height:100%;z-index:-1;background-image:url(/img/site-bg/bg-0.jpg);background-repeat:no-repeat;background-size:100% 100%;opacity:.2;transition:background-image 3s}</style><script>const bdshareURL="/plugins/baidushare/"</script><script async type="text/javascript" src="/js/live2d/autoload.js"></script><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="Shaun's Space" type="application/atom+xml">
</head><body><!--[if lt IE 9]>
        <link rel="stylesheet" href="/css/ie9.css">
        <div class="alert alert-danger topframe" role="alert">
            嘿，朋友！您的浏览器已<strong>过期</strong>，不建议继续食用。
            <a target="_blank" class="alert-link" href="http://browsehappy.com">这里</a> 有些新玩意儿，何不试试？
        </div>
    <![endif]--><header id="header"><nav id="navbar" class="navbar navbar-expand-md"><div class="container"><h1 id="site-title"><a href="/" class="navbar-brand"><img src="/img/favicon.png"> <span>Shaun&#39;s Space</span></a></h1><button id="navbar-toggler--btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapsibleNavbar"><span><i class="fa fa-list-ul" aria-hidden="true"></i></span></button><div class="collapse navbar-collapse" id="collapsibleNavbar"><ul class="navbar-nav"><li class="nav-item"><a class="nav-link" href="/" title="首页" data-toggle="tooltip" data-placement="bottom"><i class="nav-icon fa fa-home"></i> 首页</a></li><li class="nav-item"><a class="nav-link" href="/archives" title="所有文章" data-toggle="tooltip" data-placement="bottom"><i class="nav-icon fa fa-archive"></i> 归档</a></li><li class="nav-item"><a class="nav-link" href="/categories" title="全部分类" data-toggle="tooltip" data-placement="bottom"><i class="nav-icon fa fa-folder"></i> 分类</a></li><li class="nav-item"><a class="nav-link" href="/tags" title="全部标签" data-toggle="tooltip" data-placement="bottom"><i class="nav-icon fa fa-tags"></i> 标签</a></li><li class="nav-item"><a class="nav-link" href="/about" title="关于本站" data-toggle="tooltip" data-placement="bottom"><i class="nav-icon fa fa-user"></i> 关于</a></li><li class="nav-item"><a class="nav-link" href="/guide" title="Treasure Guide" data-toggle="tooltip" data-placement="bottom"><i class="nav-icon fa fa-university"></i> 导航</a></li></ul></div></div></nav></header><div class="container"><div class="row"><aside id="left-col" class="col-md-1"></aside><main class="col-lg-8 col-sm-12"><div id="site-bg"></div><article id="post-解决Qt中Qlabel显示OpenCV的Mat数据图像产生扭曲现象问题" class="article div-border"><header class="article-header"><span class="article-date article-title--index"><i class="fa fa-calendar" aria-hidden="true"></i> <a href="/posts/22c3daf1.html"><time datetime="2017-09-16T08:16:08.000Z">2017-09-16</time></a></span><section class="article-title article-title--index"><a href="/posts/22c3daf1.html">解决Qt中Qlabel显示OpenCV的Mat数据图像产生扭曲现象问题</a></section><div class="article-label"><div class="article-category label"><i class="fa fa-book" aria-hidden="true"></i> <a class="color2 article-category-link" href="/categories/Problems/">Problems</a></div><div class="article-tag label"><i class="fa fa-bookmark" aria-hidden="true"></i> <a class="color4 article-tag-none-link" href="/tags/opencv/" rel="tag">opencv</a><a class="color4 article-tag-none-link" href="/tags/qt/" rel="tag">qt</a></div></div></header><section class="article-content"><div class="article-content--excerpt"><h2 id="前言">前言</h2><p>　　曾写过一个程序，需要有一个界面，但 Shaun 不想使用 MFC，因缘巧合，在网上看到 Qt，就尝试用了一下，遂有此文。Shaun 的 Qt 版本为 qt-opensource-windows-x86-msvc2013-5.6.2，看其名字就知道该版本的 Qt 可以通过 Visual Studio 2013 开发 Qt 程序（各位看官猜的没错，Shaun 并没有直接使用 Qt Creator 开发 Qt 程序，而是通过 VS 开发 Qt 程序的 \(^o^)/），一来是熟悉 VS 开发，对 Qt Creator 完全没用过；二来是已经在 VS 配好全套的开发环境了（画外音：说白了就是懒嘛 ╭(╯^╰)╮）。但是在 VS 中开发 Qt 程序还需要一些其它的配置。</p></div><div class="article-content--all"><h2 id="前言">前言</h2><p>　　曾写过一个程序，需要有一个界面，但 Shaun 不想使用 MFC，因缘巧合，在网上看到 Qt，就尝试用了一下，遂有此文。Shaun 的 Qt 版本为 qt-opensource-windows-x86-msvc2013-5.6.2，看其名字就知道该版本的 Qt 可以通过 Visual Studio 2013 开发 Qt 程序（各位看官猜的没错，Shaun 并没有直接使用 Qt Creator 开发 Qt 程序，而是通过 VS 开发 Qt 程序的 \(^o^)/），一来是熟悉 VS 开发，对 Qt Creator 完全没用过；二来是已经在 VS 配好全套的开发环境了（画外音：说白了就是懒嘛 ╭(╯^╰)╮）。但是在 VS 中开发 Qt 程序还需要一些其它的配置。</p><span id="more"></span><h2 id="准备篇">准备篇</h2><p>　　在 VS 中开发 Qt 程序首先需要安装一个 addin 外接程序，下载并安装 <a target="_blank" rel="noopener" href="http://download.qt.io/archive/vsaddin/qt-vs-addin-1.2.5.exe">qt-vs-addin-1.2.5.exe</a>（<a target="_blank" rel="noopener" href="http://download.qt.io/archive/vsaddin/" class="uri">http://download.qt.io/archive/vsaddin/</a>），（网上说该程序已不支持 VS2013 及以上版本的 VS，原因是 VS2013 及其以上版本的 VS 都不支持该种类型的插件，新版本的 VS 需要安装新型插件 <a target="_blank" rel="noopener" href="http://download.qt.io/archive/vsaddin/qt-vs-tools-msvc2013-2.1.1.vsix">qt-vs-tools-msvc2013-2.1.1.vsix</a> 或 <a target="_blank" rel="noopener" href="http://download.qt.io/archive/vsaddin/qt-vs-tools-msvc2015-2.1.1.vsix">qt-vs-tools-msvc2015-2.1.1.vsix</a>），但是经 Shaun 实测，Shaun 的 VS2013-update5 英文旗舰版通过 qt-vs-addin-1.2.5 编写 Qt 程序完全没问题，不过 VS2015 就不知道了，可能真需要安装新型插件。下载安装好相应的软件之后需要在 VS 中配置 Qt 环境，虽然不配置也能正常编译，但是会在 Qt 相关的语句下面出现红色波浪线，Shaun 轻微强迫症表示不能忍 ╭(╯^╰)╮。具体配置如下：</p><p>选中“<strong>VC++目录</strong>”，在“<strong>包含目录</strong>”中添加：</p><blockquote><p>C:\Qt\Qt5.6.2\5.6\msvc2013\include</p></blockquote><p>在“<strong>库目录</strong>”中添加：</p><blockquote><p>C:\Qt\Qt5.6.2\5.6\msvc2013\lib</p></blockquote><p>配置完成之后即可发现红色波浪线已消失。</p><h2 id="使用篇">使用篇</h2><p>　　VS 中如何开发 Qt 程序请详见参考资料，懒癌发作，不想写了 =_=（其实是因为要写的话只能贴图了，Shaun 表示不想使用图片 (╯﹏╰) ）。</p><h2 id="问题篇">问题篇</h2><p><strong>问题描述：</strong>Shaun 在用 Qt 显示 OpenCV 的 Mat 数据图像时，有时会发生扭曲现象（图像从对角线分开，两边颠倒，扭曲），有时却不会，为了撤了解决问题，查阅了相关资料，终于发现症结所在，原来是图片数据格式不符合 Qt 的图片数据格式。</p><p><strong>解决办法：</strong>正文来喽 ~\(≧▽≦)/~，就不说废话了，“Talk is cheap. Show you the code”，具体完整正确显示C++代码为：</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false" data-lang="C++"><div class="code-copy"></div><figure class="highlight hljs c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">showMatWithQtQlabel</span><span class="params">(<span class="keyword">const</span> cv::Mat &amp;img, QLabel *label)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// [Qt中用QLabel显示OpenCV中Mat图像数据出现扭曲现象的解决](http://lovelittlebean.blog.163.com/blog/static/11658218620125208212189/)</span></span><br><span class="line">	QImage q_img;  </span><br><span class="line">	<span class="keyword">if</span>(img.<span class="built_in">channels</span>() == <span class="number">3</span>)    <span class="comment">// RGB image  </span></span><br><span class="line">	&#123;  </span><br><span class="line">		q_img = <span class="built_in">QImage</span>((<span class="keyword">const</span> uchar*)(img.data), img.cols, img.rows, img.cols*img.<span class="built_in">channels</span>(), QImage::Format_RGB888).<span class="built_in">rgbSwapped</span>();  </span><br><span class="line">	&#125;<span class="keyword">else</span> <span class="keyword">if</span> (img.<span class="built_in">channels</span>() == <span class="number">4</span>)	<span class="comment">// RGBA image  </span></span><br><span class="line">	&#123;</span><br><span class="line">		q_img = <span class="built_in">QImage</span>((<span class="keyword">const</span> uchar*)(img.data), img.cols, img.rows, img.cols*img.<span class="built_in">channels</span>(), QImage::Format_RGB32);  </span><br><span class="line">	&#125;<span class="keyword">else</span>              <span class="comment">// gray image  </span></span><br><span class="line">	&#123;  </span><br><span class="line">		q_img = <span class="built_in">QImage</span>((<span class="keyword">const</span> uchar*)(img.data), img.cols, img.rows, img.cols*img.<span class="built_in">channels</span>(), QImage::Format_Indexed8);  </span><br><span class="line">	&#125;  </span><br><span class="line"></span><br><span class="line">	<span class="comment">// -------------- 图片自适应label -------------------</span></span><br><span class="line">	QImage q_label_img = q_img.<span class="built_in">scaled</span>(label-&gt;<span class="built_in">size</span>(), Qt::IgnoreAspectRatio, Qt::SmoothTransformation); <span class="comment">// 图片自适应label大小	</span></span><br><span class="line">	label-&gt;<span class="built_in">setPixmap</span>(QPixmap::<span class="built_in">fromImage</span>(q_label_img));  <span class="comment">// 将图片显示到label上 </span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// -------------- label自适应图片 -------------------</span></span><br><span class="line">	<span class="comment">/*label-&gt;setPixmap(QPixmap::fromImage(q_img));  // 显示在label中</span></span><br><span class="line"><span class="comment">	label-&gt;resize(label-&gt;pixmap()-&gt;size());  // 改变label的尺寸以自适应图像</span></span><br><span class="line"><span class="comment">	label-&gt;show();  */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>　　rgbSwapped() 函数是为了使 Qt 中显示图形颜色更自然，因为 OpenCV 的 Mat 数据 RGB 图像是以 BGR 的顺序排列，而 Qt 中是以 RGB 的顺序排列，所以需要 rgbSwapped() 交换一下颜色通道排列顺序。</p><h2 id="附录">附录</h2><h3 id="摄像头数据采集问题">1、摄像头数据采集问题</h3><p>注意：如果是从摄像头实时采集显示图像，在显示时需先判断图像有没有数据</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false" data-lang="C++"><div class="code-copy"></div><figure class="highlight hljs c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (image.data)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// 执行显示操作</span></span><br><span class="line">  <span class="built_in">showMatWithQtQlabel</span>(mat, ui.label);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 执行其它操作...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>或</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false" data-lang="C++"><div class="code-copy"></div><figure class="highlight hljs c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!image.<span class="built_in">empty</span>())</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// 执行显示操作</span></span><br><span class="line">  <span class="built_in">showMatWithQtQlabel</span>(mat, ui.label);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 执行其它操作...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>具体原因可参考 Shaun 的一篇文章 <a href="https://cniter.github.io/posts/509ee93b.html">解决OpenCV-2.4.11调用摄像头显示拍摄视频出错问题</a> 。</p><h3 id="信号与槽的连接函数问题">2、信号与槽的连接函数问题</h3><p>Qt4 中信号与槽的连接函数语法为：</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false" data-lang="C++"><div class="code-copy"></div><figure class="highlight hljs c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">connect</span>(&amp;theTimer,<span class="built_in">SIGNAL</span>(<span class="built_in">timeout</span>()),<span class="keyword">this</span>,<span class="built_in">SLOT</span>(<span class="built_in">getFrame</span>()));	<span class="comment">// 超时就去取下一帧</span></span><br></pre></td></tr></table></figure></div><p>而 Qt5 中信号与槽的连接函数新语法为：</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false" data-lang="C++"><div class="code-copy"></div><figure class="highlight hljs c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">connect</span>(&amp;theTimer, &amp;QTimer::timeout, <span class="keyword">this</span>, &amp;QtTest::getFrame);	<span class="comment">//超时就去取下一帧 </span></span><br></pre></td></tr></table></figure></div><p>推荐使用 Qt5 新语法，具体原因可参考 <a target="_blank" rel="noopener" href="http://www.cnblogs.com/mushroom/p/5701330.html">qt5中信号和槽的新语法</a> 。</p><p><strong>个人粗浅理解：</strong>信号函数一般是 Qt 中控件的库函数，比如按钮控件 QButton 的 <code>QButton::clicked ()</code> 函数，定时器 QTimer 的 <code>QTimer::timeout ()</code> 等函数；而槽函数是响应函数，一般由用户自己编写，也可以使用 Qt 中库函数。</p><p>　　使用 Qt 中可能会遇到的一些错误请参考 <a target="_blank" rel="noopener" href="http://www.cnblogs.com/csuftzzk/p/VS_Qt_Experience.html">使用VS2010开发Qt程序的一点经验</a>（<a target="_blank" rel="noopener" href="http://www.cnblogs.com/csuftzzk/category/445772.html" class="uri">http://www.cnblogs.com/csuftzzk/category/445772.html</a>）。</p><h2 id="后记">后记</h2><p>　　本来其实就想把问题篇写出来的，毕竟主要就是想记录一下那个显示函数，但是感觉有点没头没尾，就把 VS 集成 Qt 开发环境也稍微写了一下，而使用篇确实是因为参考资料已经写的很详细了，所以就直接一笔带过了。</p><h2 id="参考资料">参考资料</h2><p>[1] <a target="_blank" rel="noopener" href="http://blog.csdn.net/llh318724/article/details/7007661">QT +openCV 实现摄像头采集以及拍照功能</a>（<a target="_blank" rel="noopener" href="http://blog.csdn.net/llh318724/article/category/930663" class="uri">http://blog.csdn.net/llh318724/article/category/930663</a>）</p><p>[2] <a target="_blank" rel="noopener" href="http://blog.csdn.net/qqmindyourwill/article/details/50280233">VS2010 + QT5.2+ QT-VS-Addin1.2.2开发环境配置</a>（<a target="_blank" rel="noopener" href="http://blog.csdn.net/qqmindyourwill/article/category/5990841" class="uri">http://blog.csdn.net/qqmindyourwill/article/category/5990841</a>）</p><p>[3] <a target="_blank" rel="noopener" href="http://blog.csdn.net/fm0517/article/details/7476430">Qt+OpenCV界面</a>（<a target="_blank" rel="noopener" href="http://blog.csdn.net/fm0517/article/category/1110960" class="uri">http://blog.csdn.net/fm0517/article/category/1110960</a>）</p><p>[4] <a target="_blank" rel="noopener" href="http://blog.csdn.net/loveaborn/article/details/7680834">Qt中用QLabel显示OpenCV中Mat图像数据出现扭曲现象的解决</a>（<a target="_blank" rel="noopener" href="http://blog.csdn.net/loveaborn/article/category/1164072" class="uri">http://blog.csdn.net/loveaborn/article/category/1164072</a>）</p></div><div class="article-content-more"><button type="button" class="article-more--link"><i class="fa fa-angle-double-down fa-3x" aria-hidden="true"></i></button></div></section></article><article id="post-解决OpenCV-2-4-11调用摄像头显示拍摄视频出错问题" class="article div-border"><header class="article-header"><span class="article-date article-title--index"><i class="fa fa-calendar" aria-hidden="true"></i> <a href="/posts/509ee93b.html"><time datetime="2017-09-16T07:56:16.000Z">2017-09-16</time></a></span><section class="article-title article-title--index"><a href="/posts/509ee93b.html">解决OpenCV-2.4.11调用摄像头显示拍摄视频出错问题</a></section><div class="article-label"><div class="article-category label"><i class="fa fa-book" aria-hidden="true"></i> <a class="color5 article-category-link" href="/categories/Problems/">Problems</a></div><div class="article-tag label"><i class="fa fa-bookmark" aria-hidden="true"></i> <a class="color2 article-tag-none-link" href="/tags/opencv/" rel="tag">opencv</a></div></div></header><section class="article-content"><div class="article-content--excerpt"><p><font color="#FA8072">本文所用的 OpenCV 版本为 opencv-2.4.11，编程语言为 C++。</font></p><h2 id="前言">前言</h2><p>　　本文其实是以前在刚学 OpenCV 时遇到的一个问题，当时我的环境还是：Win7，VS2010，opencv-2.4.11。当初就记录了下来，现在再来重新梳理一下。</p></div><div class="article-content--all"><p><font color="#FA8072">本文所用的 OpenCV 版本为 opencv-2.4.11，编程语言为 C++。</font></p><h2 id="前言">前言</h2><p>　　本文其实是以前在刚学 OpenCV 时遇到的一个问题，当时我的环境还是：Win7，VS2010，opencv-2.4.11。当初就记录了下来，现在再来重新梳理一下。</p><span id="more"></span><h2 id="问题篇">问题篇</h2><p><strong>问题描述：</strong>使用 OpenCV-2.4.11 调用摄像头显示拍摄视频时报 <font color="#FA8072">runtime error</font>，控制台窗口出现 <font color="#FA8072">OpenCV Error: Assertion failed (size.width&gt;0 &amp;&amp; size.height&gt;0) in cv::imshow, file ……...cpp, line 261</font>。</p><p><strong>解决办法：</strong>在显示图片时先判断是否有图像数据，如下：</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false" data-lang="C++"><div class="code-copy"></div><figure class="highlight hljs c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!image.<span class="built_in">empty</span>()) </span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">imshow</span>(<span class="string">&quot;window&quot;</span>, image);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>或</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false" data-lang="C++"><div class="code-copy"></div><figure class="highlight hljs c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (image.data) </span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">imshow</span>(<span class="string">&quot;window&quot;</span>, image);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p><strong>原因可能是：</strong>用 imshow() 显示图像时，其 image 必须有数据，如果它为空则程序会报错，而一般打开摄像头会有一定时间的延迟，这时程序已经启动，而摄像头由于启动延迟，不一定能及时获取图像，造成要显示的 image 为空，因此报错。个人粗浅理解，板砖轻拍 ⊙﹏⊙b。</p><p>而网上有人也认为：</p><blockquote><ol type="1"><li>我也是遇到这个问题，不过看到一个帖子写得不错（英文的），里面给出了一个可能的理由，就是我们用 opencv 打开视频的时候，会自动先监测摄像头有没有读到帧，如果没有，就会报错，然后再执行你的程序，加一个if判断就是跳过系统自己的判断，直接执行我们的程序。来自：<a target="_blank" rel="noopener" href="https://zhidao.baidu.com/question/1831122325089024420.html" class="uri">https://zhidao.baidu.com/question/1831122325089024420.html</a></li><li>有人说的原因是在 VideoCapture 刚开始获取摄像头视频流的过程不返回信号，所以判断 Mat 是否为空，并不断循环去获取 Mat。来自：<a target="_blank" rel="noopener" href="http://www.cnblogs.com/tiny656/p/3538115.html" class="uri">http://www.cnblogs.com/tiny656/p/3538115.html</a></li></ol></blockquote><p>附最终完整示例程序：</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false" data-lang="C++"><div class="code-copy"></div><figure class="highlight hljs c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/core/core.hpp&gt;</span>  </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/imgproc/imgproc.hpp&gt;</span> </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/highgui/highgui.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用摄像头</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">videoCaptureTest</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//cv::VideoCapture cap(0);  // 打开默认摄像头，参数0代表默认摄像头的ID</span></span><br><span class="line">    cv::VideoCapture cap;</span><br><span class="line">    cap.<span class="built_in">open</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="comment">// 设置摄像头</span></span><br><span class="line">    cap.<span class="built_in">set</span>(CV_CAP_PROP_FRAME_WIDTH,<span class="number">640</span>);</span><br><span class="line">    cap.<span class="built_in">set</span>(CV_CAP_PROP_FRAME_HEIGHT,<span class="number">480</span>);</span><br><span class="line">    <span class="comment">// 确认是否成功打开摄像头</span></span><br><span class="line">    <span class="keyword">if</span> (!cap.<span class="built_in">isOpened</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;打开摄像头失败，退出！\n&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;Capture&quot;</span>, CV_WINDOW_AUTOSIZE|CV_WINDOW_FREERATIO);</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        cv::Mat frame;</span><br><span class="line">        cap &gt;&gt; frame;   <span class="comment">// 获取帧</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 对摄像头获取的帧进行各种处理</span></span><br><span class="line">        <span class="keyword">if</span> (!frame.<span class="built_in">empty</span>()) <span class="comment">// 最好加上该判断，并在该判断中对帧进行处理</span></span><br><span class="line">        &#123;</span><br><span class="line">            cv::<span class="built_in">imshow</span>(<span class="string">&quot;Capture&quot;</span>, frame);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(cv::<span class="built_in">waitKey</span>(<span class="number">30</span>) &gt;= <span class="number">0</span>) <span class="keyword">break</span>; <span class="comment">// 每30ms取一帧</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">videoCaptureTest</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>　　其实也可以通过在获取帧时，反复获取帧，直到取到的帧有数据为止，这样就不需要判断语句了，直接显示即可，具体代码如下：</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false" data-lang="C++"><div class="code-copy"></div><figure class="highlight hljs c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line">    cap &gt;&gt; frame;</span><br><span class="line">&#125;<span class="keyword">while</span>(frame.<span class="built_in">empty</span>());</span><br><span class="line"></span><br><span class="line">cv::<span class="built_in">imshow</span>(<span class="string">&quot;Capture&quot;</span>, frame);</span><br></pre></td></tr></table></figure></div><p>参考自：<a target="_blank" rel="noopener" href="https://stackoverflow.com/a/9285151" class="uri">https://stackoverflow.com/a/9285151</a> 。</p><h2 id="后记">后记</h2><p>　　本文还是当初在国内某平台写博客时写的，但现在再回头看，又稍微有了点新的思路，温故确实能知新 (*^__^*) 嘻嘻……。</p><h2 id="参考资料">参考资料</h2><p>[1] <a target="_blank" rel="noopener" href="http://blog.sina.com.cn/s/blog_a3e7ccd6010105yn.html">OpenCV2.3使用摄像头和视频</a>（<a target="_blank" rel="noopener" href="http://blog.sina.com.cn/s/articlelist_2749877462_3_1.html" class="uri">http://blog.sina.com.cn/s/articlelist_2749877462_3_1.html</a>）</p><p>[2] <a target="_blank" rel="noopener" href="http://zhidao.baidu.com/link?url=pIM9Hr0-Yalk-uj8cm5ml0y91X92jJmPAXMKQ-1h7FXSPsrwTiD6_9Ngfq72hmxbVDjNE0aYTOmXCCVEryZvhNBJGW6FbsqjO6dbjVLEZt3">OpenCV Error: Assertion failed (size.width&gt;0 &amp;&amp; size.height&gt;0) in cv::imshow, fi 这个问题怎么办？</a></p><p>[3] <a target="_blank" rel="noopener" href="http://blog.csdn.net/czl389/article/details/51031100">OpenCV打开摄像头出现运行错误OpenCV Error：Assertion failed (size.width&gt;0&amp;&amp;size.height&gt;0)in cv::imshow，……</a>（<a target="_blank" rel="noopener" href="http://blog.csdn.net/czl389/article/category/6381887" class="uri">http://blog.csdn.net/czl389/article/category/6381887</a>）</p><p>[4] <a target="_blank" rel="noopener" href="http://www.cnblogs.com/tiny656/p/3538115.html">[OpenCV]获取摄像头视频</a>（<a target="_blank" rel="noopener" href="http://www.cnblogs.com/tiny656/category/550972.html" class="uri">http://www.cnblogs.com/tiny656/category/550972.html</a>）</p></div><div class="article-content-more"><button type="button" class="article-more--link"><i class="fa fa-angle-double-down fa-3x" aria-hidden="true"></i></button></div></section></article><article id="post-Hexo添加各种小部件" class="article div-border"><header class="article-header"><span class="article-date article-title--index"><i class="fa fa-calendar" aria-hidden="true"></i> <a href="/posts/3bc0decc.html"><time datetime="2017-09-15T12:23:05.000Z">2017-09-15</time></a></span><section class="article-title article-title--index"><a href="/posts/3bc0decc.html">Hexo添加各种小部件</a></section><div class="article-label"><div class="article-category label"><i class="fa fa-book" aria-hidden="true"></i> <a class="color5 article-category-link" href="/categories/%E5%BB%BA%E7%AB%99%E5%B0%8F%E8%AE%B0/">建站小记</a></div><div class="article-tag label"><i class="fa fa-bookmark" aria-hidden="true"></i> <a class="color2 article-tag-none-link" href="/tags/hexo/" rel="tag">hexo</a></div></div></header><section class="article-content"><div class="article-content--excerpt"><h2 id="前言">前言</h2><p>　　Shaun 目前还在使用对 Hexo 的主题 <strong>SPFK</strong> 自行魔改的那个主题（所谓的魔改也就是对照着 <strong>black-blue</strong> 主题修改了部分 CSS，然后又添加了一个站内搜索功能 (&gt;^ω^&lt;)），主题 SPFK 主体的东西其实都没改变。现在正逐渐将其完善中，遂有此文。</p></div><div class="article-content--all"><h2 id="前言">前言</h2><p>　　Shaun 目前还在使用对 Hexo 的主题 <strong>SPFK</strong> 自行魔改的那个主题（所谓的魔改也就是对照着 <strong>black-blue</strong> 主题修改了部分 CSS，然后又添加了一个站内搜索功能 (&gt;^ω^&lt;)），主题 SPFK 主体的东西其实都没改变。现在正逐渐将其完善中，遂有此文。</p><span id="more"></span><h2 id="添加-qq-邮箱联系">添加 QQ 邮箱联系</h2><p><strong><em>添加日期：2017-9-15</em></strong></p><p>　　进入 <a target="_blank" rel="noopener" href="http://openmail.qq.com/">QQ邮箱开放平台</a>，点击“<strong>获取邮我按钮</strong>”，登录 QQ 之后继续点击该按钮，因为 Shaun 不需要其样式，只需要其链接即可，所以就默认样式，直接点击“<strong>获取代码</strong>”即可，Shaun 默认的“<strong>HTML代码</strong>”为：</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false" data-lang="HTML"><div class="code-copy"></div><figure class="highlight hljs html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span> <span class="attr">href</span>=<span class="string">&quot;http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=qNvAyd3G0d3JxujOx9DFycHEhsvHxQ&quot;</span> <span class="attr">style</span>=<span class="string">&quot;text-decoration:none;&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;http://rescdn.qqmail.com/zh_CN/htmledition/images/function/qm_open/ico_mailme_01.png&quot;</span>/&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure></div><p>提取其中的 href，即<code>http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=qNvAyd3G0d3JxujOx9DFycHEhsvHxQ</code>，将该链接添加到 <strong>主题配置文件</strong> 中，具体如下：</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false" data-lang="YAML"><div class="code-copy"></div><figure class="highlight hljs yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">subnav:</span></span><br><span class="line">  <span class="attr">mail:</span> <span class="string">&quot;http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=qNvAyd3G0d3JxujOx9DFycHEhsvHxQ&quot;</span></span><br></pre></td></tr></table></figure></div><p>重新部署站点即可发现对应的邮箱图标，点击该图标可直接给 Shaun 发邮件。</p><h2 id="添加-qq-交谈链接">添加 QQ 交谈链接</h2><p><strong><em>添加日期：2017-9-15</em></strong></p><p>　　进入 <a target="_blank" rel="noopener" href="http://shang.qq.com/v3/widget.html">QQ推广</a>，点击上方的“<strong>推广工具</strong>”，若没登录 QQ 则先登录 QQ，组件样式同样默认即可，这里需要注意的是，需要点击左边的“<strong>设置</strong>”，下滚页面，找到“<strong>安全级别设置</strong>”，如下</p><blockquote><p><h><strong>安全级别设置</strong></h></p><p><input name="qq_security" type="radio">完全公开（推荐商家，客服等用户使用，代码中显示QQ号码，易于推广）</p><p><input name="qq_security" type="radio">安全加密（推荐博主，论坛用户等使用，代码中不显示QQ号码）</p></blockquote><p>选中“<strong>安全加密</strong>”，不然该选项默认的为完全公开，这样 QQ 号码就直接会显示在代码中，不利于隐私保护，选中之后，点击“<strong>保存</strong>”。保存之后，再次点击“<strong>推广工具</strong>”，即可发现下方的复制代码区域的 HTML 代码已看不到明码显示的 QQ 号，（若还是能看到 QQ 号，没有任何变化，可关闭该界面，重启浏览器重新进入该界面），Shaun 的“<strong>复制这段代码并将其粘贴到您的网页上</strong>”下方区域的默认的代码为：</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false" data-lang="HTML"><div class="code-copy"></div><figure class="highlight hljs html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span> <span class="attr">href</span>=<span class="string">&quot;http://sighttp.qq.com/authd?IDKEY=b1afd83745b30922bc98e020847b86a5148d2114e62e8422&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">border</span>=<span class="string">&quot;0&quot;</span>  <span class="attr">src</span>=<span class="string">&quot;http://wpa.qq.com/imgd?IDKEY=b1afd83745b30922bc98e020847b86a5148d2114e62e8422&amp;pic=52&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;点击这里给我发消息&quot;</span> <span class="attr">title</span>=<span class="string">&quot;点击这里给我发消息&quot;</span>/&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure></div><p>提取其中的 href，即<code>http://sighttp.qq.com/authd?IDKEY=b1afd83745b30922bc98e020847b86a5148d2114e62e8422</code>，将该链接添加到 <strong>主题配置文件</strong> 中，具体如下：</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false" data-lang="YAML"><div class="code-copy"></div><figure class="highlight hljs yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">subnav:</span></span><br><span class="line">  <span class="attr">QQ:</span> <span class="string">&quot;http://sighttp.qq.com/authd?IDKEY=4faf682653b3b7f5f47b9cb6d2bb8b81de8fa7a8fb8cee12&quot;</span>  </span><br></pre></td></tr></table></figure></div><p>重新部署站点即可发现对应的 QQ 图标，点击该图标可直接给 Shaun 发临时 QQ 消息。</p><h2 id="添加用户访问统计信息小工具-revolvermaps">添加用户访问统计信息小工具 —— RevolverMaps</h2><p><strong><em>添加日期：2017-10-12</em></strong></p><p>　　由于 Shaun 暂时不想搞 SEO，所以就没有搞站点地图，更没有将 Shaun 的站点提交到百度和 Google 的站长平台上。但 Shaun 又想查看用户访问信息（是不是很矛盾 o(╯□╰)o），而正好 Shaun 看到有个很酷炫的 3D地球 能满足 Shaun 的需求（其实很酷炫才是主要原因 O(∩_∩)O~），所以 Shaun 决定将其加入 Shaun 的站点中（当做一部分装饰品 ๑乛◡乛๑）。该插件的名称为 <a href="http://www.revolvermaps.com/?target=gallery">RevolverMaps</a>，具体样式可以去其官网看，Shaun 就不贴图了。设置完前三步之后，第四步让用户复制代码到自己的站点上，注意第四步会让你选“<strong>new map</strong>”还是“<strong>update</strong>”，由于 Shaun 是初次使用，当然是选择默认的“<strong>new map</strong>”，如果是以前使用过，就选择“<strong>update</strong>”，并将原来使用的 script 代码输入出现的文本框并提交，这样就只是更改 3D 地球样式而不会丢失用户访问信息数据。 　　具体添加方法为：将复制的 script 代码放入想显示的某个 div 中。Shaun 得到的 script 代码为：</p><blockquote><p><code>&lt;script type="text/javascript" src="//rf.revolvermaps.com/0/0/8.js?i=50om5cdoa3h&amp;amp;m=7&amp;amp;c=ff0000&amp;amp;cr1=ffffff&amp;amp;f=arial&amp;amp;l=49" async="async"&gt;&lt;/script&gt;</code></p></blockquote><p>　　由于 Shaun 的博客是双栏的，Shaun 当然是把 RevolverMaps 放入左栏中，Shaun 刚开始是把得到的 script 代码放入主题文件夹下 <code>\layout\_partial\left-col.ejs</code> 文件末尾的</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false" data-lang="HTML"><div class="code-copy"></div><figure class="highlight hljs html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;/<span class="name">header</span>&gt;</span>                </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></div><p><code>&lt;/header&gt;</code> 标签之前（即在 header 的最下端显示 RevolverMaps ），但实际用起来有点不好看；Shaun 又想干脆另外创造一个 div 放置地球，具体思路为：在 birdhouse 图标旁创建一个新的地球图标，再做一个像 birdhouse 图标一样的动画，鼠标移到地球图标时，出现一个 div，该 div 用来放置 RevolverMaps，这一步做到一半（即将一个新的地球图标并排放在 birdhouse 图标旁）发现这个效果感觉更不好看了，如果要改就需要大改了，有点麻烦 o(︶︿︶)o唉；于是 Shaun 看到鼠标放在 birdhouse 图标出现的菜单栏上，想到何不如将该菜单栏在添加一栏，创建一个 div 用来显示 RevolverMaps？事不宜迟，马上就动手添加该 div，具体添加步骤如下：</p><ol type="1"><li><p>首先当然是添加一个“<strong>访问情况</strong>”的列表名称，在主题文件夹下 <code>\layout\_partial\left-col.ejs</code> 文件中 <code>&lt;ul class="tips-inner"&gt;</code> 下最后一个 <code>&lt;li&gt;</code> 后即 <code>&lt;/ul&gt;</code> 前添加 <code>&lt;li&gt;访问情况&lt;/li&gt;</code>；</p></li><li><p>接着像其它的列表一样（点击该列表 birdhouse 图标就会改变成相应的图标），点击“<strong>访问情况</strong>”会将 birdhouse 图标改变成一个地球小图标，经查阅相应的 css 文件，其它的列表对应的图标好像是利用 div 的边框属性画出来的（某业余前端的猜测+_+），Shaun 目前还没有这样的才能，就只有投机的采用 Font Awesome 中的 <a target="_blank" rel="noopener" href="http://fontawesome.io/icon/globe/">globe</a> 图标了。在主题文件夹下 <code>\layout\_partial\left-col.ejs</code> 文件中 <code>&lt;div class="icon-ctn"&gt;</code> 下最末尾即其对应的 <code>&lt;/div&gt;</code> 前添加：</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false" data-lang="HTML"><div class="code-copy"></div><figure class="highlight hljs html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;icon-wrap icon-globe hide&quot;</span> <span class="attr">data-idx</span>=<span class="string">&quot;4&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-globe fa-spin fa-2x&quot;</span> <span class="attr">aria-hidden</span>=<span class="string">&quot;true&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></div><p>这样点击“<strong>访问情况</strong>”会将 birdhouse 图标变成一个旋转的地球小图标了；</p></li><li><p>接下来就需要创建“<strong>访问情况</strong>”对应的 div 了，在主题文件夹下 <code>\layout\_partial\left-col.ejs</code> 文件中 <code>&lt;div class="switch-wrap"&gt;</code> 下最末尾即其对应的 <code>&lt;/div&gt;</code> 前添加：</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false" data-lang="HTML"><div class="code-copy"></div><figure class="highlight hljs html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">&quot;switch-part switch-part5&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;//rf.revolvermaps.com/0/0/8.js?i=50om5cdoa3h<span class="symbol">&amp;amp;</span>m=7<span class="symbol">&amp;amp;</span>c=ff0000<span class="symbol">&amp;amp;</span>cr1=ffffff<span class="symbol">&amp;amp;</span>f=arial<span class="symbol">&amp;amp;</span>l=49&quot;</span> <span class="attr">async</span>=<span class="string">&quot;async&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br></pre></td></tr></table></figure></div><p>这样点击“<strong>访问情况</strong>”就能出现酷炫的 3D 地球了，才怪 :p。这样只能让 3D 地球出现在菜单界面，还需要添加修改相应的 css；</p></li><li><p>最后就是改 css 样式了，本以为这一步很简单，没想到这一步花费 Shaun 最多时间 ╮(╯_╰)╭，修改的样式位于主题文件夹下 <code>\source\css_partial\main.styl</code> 文件中，首先为 switch-part5 添加对应的样式，在 .switch-part4 样式后添加：</p><p></p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false" data-lang="HTML"><div class="code-copy"></div><figure class="highlight hljs html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.switch-part5&#123;</span><br><span class="line">        left: 400%;</span><br><span class="line">        width: 100%;</span><br><span class="line">    	//height: 200px;</span><br><span class="line">        //margin-left: 47px;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></div><p></p><p>做完这一步会发现 3D 地球显示不完全，下面会缺一点，所以还需要继续修改，修改过程如下：Shaun 曾将该 width 减小（如上面代码中的注释），这样确实能让 3D 地球显示完全，但有点小，不是很好看；后面想到没显示完全可能是上层 div（.switch-area）太小且设置了 <code>overflow: hidden;</code>，于是这里 Shaun 首先增加了 .switch-area 的高度，这样确实能解决问题，但会使左栏的滚动条显示出来；所以 Shaun 接着尝试将 .switch-area 的 <code>overflow: hidden;</code> 注释掉，谁想注释掉之后出现了横向滚动条，这样更不好了，于是 Shaun 又更改为 <code>overflow-x: hidden;</code> ，谁想 .switch-area 又出现了竖直滚动条（感觉像拆东墙补西墙 -_-|||），查阅相关资料（<a target="_blank" rel="noopener" href="http://blog.csdn.net/qiqingjin/article/details/50413691">CSS-overflow特性及总结</a>）得知若 overflow-x 为 hidden，overflow-y 不为 hidden，则 overflow-y 将会自动重置为 auto，所以这里不能这样改，但 <code>overflow: hidden;</code> 还是得注释掉，不然上层 div 撑不开，而且不增加高度的话，还是不能完全显示 3D 地球，因为超出就隐藏了嘛；因为注释掉之后会出现横向滚动条，而又不能修改 .switch-area 的 overflow-x，所以就只能改更上层的 div，这里 Shaun 突然想起上次给左栏添加滚动条时，在 .left-col 下添加了 <code>overflow: auto;</code>，这次不如还修改这里，毕竟 Shaun 只想要竖直滚动条（其实不要滚动条却能滚动最好，但 Shaun 目前还没找到好的解决方案 (╯﹏╰)b），不要横向滚动条，于是将其修改为：</p><p></p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false" data-lang="CSS"><div class="code-copy"></div><figure class="highlight hljs css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">overflow-y</span>: auto;</span><br><span class="line"><span class="attribute">overflow-x</span>: hidden;</span><br></pre></td></tr></table></figure></div><p></p><p>没想到这样也能解决问题，虽然还是会在左栏出现滚动条，但这样感觉比增加 .switch-area 的高度要好（嗯，应该要好吧 (～ o ～)Y）。看以后能不能改成点击“<strong>访问情况</strong>”时才出现滚动条，点击其它列表则不出现滚动条（其实把滚动条隐藏最好，但网上那个两个 div 嵌套的方法 Shaun 尝试过会出现一些奇怪的问题，等以后再试试吧 ↖((^ω^)↗）。</p></li></ol><hr><p>待续。。。</p><h2 id="后记">后记</h2><p>　　目前就添加这些小组件，以后应该会陆续添加一些其它的小东西 ↖(^ω^)↗。</p><h2 id="参考资料">参考资料</h2><p>[1] <a target="_blank" rel="noopener" href="http://jingyan.baidu.com/article/dca1fa6fb5b637f1a44052b4.html">如何在自己网站上或者博客上放置QQ邮箱联系反馈</a>（<a target="_blank" rel="noopener" href="http://jingyan.baidu.com/tag?tagName=%E9%82%AE%E7%AE%B1" class="uri">http://jingyan.baidu.com/tag?tagName=%E9%82%AE%E7%AE%B1</a>）</p><p>[2] <a target="_blank" rel="noopener" href="http://www.29mo.com/wltg/363.html">如何在自己的博客添加QQ组件</a>（<a target="_blank" rel="noopener" href="http://www.29mo.com/category/wltg" class="uri">http://www.29mo.com/category/wltg</a>）</p><p>[3] <a target="_blank" rel="noopener" href="http://www.feizl.com/html/29610.htm">一步一步教你给自己博客添加QQ在线</a>（<a target="_blank" rel="noopener" href="http://www.feizl.com/feizhuliu/QQbaodian/" class="uri">http://www.feizl.com/feizhuliu/QQbaodian/</a>）</p></div><div class="article-content-more"><button type="button" class="article-more--link"><i class="fa fa-angle-double-down fa-3x" aria-hidden="true"></i></button></div></section></article><article id="post-OpenCV中显著性检测算法的使用" class="article div-border"><header class="article-header"><span class="article-date article-title--index"><i class="fa fa-calendar" aria-hidden="true"></i> <a href="/posts/fd0f8195.html"><time datetime="2017-09-12T10:36:26.000Z">2017-09-12</time></a></span><section class="article-title article-title--index"><a href="/posts/fd0f8195.html">OpenCV中显著性检测算法的使用</a></section><div class="article-label"><div class="article-category label"><i class="fa fa-book" aria-hidden="true"></i> <a class="color5 article-category-link" href="/categories/Image-Graphic/">Image&Graphic</a></div><div class="article-tag label"><i class="fa fa-bookmark" aria-hidden="true"></i> <a class="color1 article-tag-none-link" href="/tags/cv/" rel="tag">cv</a><a class="color1 article-tag-none-link" href="/tags/opencv/" rel="tag">opencv</a></div></div></header><section class="article-content"><div class="article-content--excerpt"><p><font color="#FA8072">本文所用的 OpenCV 版本为 opencv-3.2.0，编程语言为 C++。</font></p><h2 id="前言">前言</h2><p>　　OpenCV 中实现了两种显著性检测算法，分别为 Spectral Residual 算法,出自 <strong>Xiaodi Hou and Liqing Zhang. Saliency detection: A spectral residual approach. In <em>Computer Vision and Pattern Recognition, 2007. CVPR'07. IEEE Conference on</em>, pages 1–8. IEEE, 2007.</strong> 和 Fine Grained Saliency 算法,出自 <strong>Sebastian Montabone and Alvaro Soto. Human detection using a mobile platform and novel features derived from a visual saliency mechanism. In <em>Image and Vision Computing, Vol. 28 Issue 3</em>, pages 391–402. Elsevier, 2010.</strong>。这两种算法同样是在扩展包 opencv_contrib-3.2.0 中，也是由于 opencv <a target="_blank" rel="noopener" href="https://github.com/opencv/opencv_contrib/blob/master/modules/saliency/samples/computeSaliency.cpp">官方示例程序</a>对初学者不友好（主要是 Shaun 境界不够 o(╯□╰)o），所以 Shaun 对照其<a target="_blank" rel="noopener" href="http://docs.opencv.org/3.2.0/d8/d65/group__saliency.html">官方文档</a>重新整理了一下。</p></div><div class="article-content--all"><p><font color="#FA8072">本文所用的 OpenCV 版本为 opencv-3.2.0，编程语言为 C++。</font></p><h2 id="前言">前言</h2><p>　　OpenCV 中实现了两种显著性检测算法，分别为 Spectral Residual 算法,出自 <strong>Xiaodi Hou and Liqing Zhang. Saliency detection: A spectral residual approach. In <em>Computer Vision and Pattern Recognition, 2007. CVPR'07. IEEE Conference on</em>, pages 1–8. IEEE, 2007.</strong> 和 Fine Grained Saliency 算法,出自 <strong>Sebastian Montabone and Alvaro Soto. Human detection using a mobile platform and novel features derived from a visual saliency mechanism. In <em>Image and Vision Computing, Vol. 28 Issue 3</em>, pages 391–402. Elsevier, 2010.</strong>。这两种算法同样是在扩展包 opencv_contrib-3.2.0 中，也是由于 opencv <a target="_blank" rel="noopener" href="https://github.com/opencv/opencv_contrib/blob/master/modules/saliency/samples/computeSaliency.cpp">官方示例程序</a>对初学者不友好（主要是 Shaun 境界不够 o(╯□╰)o），所以 Shaun 对照其<a target="_blank" rel="noopener" href="http://docs.opencv.org/3.2.0/d8/d65/group__saliency.html">官方文档</a>重新整理了一下。</p><span id="more"></span><h2 id="说明篇">说明篇</h2><p>　　<strong>使用 OpenCV 中实现的显著性检测算法进行显著性检测十分方便简洁，利用以下三个函数就可以：</strong></p><p>创建 Spectral Residual 算法显著性检测对象：<code>static Ptr&lt;StaticSaliencySpectralResidual&gt; cv::saliency::StaticSaliencySpectralResidual::create();</code></p><p>Spectral Residual 算法计算显著性图：<code>bool cv::saliency::StaticSaliencySpectralResidual::computeSaliency(InputArray image, OutputArray saliencyMap);</code></p><p>Fine Grained Saliency 算法显著性检测对应的函数声明同 Spectral Residual 算法类似。</p><p>计算显著性图的二值图：<code>bool cv::saliency::StaticSaliency::computeBinaryMap(InputArray _saliencyMap, OutputArray _binaryMap) ;</code></p><p>具体使用方法可参考实例篇。</p><h2 id="实例篇">实例篇</h2><p>　　使用 OpenCV 中的显著性检测算法需要包含头文件<code>#include &lt;opencv2/saliency.hpp&gt;</code>，具体示例程序如下：</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false" data-lang="C++"><div class="code-copy"></div><figure class="highlight hljs c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/saliency.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//******************************************************</span></span><br><span class="line"><span class="comment">// [opencv_contrib/modules/saliency/src/saliency.cpp](https://github.com/opencv/opencv_contrib/blob/b7dcf141507edbe544e75820c76769a7769223ac/modules/saliency/src/saliency.cpp)</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//Ptr&lt;Saliency&gt; Saliency::create(const String&amp; saliencyType)</span></span><br><span class="line"><span class="comment">//&#123;</span></span><br><span class="line"><span class="comment">//	if (saliencyType == &quot;SPECTRAL_RESIDUAL&quot;)</span></span><br><span class="line"><span class="comment">//		return makePtr&lt;StaticSaliencySpectralResidual&gt;();  //computeSaliency返回的是32FC1</span></span><br><span class="line"><span class="comment">//	else if (saliencyType == &quot;FINE_GRAINED&quot;)</span></span><br><span class="line"><span class="comment">//		return makePtr&lt;StaticSaliencyFineGrained&gt;();	 //computeSaliency返回的是8UC1</span></span><br><span class="line"><span class="comment">//	else if (saliencyType == &quot;BING&quot;)</span></span><br><span class="line"><span class="comment">//		return makePtr&lt;ObjectnessBING&gt;();</span></span><br><span class="line"><span class="comment">//	else if (saliencyType == &quot;BinWangApr2014&quot;)</span></span><br><span class="line"><span class="comment">//		return makePtr&lt;MotionSaliencyBinWangApr2014&gt;();</span></span><br><span class="line"><span class="comment">//	return Ptr&lt;Saliency&gt;();</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// [opencv_contrib/modules/saliency/src/staticSaliency.cpp](https://github.com/opencv/opencv_contrib/blob/41b0a71ac826b1489d3e5c208ac7a95e58556caf/modules/saliency/src/staticSaliency.cpp)</span></span><br><span class="line"><span class="comment">//computeBinaryMap()要求输入的saliencyMap为浮点数（eg:32FC1）</span></span><br><span class="line"><span class="comment">//*****************************************************</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">spectralResidualTest</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	cv::Mat src_img = cv::<span class="built_in">imread</span>(<span class="string">&quot;../data/true.png&quot;</span>, CV_LOAD_IMAGE_ANYDEPTH | CV_LOAD_IMAGE_ANYCOLOR);	<span class="comment">// 载入最真实的原始图像</span></span><br><span class="line">	cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;src_img&quot;</span>, CV_WND_PROP_ASPECTRATIO);</span><br><span class="line">	cv::<span class="built_in">imshow</span>(<span class="string">&quot;src_img&quot;</span>, src_img);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">// [OpenCV实现显著性检测中的谱残差法（Spectral Residual Method）涉及到了傅立叶正反变换](http://blog.csdn.net/kena_m/article/details/49406687)</span></span><br><span class="line">	<span class="keyword">if</span> (src_img.<span class="built_in">empty</span>())</span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">	<span class="keyword">if</span> (src_img.<span class="built_in">channels</span>() == <span class="number">3</span>)</span><br><span class="line">		cv::<span class="built_in">cvtColor</span>(src_img, src_img, CV_BGR2GRAY);</span><br><span class="line">	cv::Mat planes[] = &#123; cv::Mat_&lt;<span class="keyword">float</span>&gt;(src_img), cv::Mat::<span class="built_in">zeros</span>(src_img.<span class="built_in">size</span>(), CV_32F) &#125;;</span><br><span class="line">	cv::Mat complex_img; <span class="comment">//复数矩阵</span></span><br><span class="line">	<span class="built_in">merge</span>(planes, <span class="number">2</span>, complex_img); <span class="comment">//把单通道矩阵组合成复数形式的双通道矩阵</span></span><br><span class="line">	<span class="built_in">dft</span>(complex_img, complex_img);  <span class="comment">// 使用离散傅立叶变换</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//对复数矩阵进行处理，方法为谱残差</span></span><br><span class="line">	cv::Mat magnitude, phase_angle, mag_mean;</span><br><span class="line">	cv::Mat real_part, imaginary_part;</span><br><span class="line">	<span class="built_in">split</span>(complex_img, planes); <span class="comment">//分离复数到实部和虚部</span></span><br><span class="line">	real_part = planes[<span class="number">0</span>]; <span class="comment">//实部</span></span><br><span class="line">	imaginary_part = planes[<span class="number">1</span>]; <span class="comment">//虚部</span></span><br><span class="line">	cv::<span class="built_in">magnitude</span>(real_part, imaginary_part, magnitude); <span class="comment">//计算幅值</span></span><br><span class="line">	<span class="built_in">phase</span>(real_part, imaginary_part, phase_angle); <span class="comment">//计算相角</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">float</span> *pre, *pim, *pm, *pp;</span><br><span class="line">	<span class="comment">//对幅值进行对数化</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; magnitude.rows; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		pm = magnitude.ptr&lt;<span class="keyword">float</span>&gt;(i);</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; magnitude.cols; j++)</span><br><span class="line">		&#123;</span><br><span class="line">			*pm = <span class="built_in">log</span>(*pm);</span><br><span class="line">			pm++;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">blur</span>(magnitude, mag_mean, cv::<span class="built_in">Size</span>(<span class="number">5</span>, <span class="number">5</span>)); <span class="comment">//对数谱的均值滤波</span></span><br><span class="line">	magnitude = magnitude - mag_mean; <span class="comment">//求取对数频谱残差</span></span><br><span class="line">	<span class="comment">//把对数谱残差的幅值和相角划归到复数形式</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; magnitude.rows; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		pre = real_part.ptr&lt;<span class="keyword">float</span>&gt;(i);</span><br><span class="line">		pim = imaginary_part.ptr&lt;<span class="keyword">float</span>&gt;(i);</span><br><span class="line">		pm = magnitude.ptr&lt;<span class="keyword">float</span>&gt;(i);</span><br><span class="line">		pp = phase_angle.ptr&lt;<span class="keyword">float</span>&gt;(i);</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; magnitude.cols; j++)</span><br><span class="line">		&#123;</span><br><span class="line">			*pm = <span class="built_in">exp</span>(*pm);</span><br><span class="line">			*pre = *pm * <span class="built_in">cos</span>(*pp);</span><br><span class="line">			*pim = *pm * <span class="built_in">sin</span>(*pp);</span><br><span class="line">			pre++;</span><br><span class="line">			pim++;</span><br><span class="line">			pm++;</span><br><span class="line">			pp++;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	cv::Mat planes1[] = &#123; cv::Mat_&lt;<span class="keyword">float</span>&gt;(real_part), cv::Mat_&lt;<span class="keyword">float</span>&gt;(imaginary_part) &#125;;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">merge</span>(planes1, <span class="number">2</span>, complex_img); <span class="comment">//重新整合实部和虚部组成双通道形式的复数矩阵</span></span><br><span class="line">	<span class="built_in">idft</span>(complex_img, complex_img, cv::DFT_SCALE); <span class="comment">// 傅立叶反变换</span></span><br><span class="line">	<span class="built_in">split</span>(complex_img, planes); <span class="comment">//分离复数到实部和虚部</span></span><br><span class="line">	real_part = planes[<span class="number">0</span>];</span><br><span class="line">	imaginary_part = planes[<span class="number">1</span>];</span><br><span class="line">	cv::<span class="built_in">magnitude</span>(real_part, imaginary_part, magnitude); <span class="comment">//计算幅值和相角</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; magnitude.rows; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		pm = magnitude.ptr&lt;<span class="keyword">float</span>&gt;(i);</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; magnitude.cols; j++)</span><br><span class="line">		&#123;</span><br><span class="line">			*pm = (*pm) * (*pm);</span><br><span class="line">			pm++;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">GaussianBlur</span>(magnitude, magnitude, cv::<span class="built_in">Size</span>(<span class="number">7</span>, <span class="number">7</span>), <span class="number">2.5</span>, <span class="number">2.5</span>);</span><br><span class="line">	cv::Mat invDFT, invDFTcvt;</span><br><span class="line">	<span class="built_in">normalize</span>(magnitude, invDFT, <span class="number">0</span>, <span class="number">255</span>, cv::NORM_MINMAX); <span class="comment">//归一化到[0,255]供显示</span></span><br><span class="line">	invDFT.<span class="built_in">convertTo</span>(invDFTcvt, CV_8U); <span class="comment">//转化成CV_8U型</span></span><br><span class="line">	cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;SpectualResidual&quot;</span>, CV_WND_PROP_ASPECTRATIO);</span><br><span class="line">	cv::<span class="built_in">imshow</span>(<span class="string">&quot;SpectualResidual&quot;</span>, invDFTcvt);</span><br><span class="line"></span><br><span class="line">	cv::Mat thresholded;</span><br><span class="line">	cv::<span class="built_in">threshold</span>(invDFTcvt, thresholded, <span class="number">0</span>, <span class="number">255</span>, CV_THRESH_OTSU);</span><br><span class="line">	cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;Thresholded Image&quot;</span>, CV_WND_PROP_ASPECTRATIO);</span><br><span class="line">	cv::<span class="built_in">imshow</span>(<span class="string">&quot;Thresholded Image&quot;</span>, thresholded);</span><br><span class="line"></span><br><span class="line">	cv::Mat eroded;</span><br><span class="line">	<span class="comment">// 纵向腐蚀</span></span><br><span class="line">	cv::<span class="built_in">erode</span>(thresholded, eroded, cv::<span class="built_in">Mat</span>(<span class="number">5</span>, <span class="number">1</span>, CV_8UC1, cv::<span class="built_in">Scalar</span>(<span class="number">1</span>)), cv::<span class="built_in">Point</span>(<span class="number">-1</span>, <span class="number">-1</span>), <span class="number">3</span>);	<span class="comment">// cv::Point(-1,-1)为默认参数，代表原点（描点）为矩阵中心</span></span><br><span class="line">	cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;eroded Image&quot;</span>, CV_WND_PROP_ASPECTRATIO);</span><br><span class="line">	cv::<span class="built_in">imshow</span>(<span class="string">&quot;eroded Image&quot;</span>, eroded);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//cv::Mat thresholded;</span></span><br><span class="line">	cv::<span class="built_in">threshold</span>(eroded, thresholded, <span class="number">60</span>, <span class="number">255</span>, CV_THRESH_BINARY);</span><br><span class="line">	cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;Thresholded eroded Image&quot;</span>, CV_WND_PROP_ASPECTRATIO);</span><br><span class="line">	cv::<span class="built_in">imshow</span>(<span class="string">&quot;Thresholded eroded Image&quot;</span>, thresholded);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// 显著性检测算法基类</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">saliencyTest</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	cv::Mat src_img = cv::<span class="built_in">imread</span>(<span class="string">&quot;../data/true.png&quot;</span>, CV_LOAD_IMAGE_ANYDEPTH | CV_LOAD_IMAGE_ANYCOLOR);</span><br><span class="line">	cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;src_img&quot;</span>, CV_WND_PROP_ASPECTRATIO);</span><br><span class="line">	cv::<span class="built_in">imshow</span>(<span class="string">&quot;src_img&quot;</span>, src_img);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (src_img.<span class="built_in">empty</span>())</span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">	<span class="keyword">if</span> (src_img.<span class="built_in">channels</span>() == <span class="number">3</span>)</span><br><span class="line">		cv::<span class="built_in">cvtColor</span>(src_img, src_img, CV_BGR2GRAY);</span><br><span class="line"></span><br><span class="line">	cv::Ptr&lt;cv::saliency::Saliency&gt; saliency_algorithm = cv::saliency::Saliency::<span class="built_in">create</span>(<span class="string">&quot;SPECTRAL_RESIDUAL&quot;</span>);	<span class="comment">// FINE_GRAINED为Fine Grained Saliency算法</span></span><br><span class="line">	cv::Mat saliency_map;</span><br><span class="line">	<span class="keyword">if</span> (saliency_algorithm-&gt;<span class="built_in">computeSaliency</span>(src_img, saliency_map))	<span class="comment">// 计算显著性图</span></span><br><span class="line">	&#123;</span><br><span class="line">		cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;SR saliency map&quot;</span>, CV_WND_PROP_ASPECTRATIO);</span><br><span class="line">		cv::<span class="built_in">imshow</span>(<span class="string">&quot;SR saliency map&quot;</span>, saliency_map);</span><br><span class="line"></span><br><span class="line">		<span class="function">cv::Mat <span class="title">saliency_map_show</span><span class="params">(saliency_map.size(), CV_8UC1)</span></span>;</span><br><span class="line">		<span class="built_in">normalize</span>(saliency_map, saliency_map_show, <span class="number">0</span>, <span class="number">255</span>, CV_MINMAX); <span class="comment">//归一化到[0,255]供显示</span></span><br><span class="line">		saliency_map_show.<span class="built_in">convertTo</span>(saliency_map_show, CV_8U); <span class="comment">//转化成CV_8U型</span></span><br><span class="line">		cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;saliency_map_show&quot;</span>, CV_WND_PROP_ASPECTRATIO);</span><br><span class="line">		cv::<span class="built_in">imshow</span>(<span class="string">&quot;saliency_map_show&quot;</span>, saliency_map_show);</span><br><span class="line"></span><br><span class="line">		cv::Mat binary_map;</span><br><span class="line">		cv::saliency::StaticSaliencySpectralResidual spec;</span><br><span class="line">		<span class="keyword">if</span> (spec.<span class="built_in">computeBinaryMap</span>(saliency_map, binary_map))	<span class="comment">// 对显著性图进行二值化</span></span><br><span class="line">		&#123;</span><br><span class="line">			cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;binary map&quot;</span>, CV_WND_PROP_ASPECTRATIO);</span><br><span class="line">			cv::<span class="built_in">imshow</span>(<span class="string">&quot;binary map&quot;</span>, binary_map);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Fine Grained Saliency算法</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">FGSTest</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	cv::Mat src_img = cv::<span class="built_in">imread</span>(<span class="string">&quot;../data/true.png&quot;</span>, CV_LOAD_IMAGE_ANYDEPTH | CV_LOAD_IMAGE_ANYCOLOR);</span><br><span class="line">	cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;src_img&quot;</span>, CV_WND_PROP_ASPECTRATIO);</span><br><span class="line">	cv::<span class="built_in">imshow</span>(<span class="string">&quot;src_img&quot;</span>, src_img);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (src_img.<span class="built_in">empty</span>())</span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">	<span class="keyword">if</span> (src_img.<span class="built_in">channels</span>() == <span class="number">3</span>)</span><br><span class="line">		cv::<span class="built_in">cvtColor</span>(src_img, src_img, CV_BGR2GRAY);</span><br><span class="line"></span><br><span class="line">	cv::Ptr&lt;cv::saliency::StaticSaliencyFineGrained&gt; fgs = cv::saliency::StaticSaliencyFineGrained::<span class="built_in">create</span>();</span><br><span class="line">	cv::Mat fgs_saliency_map;</span><br><span class="line">	fgs-&gt;<span class="built_in">computeSaliency</span>(src_img, fgs_saliency_map);</span><br><span class="line">	cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;FGS saliency map&quot;</span>, CV_WND_PROP_ASPECTRATIO);</span><br><span class="line">	cv::<span class="built_in">imshow</span>(<span class="string">&quot;FGS saliency map&quot;</span>, fgs_saliency_map);</span><br><span class="line">	<span class="comment">//cv::imwrite(&quot;../data/T_S.png&quot;, fgs_saliency_map);</span></span><br><span class="line"></span><br><span class="line">	cv::Mat binary_map;</span><br><span class="line">	cv::<span class="built_in">threshold</span>(fgs_saliency_map, binary_map, <span class="number">0</span>, <span class="number">255</span>, CV_THRESH_OTSU);</span><br><span class="line">	cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;binary map&quot;</span>, CV_WND_PROP_ASPECTRATIO);</span><br><span class="line">	cv::<span class="built_in">imshow</span>(<span class="string">&quot;binary map&quot;</span>, binary_map);</span><br><span class="line">	<span class="comment">//cv::imwrite(&quot;../data/T_S_B.png&quot;, binary_map);</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Spectral Residual算法</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">SRTest</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	cv::Mat src_img = cv::<span class="built_in">imread</span>(<span class="string">&quot;../data/true.png&quot;</span>, CV_LOAD_IMAGE_ANYDEPTH | CV_LOAD_IMAGE_ANYCOLOR);</span><br><span class="line">	cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;src_img&quot;</span>, CV_WND_PROP_ASPECTRATIO);</span><br><span class="line">	cv::<span class="built_in">imshow</span>(<span class="string">&quot;src_img&quot;</span>, src_img);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (src_img.<span class="built_in">empty</span>())</span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">	<span class="keyword">if</span> (src_img.<span class="built_in">channels</span>() == <span class="number">3</span>)</span><br><span class="line">		cv::<span class="built_in">cvtColor</span>(src_img, src_img, CV_BGR2GRAY);</span><br><span class="line"></span><br><span class="line">	cv::Ptr&lt;cv::saliency::StaticSaliencySpectralResidual&gt; sr = cv::saliency::StaticSaliencySpectralResidual::<span class="built_in">create</span>();</span><br><span class="line">	cv::Mat sr_saliency_map;</span><br><span class="line">	sr-&gt;<span class="built_in">computeSaliency</span>(src_img, sr_saliency_map);</span><br><span class="line">	cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;SR saliency map&quot;</span>, CV_WND_PROP_ASPECTRATIO);</span><br><span class="line">	cv::<span class="built_in">imshow</span>(<span class="string">&quot;SR saliency map&quot;</span>, sr_saliency_map);</span><br><span class="line"></span><br><span class="line">	cv::Mat binary_map;</span><br><span class="line">	sr-&gt;<span class="built_in">computeBinaryMap</span>(sr_saliency_map, binary_map);</span><br><span class="line">	cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;binary map&quot;</span>, CV_WND_PROP_ASPECTRATIO);</span><br><span class="line">	cv::<span class="built_in">imshow</span>(<span class="string">&quot;binary map&quot;</span>, binary_map);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">//spectralResidualTest();</span></span><br><span class="line">	<span class="comment">//saliencyTest();</span></span><br><span class="line">	<span class="comment">//FGSTest();</span></span><br><span class="line">	<span class="built_in">SRTest</span>();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> (cv::<span class="built_in">waitKey</span>(<span class="number">0</span>) != <span class="number">27</span>) &#123; &#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p><em>以上代码在 Win10 VS2013 中编译运行成功。</em></p><p>　　这里面有个小东西需要注意，就是 <code>computeBinaryMap()</code> 函数，看其文档描述其中使用 <em>K-means</em> 算法和 <em>Otsu</em> 算法对显著性图进行二值化处理，其输入的显著性图数据类型应该为浮点数，OpenCV 中 Spectral Residual 算法 computeSaliency() 返回的结果为浮点数，而 Fine Grained Saliency 算法 computeSaliency() 返回的结果却是整型数据，所以这一点需要注意 Fine Grained Saliency 算法返回的结果不能直接使用 computeBinaryMap() 函数，一般对其结果直接使用 OTSU 算法进行阈值分割即可。</p><h2 id="后记">后记</h2><p>　　本文使用的这两种算法在 Shaun 的电脑上运行时间都较长，基本不可能用来处理视频流，而且在 Shaun 的这次实验中效果也不太理想，毕竟这是用来处理静态图像的两种显著性方法。不过 OpenCV 中也有用来处理视频流的显著性检测算法，其为 BING 算法,出自<strong>Ming-Ming Cheng, Ziming Zhang, Wen-Yan Lin, and Philip Torr. Bing: Binarized normed gradients for objectness estimation at 300fps. In <em>IEEE CVPR</em>, 2014.</strong>，实际上这是一种快速提取目标候选框的算法。</p></div><div class="article-content-more"><button type="button" class="article-more--link"><i class="fa fa-angle-double-down fa-3x" aria-hidden="true"></i></button></div></section></article><article id="post-OpenCV中Selective-Search算法的使用" class="article div-border"><header class="article-header"><span class="article-date article-title--index"><i class="fa fa-calendar" aria-hidden="true"></i> <a href="/posts/35132cb7.html"><time datetime="2017-09-10T12:31:03.000Z">2017-09-10</time></a></span><section class="article-title article-title--index"><a href="/posts/35132cb7.html">OpenCV中Selective Search算法的使用</a></section><div class="article-label"><div class="article-category label"><i class="fa fa-book" aria-hidden="true"></i> <a class="color5 article-category-link" href="/categories/Image-Graphic/">Image&Graphic</a></div><div class="article-tag label"><i class="fa fa-bookmark" aria-hidden="true"></i> <a class="color3 article-tag-none-link" href="/tags/cv/" rel="tag">cv</a><a class="color3 article-tag-none-link" href="/tags/opencv/" rel="tag">opencv</a></div></div></header><section class="article-content"><div class="article-content--excerpt"><p><font color="#FA8072">本文所用的 OpenCV 版本为 opencv-3.2.0，编程语言为 C++。</font></p><h2 id="前言">前言</h2><p>　　OpenCV-3.2 中的 Selective Search 算法是在其扩展包中，所以要想使用该算法需自行编译 opencv_contrib-3.2.0。由于扩展包中的示例程序有点简陋，对初学者也不友好（Shaun 编程水平有限，粗浅评价，勿怪 (*^__^ *) 嘻嘻……），所以 Shaun 参考其<a target="_blank" rel="noopener" href="http://docs.opencv.org/3.2.0/d5/df0/group__ximgproc__segmentation.html">官方文档</a>及其<a target="_blank" rel="noopener" href="https://github.com/opencv/opencv_contrib/blob/master/modules/ximgproc/samples/selectivesearchsegmentation_demo.cpp">官方示例程序</a>写下此文。</p></div><div class="article-content--all"><p><font color="#FA8072">本文所用的 OpenCV 版本为 opencv-3.2.0，编程语言为 C++。</font></p><h2 id="前言">前言</h2><p>　　OpenCV-3.2 中的 Selective Search 算法是在其扩展包中，所以要想使用该算法需自行编译 opencv_contrib-3.2.0。由于扩展包中的示例程序有点简陋，对初学者也不友好（Shaun 编程水平有限，粗浅评价，勿怪 (*^__^ *) 嘻嘻……），所以 Shaun 参考其<a target="_blank" rel="noopener" href="http://docs.opencv.org/3.2.0/d5/df0/group__ximgproc__segmentation.html">官方文档</a>及其<a target="_blank" rel="noopener" href="https://github.com/opencv/opencv_contrib/blob/master/modules/ximgproc/samples/selectivesearchsegmentation_demo.cpp">官方示例程序</a>写下此文。</p><span id="more"></span><h2 id="说明篇">说明篇</h2><p>　　该算法是选取 region proposal（一般翻译成候选区域 / 区域建议）领域中当时的 <em>state-of-the-art</em>。其算法具体思想出自 <strong>Jasper RR Uijlings, Koen EA van de Sande, Theo Gevers, and Arnold WM Smeulders. Selective search for object recognition. <em>International journal of computer vision</em>, 104(2):154–171, 2013.</strong>，若英文水平不够，还想了解其中文思想请参考文末参考资料。</p><p>　　<strong>OpenCV中实现的相应函数：</strong></p><p><code>void cv::ximgproc::segmentation::SelectiveSearchSegmentation::addGraphSegmentation(Ptr&lt;GraphSegmentation&gt; g);</code>：添加相应的图割算法；</p><p><code>void cv::ximgproc::segmentation::SelectiveSearchSegmentation::addImage(InputArray img) ;</code> ：添加待处理的图片；</p><p><code>void cv::ximgproc::segmentation::SelectiveSearchSegmentation::addStrategy(Ptr&lt;SelectiveSearchSegmentationStrategy&gt; s);</code> ：添加相应的策略（颜色相似度、纹理相似度、尺寸相似度和填充相似度）；</p><p><code>void cv::ximgproc::segmentation::SelectiveSearchSegmentation::process(std::vector&lt;Rect&gt; &amp;rects);</code>：结合图割算法和相应策略进行处理，返回候选框。</p><h2 id="实例篇">实例篇</h2><p>　　使用 Selective Search 算法需包含<code>#include &lt;opencv2/ximgproc.hpp&gt;</code>，完整示例程序如下：</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false" data-lang="C++"><div class="code-copy"></div><figure class="highlight hljs c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/ximgproc.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">SSTest</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// [Image segmentation](http://docs.opencv.org/3.2.0/d5/df0/group__ximgproc__segmentation.html#ga5e3e721c5f16e34d3ad52b9eeb6d2860) </span></span><br><span class="line"></span><br><span class="line">	cv::Mat src_img = cv::<span class="built_in">imread</span>(<span class="string">&quot;../data/true.png&quot;</span>, CV_LOAD_IMAGE_ANYDEPTH | CV_LOAD_IMAGE_ANYCOLOR);	<span class="comment">// 载入原始图像</span></span><br><span class="line">	cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;src_img&quot;</span>, CV_WINDOW_KEEPRATIO);</span><br><span class="line">	cv::<span class="built_in">imshow</span>(<span class="string">&quot;src_img&quot;</span>, src_img);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//// 转换为灰度图</span></span><br><span class="line">	<span class="comment">//cv::Mat gray_img;</span></span><br><span class="line">	<span class="comment">//cvtColor(src_img, gray_img, cv::COLOR_BGR2GRAY);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 图割算法</span></span><br><span class="line">	cv::Ptr&lt;cv::ximgproc::segmentation::GraphSegmentation&gt; gs = cv::ximgproc::segmentation::<span class="built_in">createGraphSegmentation</span>();</span><br><span class="line">	cv::Mat graph_segmented;</span><br><span class="line">	gs-&gt;<span class="built_in">processImage</span>(src_img, graph_segmented);</span><br><span class="line">	<span class="built_in">normalize</span>(graph_segmented, graph_segmented, <span class="number">0</span>, <span class="number">255</span>, CV_MINMAX); <span class="comment">// 归一化到[0,255]供显示</span></span><br><span class="line">	graph_segmented.<span class="built_in">convertTo</span>(graph_segmented, CV_8U); <span class="comment">// 数据类型转化成CV_8U型</span></span><br><span class="line">	<span class="comment">// cvtColor(graph_segmented, graph_segmented, CV_GRAY2BGR);</span></span><br><span class="line">	cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;graph_segmented&quot;</span>, CV_WINDOW_KEEPRATIO);</span><br><span class="line">	<span class="built_in">imshow</span>(<span class="string">&quot;graph_segmented&quot;</span>, graph_segmented);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 为selective search算法添加图割算法处理结果</span></span><br><span class="line">	cv::Ptr&lt;cv::ximgproc::segmentation::SelectiveSearchSegmentation&gt; ss = cv::ximgproc::segmentation::<span class="built_in">createSelectiveSearchSegmentation</span>();</span><br><span class="line">	ss-&gt;<span class="built_in">addGraphSegmentation</span>(gs);</span><br><span class="line"></span><br><span class="line">	ss-&gt;<span class="built_in">addImage</span>(src_img);	<span class="comment">// 添加待处理的图片</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 自定义策略</span></span><br><span class="line">	cv::Ptr&lt;cv::ximgproc::segmentation::SelectiveSearchSegmentationStrategy&gt; sss_color = cv::ximgproc::segmentation::<span class="built_in">createSelectiveSearchSegmentationStrategyColor</span>();	<span class="comment">// 颜色相似度策略</span></span><br><span class="line">	cv::Ptr&lt;cv::ximgproc::segmentation::SelectiveSearchSegmentationStrategy&gt; sss_texture = cv::ximgproc::segmentation::<span class="built_in">createSelectiveSearchSegmentationStrategyTexture</span>();	<span class="comment">// 纹理相似度策略</span></span><br><span class="line">	cv::Ptr&lt;cv::ximgproc::segmentation::SelectiveSearchSegmentationStrategy&gt; sss_size = cv::ximgproc::segmentation::<span class="built_in">createSelectiveSearchSegmentationStrategySize</span>();	<span class="comment">// 尺寸相似度策略</span></span><br><span class="line">	cv::Ptr&lt;cv::ximgproc::segmentation::SelectiveSearchSegmentationStrategy&gt; sss_fill = cv::ximgproc::segmentation::<span class="built_in">createSelectiveSearchSegmentationStrategyFill</span>();	<span class="comment">// 填充相似度策略</span></span><br><span class="line">	<span class="comment">// 添加策略</span></span><br><span class="line">	cv::Ptr&lt;cv::ximgproc::segmentation::SelectiveSearchSegmentationStrategy&gt; sss = cv::ximgproc::segmentation::<span class="built_in">createSelectiveSearchSegmentationStrategyMultiple</span>(sss_color, sss_texture, sss_size, sss_fill);	<span class="comment">// 合并以上4种策略</span></span><br><span class="line">	ss-&gt;<span class="built_in">addStrategy</span>(sss);</span><br><span class="line"></span><br><span class="line">	std::vector&lt;cv::Rect&gt; regions;</span><br><span class="line">	ss-&gt;<span class="built_in">process</span>(regions);	<span class="comment">// 处理结果</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 显示结果</span></span><br><span class="line">	cv::Mat show_img = src_img.<span class="built_in">clone</span>();</span><br><span class="line">	<span class="keyword">for</span> (std::vector&lt;cv::Rect&gt;::iterator it_r = regions.<span class="built_in">begin</span>(); it_r != regions.<span class="built_in">end</span>(); ++it_r)</span><br><span class="line">	&#123;</span><br><span class="line">		cv::<span class="built_in">rectangle</span>(show_img, *it_r, cv::<span class="built_in">Scalar</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>), <span class="number">3</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;show_img&quot;</span>, CV_WINDOW_KEEPRATIO);</span><br><span class="line">	<span class="built_in">imshow</span>(<span class="string">&quot;show_img&quot;</span>, show_img);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">// -------忽略上述步骤，直接采用方便算法提取候选区域------------------------</span></span><br><span class="line">	<span class="comment">/***************************************************************************</span></span><br><span class="line"><span class="comment">	cv::Ptr&lt;cv::ximgproc::segmentation::SelectiveSearchSegmentation&gt; ss = cv::ximgproc::segmentation::createSelectiveSearchSegmentation();</span></span><br><span class="line"><span class="comment">	ss-&gt;setBaseImage(src_img);	// 采用switch* functions提取候选区域</span></span><br><span class="line"><span class="comment">	ss-&gt;switchToSelectiveSearchFast();	// 快速提取区域</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">	std::vector&lt;cv::Rect&gt; rects;</span></span><br><span class="line"><span class="comment">	ss-&gt;process(rects);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">	int nb_rects = 10;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">	char c = (char)cv::waitKey();</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">	while (c != &#x27;q&#x27;)</span></span><br><span class="line"><span class="comment">	&#123;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">		cv::Mat wimg = src_img.clone();</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">		int i = 0;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">		for (std::vector&lt;cv::Rect&gt;::iterator it = rects.begin(); it != rects.end(); ++it)</span></span><br><span class="line"><span class="comment">		&#123;</span></span><br><span class="line"><span class="comment">			if (i++ &lt; nb_rects)</span></span><br><span class="line"><span class="comment">			&#123;</span></span><br><span class="line"><span class="comment">				cv::rectangle(wimg, *it, cv::Scalar(0, 0, 255), 3);</span></span><br><span class="line"><span class="comment">			&#125;</span></span><br><span class="line"><span class="comment">		&#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">		cv::namedWindow(&quot;Output&quot;, CV_WINDOW_KEEPRATIO);</span></span><br><span class="line"><span class="comment">		imshow(&quot;Output&quot;, wimg);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">		c = (char)cv::waitKey();</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">		if (c == &#x27;d&#x27;)</span></span><br><span class="line"><span class="comment">		&#123;</span></span><br><span class="line"><span class="comment">			nb_rects += 10;</span></span><br><span class="line"><span class="comment">		&#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">		if (c == &#x27;a&#x27; &amp;&amp; nb_rects &gt; 10)</span></span><br><span class="line"><span class="comment">		&#123;</span></span><br><span class="line"><span class="comment">			nb_rects -= 10;</span></span><br><span class="line"><span class="comment">		&#125;</span></span><br><span class="line"><span class="comment">	&#125;</span></span><br><span class="line"><span class="comment">	********************************************************/</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">SSTest</span>();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> (cv::<span class="built_in">waitKey</span>(<span class="number">0</span>) != <span class="number">27</span>) &#123;&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p><em>以上代码在 Win10 VS2013 中编译运行成功。</em></p><h2 id="后记">后记</h2><p>　　使用该算法，要想达到理想效果，一般需要调整图割算法的参数或注释中方法 <code>switchToSelectiveSearchFast()</code> 的参数。Shaun 的这次实验为了达到理想的选取的效果，其调整参数花了不少时间，而且该算法运行时间在 Shaun 电脑上略显长。GitHub 上也有大神自己用 opencv 实现了该算法，参考 <a target="_blank" rel="noopener" href="https://github.com/watanika/selective-search-cpp">watanika/selective-search-cpp</a>，该算法的参数感觉比 OpenCV 自带的 Selective Search 算法要好调一些，但优化效果没有 opencv 好，其运行时间在 Shaun 电脑上更长，毕竟 OpenCV 是 Intel 的亲儿子，Intel 肯定针对处理器对 OpenCV 底层做了一定的优化。</p><h2 id="参考资料">参考资料</h2><p>[1] <a target="_blank" rel="noopener" href="http://jermmy.xyz/2017/05/04/2017-5-4-paper-notes-selective-search/">论文笔记：Selective Search for Object Recognition</a>（<a target="_blank" rel="noopener" href="http://jermmy.xyz/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89/" class="uri">http://jermmy.xyz/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89/</a>）</p><p>[2] <a target="_blank" rel="noopener" href="http://blog.csdn.net/langb2014/article/details/52575507">Selective Search for Object Recognition(阅读)</a>（<a target="_blank" rel="noopener" href="http://blog.csdn.net/langb2014/article/category/5772811" class="uri">http://blog.csdn.net/langb2014/article/category/5772811</a>）</p><p>[3] <a target="_blank" rel="noopener" href="http://blog.csdn.net/csyhhb/article/details/50425114">论文笔记 《Selective Search for Object Recognition》</a>（<a target="_blank" rel="noopener" href="http://blog.csdn.net/csyhhb/article/category/6048588" class="uri">http://blog.csdn.net/csyhhb/article/category/6048588</a>）</p></div><div class="article-content-more"><button type="button" class="article-more--link"><i class="fa fa-angle-double-down fa-3x" aria-hidden="true"></i></button></div></section></article><article id="post-Win10以树形结构显示文件目录结构" class="article div-border"><header class="article-header"><span class="article-date article-title--index"><i class="fa fa-calendar" aria-hidden="true"></i> <a href="/posts/c3f26b1.html"><time datetime="2017-09-05T09:08:34.000Z">2017-09-05</time></a></span><section class="article-title article-title--index"><a href="/posts/c3f26b1.html">Win10以树形结构显示文件目录结构</a></section><div class="article-label"><div class="article-category label"><i class="fa fa-book" aria-hidden="true"></i> <a class="color4 article-category-link" href="/categories/Study/">Study</a></div><div class="article-tag label"><i class="fa fa-bookmark" aria-hidden="true"></i> <a class="color5 article-tag-none-link" href="/tags/unix-like/" rel="tag">unix-like</a></div></div></header><section class="article-content"><div class="article-content--excerpt"><h2 id="前言">前言</h2><p>　　<del>本文其实可以算是标题党，Windows本身并不能以树形结构显示文件目录结构，一般需要借助第三方工具</del>（后面去网上搜索了一下，发现 Windows 居然也有一个 tree 命令 o(╯□╰)o），Windows 虽然能用命令行显示树形结构文件目录，但不像 Linux 那样可以输入一些参数控制其输出。Win10 有个特殊的功能，就是可以使用 Ubuntu 的 bash，只需要开启这个有趣的功能，就可以将 Win10 当 Ubuntu 使用，从而像 Linux 那样只输入相关命令即可显示树形结构文件目录。</p><p><font color="#FA8072">*注：值得注意的是 Win10 中的 bash 目前不支持中文输入，只能切换到英文输入才能正常输入。</font></p></div><div class="article-content--all"><h2 id="前言">前言</h2><p>　　<del>本文其实可以算是标题党，Windows本身并不能以树形结构显示文件目录结构，一般需要借助第三方工具</del>（后面去网上搜索了一下，发现 Windows 居然也有一个 tree 命令 o(╯□╰)o），Windows 虽然能用命令行显示树形结构文件目录，但不像 Linux 那样可以输入一些参数控制其输出。Win10 有个特殊的功能，就是可以使用 Ubuntu 的 bash，只需要开启这个有趣的功能，就可以将 Win10 当 Ubuntu 使用，从而像 Linux 那样只输入相关命令即可显示树形结构文件目录。</p><p><font color="#FA8072">*注：值得注意的是 Win10 中的 bash 目前不支持中文输入，只能切换到英文输入才能正常输入。</font></p><span id="more"></span><h2 id="准备篇">准备篇</h2><p>首先需要在 Win10 下开启 bash 功能。具体开启方法为：</p><ol type="1"><li>打开 <strong>Win图标</strong> ==》 <strong>设置</strong> ==》 <strong>更新和安全</strong> ==》 <strong>针对开发人员</strong>（左侧），选中<strong>开发人员模式</strong>，</li><li>打开 <strong>Win图标</strong> ==》 <strong>设置</strong> ==》 <strong>应用</strong> ==》 <strong>应用和功能</strong>（左侧） ==》 <strong>程序和功能</strong>（最下面的相关设置中） ==》 <strong>启用或关闭Windows功能</strong>（左侧），选中<strong>适用于Linux的Windows子系统(Beta)</strong>后点击确定。</li><li>重启计算机。打开 bash，打开 bash 的方法很多，这里列出三种：1、直接在微软小娜中输入关键字"<strong>bash</strong>"搜索 Bash on Ubuntu on Windows；2、<code>Win键+R</code>，输入 bash，点击确定即可打开 bash；3、<code>Win键+R</code>，输入 cmd，在 cmd 中输入 bash，回车即可打开 bash。打开 bash 后将会提示你是否下载安装 Ubuntu on Windows，输入 y 继续，稍等片刻即可完成下载安装。</li></ol><h2 id="设置篇">设置篇</h2><p>　　安装完成后系统将会提示你设置用户名和密码。（如果这一步设置成功可以直接跳过设置篇直接看使用篇）。不知道怎的，Shaun 这一步没有完成，每次系统都是直接以 root 用户登录，而且没有密码，为了安全考虑，也幸好登录时是 root 用户，可以自由对系统修改。所以 Shaun 需要对 root 密码进行修改，并创建新的用户。具体过程需执行以下命令：</p><p>root 用户下，修改用户密码：</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false" data-lang="BASH"><div class="code-copy"></div><figure class="highlight hljs bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">passwd 用户名 (修改密码)</span><br></pre></td></tr></table></figure></div><p>　　由于 Shaun 需要修改 root 密码，所以该用户名即为 root，执行之后需要输入新密码（在 *nix 哲学中，密码是不会显示在输入屏幕中的，所以如果在输入密码时发现屏幕没有任何变化是没关系的，只管输入即可 ↖(^ω^)↗），两次输入完成后会显示密码更新成功。</p><p>接下来需要创建新的普通用户，在 root 用户下执行：</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false" data-lang="BASH"><div class="code-copy"></div><figure class="highlight hljs bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adduser xxx <span class="comment"># 这样的命令会在home目录下添加一个帐号</span></span><br></pre></td></tr></table></figure></div><p>或者</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false" data-lang="BASH"><div class="code-copy"></div><figure class="highlight hljs bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useradd xxx <span class="comment">#仅仅是添加用户，不会在home目录添加帐号</span></span><br></pre></td></tr></table></figure></div><p>　　推荐使用前者，这样可以很明确已经成功创建新用户，而且如果用户需要存放一些文件也更安全和方便。</p><p>　　在 *nix 中，绝对不推荐直接使用root用户对系统执行各种命令，毕竟其权限太大，一旦误操作将造成无法挽回的后果。有些命令普通用户可能没有权限执行，这时需要提高其权限，普通用户临时获取 root 权限的方法为：在需要执行的命令前添加<code>sudo</code>，像上文中如果普通用户需要创建新用户 xxx 则需要执行<code>sudo adduser xxx</code>，执行以上命令后同样需要输入新用户的密码。</p><h2 id="使用篇">使用篇</h2><p>　　先切换至普通用户，执行<code>su xxx</code>切换用户，即可发现 shell 提示符由<code>#</code>变为<code>$</code>，前面的用户名由<code>root</code>变为<code>xxx</code>；执行<code>cd ~</code>切换至用户目录。由于 Ubuntu 系统中本身没有 tree 这个命令，需要执行以下命令安装 tree 命令工具：</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false" data-lang="BASH"><div class="code-copy"></div><figure class="highlight hljs bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install tree</span><br></pre></td></tr></table></figure></div><p>　　直接输入<code>tree</code>命令，系统将会自动以树形结构列出当前目录中所有文件及文件夹；执行<code>tree -L N</code> 命令，以树形结构查看当前 N 级的目录和文件，eg：以树形结构查看当前目录二级文件结构，则执行<code>tree -L 2</code>。若想将输出的2级文件结构保存至上一层文件的tree.txt文件中，可执行<code>tree -L 2 &gt; ../tree.txt</code>，进入上一层目录<code>cd ..</code>，打开 tree.txt 即可发现该目录的文件结构。</p><h2 id="后记">后记</h2><p>　　遇事还是需要多查证一下啊，想当然果然是会出问题的，文章开头差点就犯错误了 ~\(≧▽≦)/~。本文其实是在写 <a href="https://cniter.github.io/posts/7df528b4.html">Win10＋VS2013＋CMake-gui编译和配置OpenCV-3.2.0</a> 时，为了方便显示输出文件结构而查找的相关资料。</p><h2 id="参考资料">参考资料</h2><p>[1]<a target="_blank" rel="noopener" href="http://jingyan.baidu.com/article/acf728fd19c7eff8e510a3eb.html">linux tree命令以树形结构显示文件目录结构</a>（<a target="_blank" rel="noopener" href="http://jingyan.baidu.com/tag?tagName=linux" class="uri">http://jingyan.baidu.com/tag?tagName=linux</a>）</p><p>[2] <a target="_blank" rel="noopener" href="http://jingyan.baidu.com/article/b24f6c822acbbb86bee5da75.html">win tree命令 tree导出目录 tree显示树形结构</a>（<a target="_blank" rel="noopener" href="http://jingyan.baidu.com/tag?tagName=%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F" class="uri">http://jingyan.baidu.com/tag?tagName=%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F</a>）</p><p>[3] <a target="_blank" rel="noopener" href="http://jingyan.baidu.com/article/39810a23957df3b636fda6cb.html">win10下linux系统的安装（开启）和使用</a></p><p>[4] <a target="_blank" rel="noopener" href="http://www.linuxidc.com/Linux/2012-06/62985.htm">Ubuntu建立和删除用户</a></p><p>[5] <a target="_blank" rel="noopener" href="http://www.jb51.net/article/46429.htm">linux修改root密码和linux忘记root密码后找回密码的方法</a></p></div><div class="article-content-more"><button type="button" class="article-more--link"><i class="fa fa-angle-double-down fa-3x" aria-hidden="true"></i></button></div></section></article><article id="post-Hexo添加站内本地搜索" class="article div-border"><header class="article-header"><span class="article-date article-title--index"><i class="fa fa-calendar" aria-hidden="true"></i> <a href="/posts/4f6225b7.html"><time datetime="2017-09-01T08:23:39.000Z">2017-09-01</time></a></span><section class="article-title article-title--index"><a href="/posts/4f6225b7.html">Hexo添加站内本地搜索</a></section><div class="article-label"><div class="article-category label"><i class="fa fa-book" aria-hidden="true"></i> <a class="color5 article-category-link" href="/categories/%E5%BB%BA%E7%AB%99%E5%B0%8F%E8%AE%B0/">建站小记</a></div><div class="article-tag label"><i class="fa fa-bookmark" aria-hidden="true"></i> <a class="color4 article-tag-none-link" href="/tags/hexo/" rel="tag">hexo</a></div></div></header><section class="article-content"><div class="article-content--excerpt"><h2 id="前言">前言</h2><p>　　虽然 Shaun 博客目前数量不多，质量也不高，但抱着搞事的心态，先弄它一个站内本地搜索再说。</p></div><div class="article-content--all"><h2 id="前言">前言</h2><p>　　虽然 Shaun 博客目前数量不多，质量也不高，但抱着搞事的心态，先弄它一个站内本地搜索再说。</p><span id="more"></span><h2 id="准备篇">准备篇</h2><p>　　要想使用本地搜索功能，首先需要安装相应的搜索插件 <code>hexo-generator-searchdb</code>，网上可能大多数用的是 hexo-generator-search 这个插件，也有都装的，但 Shaun 就只安装这一个了，好像 <code>hexo-generator-searchdb</code> 更完善一点，由于 Shaun 前端接触的极少，所以就没有一一对比了，网上也没查到具体对比情况，有兴趣的童靴可以试试 (╯▽╰)。至于具体安装如下，在站点根目录执行：</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false" data-lang="BASH"><div class="code-copy"></div><figure class="highlight hljs bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-generator-searchdb --save</span><br></pre></td></tr></table></figure></div><p>　　安装完之后重新生成页面，将会发现 <strong>public文件夹</strong> 下多出一个 <code>search.xml</code> 文件。然后在配置文件 <code>_config.yml</code> 中添加：</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false" data-lang="YAML"><div class="code-copy"></div><figure class="highlight hljs yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 站点本地搜索</span></span><br><span class="line"><span class="attr">search:</span></span><br><span class="line">  <span class="attr">path:</span> <span class="string">search.xml</span></span><br><span class="line">  <span class="attr">field:</span> <span class="string">all</span></span><br></pre></td></tr></table></figure></div><p>其中：</p><ul><li><strong>path</strong> - 指定生成的索引数据的文件名。默认为 search.xml 。</li><li><strong>field</strong> - 指定索引数据的生成范围。可选值包括：<ul><li><strong>post</strong> - 只生成博客文章（post）的索引（默认）；</li><li><strong>page</strong> - 只生成其他页面（page）的索引；</li><li><strong>all</strong> - 生成所有文章和页面的索引。</li></ul></li></ul><p>　　至于是在 <strong>主题配置文件</strong>，还是在 <strong>站点配置文件</strong> 中添加，个人觉得都没关系，附：Shaun 是在主题配置文件中添加的。</p><p>接下来就需要修改原主题的代码了。</p><h2 id="改码篇">改码篇</h2><p>　　由于 Shaun 博客主题是基于 <strong>SPFK</strong> 对照着 <strong>black-blue</strong> 进行修改的，而且因为 <strong>black-blue</strong> 是有搜索的（Shaun 不知道 <strong>black-blue</strong> 主题的作者是如何完成的，借助了什么技术），所以 Shaun 就看 <strong>black-blue</strong> 的搜索功能是修改了 <strong>SPFK</strong> 哪个地方，再将相应的代码添加至 <strong>SPFK</strong> 中（其中相应的代码来自<a target="_blank" rel="noopener" href="http://moxfive.xyz/2016/05/31/hexo-local-search/">让 Hexo 博客支持本地站内搜索</a>），从而逐渐完成本次搜索功能。</p><p>首先找到 spfk 主题下的 <code>left-col.ejs</code> 文件，对其修改如下：</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false" data-lang="PLAINTEXT"><div class="code-copy"></div><figure class="highlight hljs plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;% if (theme.search_box)&#123; %&gt;</span><br><span class="line">            &lt;!-- &lt;form&gt;</span><br><span class="line">                &lt;input type=&quot;text&quot; class=&quot;st-default-search-input search&quot; id=&quot;search&quot; placeholder=&quot; Search...&quot;&gt;</span><br><span class="line">            &lt;/form&gt; --&gt;</span><br><span class="line"></span><br><span class="line">            &lt;form id=&quot;search-form&quot;&gt; &lt;!-- 搜索框相关 --&gt;</span><br><span class="line">                &lt;input type=&quot;text&quot; id=&quot;local-search-input&quot; name=&quot;q&quot; results=&quot;0&quot; placeholder=&quot;Search...&quot; class=&quot;search form-control&quot; autocomplete=&quot;off&quot; autocorrect=&quot;off&quot;/&gt;</span><br><span class="line">                &lt;i class=&quot;fa fa-times&quot; onclick=&quot;resetSearch()&quot;&gt;&lt;/i&gt; &lt;!-- 清空/重置搜索框 --&gt;</span><br><span class="line">            &lt;/form&gt;</span><br><span class="line">            &lt;div id=&quot;local-search-result&quot;&gt;&lt;/div&gt; &lt;!-- 搜索结果区 --&gt;</span><br><span class="line">            &lt;p class=&#x27;no-result&#x27;&gt;No results found &lt;/p&gt; &lt;!-- 无匹配时显示，注意请在 CSS 中设置默认隐藏 --&gt;</span><br><span class="line">        &lt;%&#125;%&gt;</span><br></pre></td></tr></table></figure></div><p>其次找到 spfk 主题下的 <code>after-footer.ejs</code> 文件，将其修改如下：</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false" data-lang="PLAINTEXT"><div class="code-copy"></div><figure class="highlight hljs plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line">&lt;% if (theme.search_box)&#123; %&gt;</span><br><span class="line">    &lt;!-- &lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">      window.onload = function()&#123;</span><br><span class="line">        document.getElementById(&quot;search&quot;).onclick = function()&#123;</span><br><span class="line">            console.log(&quot;search&quot;)</span><br><span class="line">            search();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      function search()&#123;</span><br><span class="line">        (function(w,d,t,u,n,s,e)&#123;w[&#x27;SwiftypeObject&#x27;]=n;w[n]=w[n]||function()&#123;</span><br><span class="line">        (w[n].q=w[n].q||[]).push(arguments);&#125;;s=d.createElement(t);</span><br><span class="line">        e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);</span><br><span class="line">        &#125;)(window,document,&#x27;script&#x27;,&#x27;//s.swiftypecdn.com/install/v2/st.js&#x27;,&#x27;_st&#x27;);</span><br><span class="line"></span><br><span class="line">        _st(&#x27;install&#x27;,&#x27;A1Pz-LKMXbrzcFg2FWi6&#x27;,&#x27;2.0.0&#x27;);</span><br><span class="line">      &#125;</span><br><span class="line">    &lt;/script&gt; --&gt;</span><br><span class="line"></span><br><span class="line">    &lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">      // 激活搜索框时才搜索</span><br><span class="line">        var inputArea = document.querySelector(&quot;#local-search-input&quot;);</span><br><span class="line">        var getSearchFile = function()&#123;</span><br><span class="line">          // 调用搜索函数</span><br><span class="line">          var search_path = &quot;&lt;%- config.search.path %&gt;&quot;;</span><br><span class="line">          if (search_path.length == 0) &#123;</span><br><span class="line">             search_path = &quot;search.xml&quot;;</span><br><span class="line">          &#125;</span><br><span class="line">          var path = &quot;&lt;%- config.root %&gt;&quot; + search_path;</span><br><span class="line">          searchFunc(path, &#x27;local-search-input&#x27;, &#x27;local-search-result&#x27;);</span><br><span class="line">        &#125;</span><br><span class="line">        inputArea.onfocus = function()&#123; getSearchFile() &#125;</span><br><span class="line">  </span><br><span class="line">        // 搜索重置</span><br><span class="line">        var $resetButton = $(&quot;#search-form .fa-times&quot;);</span><br><span class="line">        var $resultArea = $(&quot;#local-search-result&quot;);</span><br><span class="line">        inputArea.oninput = function()&#123; $resetButton.show(); &#125;</span><br><span class="line">        resetSearch = function()&#123;</span><br><span class="line">          $resultArea.html(&quot;&quot;);</span><br><span class="line">          document.querySelector(&quot;#search-form&quot;).reset();</span><br><span class="line">          $resetButton.hide();</span><br><span class="line">          $(&quot;.no-result&quot;).hide();</span><br><span class="line">        &#125;</span><br><span class="line">  </span><br><span class="line">        // 屏蔽回车</span><br><span class="line">        inputArea.onkeydown = function()&#123; if(event.keyCode==13) return false&#125;</span><br><span class="line">  </span><br><span class="line">        // 无搜索结果</span><br><span class="line">        $resultArea.bind(&quot;DOMNodeRemoved DOMNodeInserted&quot;, function(e) &#123;</span><br><span class="line">          if (!$(e.target).text()) &#123;</span><br><span class="line">            $(&quot;.no-result&quot;).show(200); </span><br><span class="line">          &#125; else &#123;</span><br><span class="line">            $(&quot;.no-result&quot;).hide();</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">  </span><br><span class="line">        // 搜索函数</span><br><span class="line">        var searchFunc = function(path, search_id, content_id) &#123;</span><br><span class="line">          &#x27;use strict&#x27;;</span><br><span class="line">          $.ajax(&#123;</span><br><span class="line">            url: path,</span><br><span class="line">            dataType: &quot;xml&quot;,</span><br><span class="line">            success: function( xmlResponse ) &#123;</span><br><span class="line">                // get the contents from search data</span><br><span class="line">                var datas = $( &quot;entry&quot;, xmlResponse ).map(function() &#123;</span><br><span class="line">                    return &#123;</span><br><span class="line">                        title: $( &quot;title&quot;, this ).text(),</span><br><span class="line">                        content: $(&quot;content&quot;,this).text(),</span><br><span class="line">                        url: $( &quot;url&quot; , this).text()</span><br><span class="line">                    &#125;;</span><br><span class="line">                &#125;).get();</span><br><span class="line">                var $input = document.getElementById(search_id);</span><br><span class="line">                var $resultContent = document.getElementById(content_id);</span><br><span class="line">                $input.addEventListener(&#x27;input&#x27;, function()&#123;</span><br><span class="line">                    var str=&#x27;&lt;ul class=\&quot;search-result-list\&quot;&gt;&#x27;;                </span><br><span class="line">                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);</span><br><span class="line">                    $resultContent.innerHTML = &quot;&quot;;</span><br><span class="line">                    if (this.value.trim().length &lt;= 0) &#123;</span><br><span class="line">                        return;</span><br><span class="line">                    &#125;</span><br><span class="line">                    // perform local searching</span><br><span class="line">                    datas.forEach(function(data) &#123;</span><br><span class="line">                        var isMatch = true;</span><br><span class="line">                        var content_index = [];</span><br><span class="line">                        var data_title = data.title.trim().toLowerCase();</span><br><span class="line">                        var data_content = data.content.trim().replace(/&lt;[^&gt;]+&gt;/g,&quot;&quot;).toLowerCase();</span><br><span class="line">                        var data_url = data.url;</span><br><span class="line">                        var index_title = -1;</span><br><span class="line">                        var index_content = -1;</span><br><span class="line">                        var first_occur = -1;</span><br><span class="line">                        // only match artiles with not empty titles and contents</span><br><span class="line">                        if(data_title != &#x27;&#x27; &amp;&amp; data_content != &#x27;&#x27;) &#123;</span><br><span class="line">                            keywords.forEach(function(keyword, i) &#123;</span><br><span class="line">                                index_title = data_title.indexOf(keyword);</span><br><span class="line">                                index_content = data_content.indexOf(keyword);</span><br><span class="line">                                if( index_title &lt; 0 &amp;&amp; index_content &lt; 0 )&#123;</span><br><span class="line">                                    isMatch = false;</span><br><span class="line">                                &#125; else &#123;</span><br><span class="line">                                    if (index_content &lt; 0) &#123;</span><br><span class="line">                                        index_content = 0;</span><br><span class="line">                                    &#125;</span><br><span class="line">                                    if (i == 0) &#123;</span><br><span class="line">                                        first_occur = index_content;</span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;);</span><br><span class="line">                        &#125;</span><br><span class="line">                        // show search results</span><br><span class="line">                        if (isMatch) &#123;</span><br><span class="line">                            str += &quot;&lt;li&gt;&lt;a href=&#x27;/&quot;+ data_url +&quot;&#x27; class=&#x27;search-result-title&#x27; target=&#x27;_blank&#x27;&gt;&quot;+ &quot;&gt; &quot; + data_title +&quot;&lt;/a&gt;&quot;;</span><br><span class="line">                            var content = data.content.trim().replace(/&lt;[^&gt;]+&gt;/g,&quot;&quot;);</span><br><span class="line">                            if (first_occur &gt;= 0) &#123;</span><br><span class="line">                                // cut out characters</span><br><span class="line">                                var start = first_occur - 6;</span><br><span class="line">                                var end = first_occur + 6;</span><br><span class="line">                                if(start &lt; 0)&#123;</span><br><span class="line">                                    start = 0;</span><br><span class="line">                                &#125;</span><br><span class="line">                                if(start == 0)&#123;</span><br><span class="line">                                    end = 10;</span><br><span class="line">                                &#125;</span><br><span class="line">                                if(end &gt; content.length)&#123;</span><br><span class="line">                                    end = content.length;</span><br><span class="line">                                &#125;</span><br><span class="line">                                var match_content = content.substr(start, end); </span><br><span class="line">                                // highlight all keywords</span><br><span class="line">                                keywords.forEach(function(keyword)&#123;</span><br><span class="line">                                    var regS = new RegExp(keyword, &quot;gi&quot;);</span><br><span class="line">                                    match_content = match_content.replace(regS, &quot;&lt;em class=\&quot;search-keyword\&quot;&gt;&quot;+keyword+&quot;&lt;/em&gt;&quot;);</span><br><span class="line">                                &#125;)</span><br><span class="line">                                str += &quot;&lt;p class=\&quot;search-result\&quot;&gt;&quot; + match_content +&quot;...&lt;/p&gt;&quot;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;)</span><br><span class="line">                    $resultContent.innerHTML = str;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;%&#125;%&gt;</span><br></pre></td></tr></table></figure></div><p>最后找到 spfk 主题下的 <code>main.styl</code> 文件，在其末尾添加：</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false" data-lang="SCSS"><div class="code-copy"></div><figure class="highlight hljs scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*搜索框*/</span></span><br><span class="line"><span class="selector-class">.search</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">68%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">18px</span>;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">1px</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">font-family</span>: inherit;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">2px</span> solid transparent;</span><br><span class="line">  <span class="attribute">border-bottom</span>: <span class="number">2px</span> solid <span class="number">#d3d3d3</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">2px</span>;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0.65</span>;</span><br><span class="line">  <span class="attribute">background</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.search</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">2px</span> solid <span class="number">#d3d3d3</span>;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">10px</span> rgba(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0.3</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*搜索重置按钮*/</span></span><br><span class="line"><span class="selector-id">#search-form</span> <span class="selector-class">.fa-times</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: none;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">1px</span> <span class="number">0.7em</span>;</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">3px</span> rgba(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0.15</span>);</span><br><span class="line">  <span class="attribute">cursor</span>: pointer;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#4094c7</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#search-form</span> <span class="selector-class">.fa-times</span><span class="selector-pseudo">:active</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#d3d3d3</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#search-form</span> <span class="selector-class">.fa-times</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  zoom: <span class="number">1.1</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">1px</span> <span class="number">0.6em</span>;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#d3d3d3</span>;</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">6px</span> rgba(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0.25</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*搜索结果区*/</span></span><br><span class="line"><span class="selector-id">#local-search-result</span> &#123;</span><br><span class="line">  <span class="comment">//margin: auto -12% auto -6%;</span></span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">0.9em</span>;</span><br><span class="line">  <span class="attribute">text-align</span>: left;</span><br><span class="line">  <span class="attribute">word-break</span>: break-all;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">4px</span> <span class="number">4px</span> <span class="number">6px</span> rgba(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0.46</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#local-search-result</span> <span class="selector-tag">ul</span><span class="selector-class">.search-result-list</span> <span class="selector-tag">li</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">font-weight</span>: normal;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*单条搜索结果*/</span></span><br><span class="line"><span class="selector-id">#local-search-result</span> <span class="selector-tag">li</span> &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0.5em</span> auto;</span><br><span class="line">  <span class="attribute">border-bottom</span>: <span class="number">2px</span> solid <span class="number">#d3d3d3</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#local-search-result</span> <span class="selector-class">.search-result-list</span> <span class="selector-tag">li</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: rgba(<span class="number">47</span>,<span class="number">46</span>,<span class="number">46</span>,<span class="number">0.8</span>);</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">5px</span> rgba(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0.2</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*匹配的标题*/</span></span><br><span class="line"><span class="selector-id">#local-search-result</span> <span class="selector-tag">a</span><span class="selector-class">.search-result-title</span> &#123;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">1.2</span>;</span><br><span class="line">  <span class="attribute">font-weight</span>: bold;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#4094c7</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*搜索预览段落*/</span></span><br><span class="line"><span class="selector-id">#local-search-result</span> <span class="selector-tag">p</span><span class="selector-class">.search-result</span> &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0.4em</span> auto;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">1.2em</span>;</span><br><span class="line">  <span class="attribute">max-height</span>: <span class="number">3.6em</span>;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">0.8em</span>;</span><br><span class="line">  <span class="attribute">text-align</span>: justify;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#ffffff</span>b3;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*匹配的关键词*/</span></span><br><span class="line"><span class="selector-id">#local-search-result</span> <span class="selector-tag">em</span><span class="selector-class">.search-keyword</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#f58e90</span>;</span><br><span class="line">  <span class="attribute">border-bottom</span>: <span class="number">1px</span> dashed <span class="number">#f58e90</span>;</span><br><span class="line">  <span class="attribute">font-weight</span>: bold;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">1em</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*无匹配搜索结果时显示*/</span></span><br><span class="line"><span class="selector-tag">p</span><span class="selector-class">.no-result</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: none;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">2em</span> <span class="number">0</span> <span class="number">2em</span> <span class="number">6%</span>;</span><br><span class="line">  <span class="attribute">padding-bottom</span>: <span class="number">0.5em</span>;</span><br><span class="line">  <span class="attribute">text-align</span>: left;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#808080</span>;</span><br><span class="line">  <span class="attribute">font-family</span>: font-serif serif;</span><br><span class="line">  <span class="attribute">border-bottom</span>: <span class="number">2px</span> solid <span class="number">#d3d3d3</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>　　这里请注意，当对 <code>main.styl</code> 文件做以上修改时，可能会发现有两个 <code>.search</code> 样式，而且相差不大，这时，不要对其原有的 <code>.search</code> 进行修改，更不要去注释掉它，只做上述修改就不用管了，不然可能会发生一些奇怪的事 o(&gt;﹏&lt;)o。Shaun 当时做以上修改时，将其原有的 <code>.search</code> 样式注释掉之后，整个页面的 css 布局全部都乱了 (╯﹏╰)，不知道为什么 (⊙_⊙?)，这两个同名样式看起来明明差不多的，最后只能维持现状了，等以后有机会再看看吧，业余前端伤不起啊! ╮(╯_╰)╭。</p><p>　　至此整个站内本地搜索功能基本完成，勉强可以使用站内搜索功能了。</p><h2 id="问题篇">问题篇</h2><p>　　*注：以下问题于 2018-03-02 都已经解决 ╮(╯▽╰)╭。</p><p><font color="#FA8072">1、搜索函数返回的 url 地址有问题。</font></p><p>　　问题描述：当点击搜索结果时，新弹出的标签页地址栏中 url 地址会有部分乱码情况；当鼠标移到搜索的结果列表上时，浏览器左下角显示的 url 地址虽然没有乱码情况，但其中有一个重复的<code>/</code>符号。所幸这两个问题并没有造成浏览器解析错误，浏览器还是可以正常显示页面的。</p><p><strong><em>================= 修改日期：2018-03-02 =================</em></strong></p><p>　　<strong>解决办法：</strong>将 <code>\blog\node_modules\hexo-generator-searchdb\templates\xml.ejs</code> 文件中的 <code>&lt;url&gt;&lt;%- encodeURIComponent(config.root + post.path) %&gt;&lt;/url&gt;</code> 修改为 <code>&lt;url&gt;&lt;%- encodeURI(post.path) %&gt;&lt;/url&gt;</code> ，使其中一些 url 中常见的字符（如：&amp;, ?, /, =）<strong>不被</strong>十六进制的转义序列进行替换。</p><p><strong>参考：</strong><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/21861899">escape,encodeURI,encodeURIComponent有什么区别?</a> 和 <a target="_blank" rel="noopener" href="http://www.w3school.com.cn/jsref/jsref_encodeURIComponent.asp">JavaScript encodeURIComponent() 函数</a> 。</p><p>=====================================================</p><p><font color="#FA8072">2、搜索结果区布局有问题。</font></p><p>　　问题描述：当显示搜索结果时，搜索结果区会上下扩张，从而将其上下本来存在的一些布局挤开，造成布局混乱。这其实不算是一个 spfk 主题或者新添加的搜索功能的问题，而是新添加的一个东西又没有相应的和原本布局结合的布局文件，那就极大可能会有布局混乱的问题，至于这个要和原本布局契合的搜索结果区布局文件就只有等 Shaun 以后有机会有时间再完善去喽 ╮(╯▽╰)╭。</p><p><font color="#FA8072">3、搜索框激活问题。</font></p><p>　　问题描述：搜索框激活延迟很大，有时过很久或者需要切换站内页面它才能激活，给人的感觉就是好像没有搜索功能似的。添加搜索框激活功能据作者 <a target="_blank" rel="noopener" href="http://moxfive.xyz/">MOxFIVE</a> 所说是为了不让索引文件影响页面加载速度，MOxFIVE 同时也在文末指出了一些不足之处，如果索引文件太大，可能还是会造成一些问题，但 Shaun 的博客数量又不多，所以估计还是 Shaun 的代码混合问题，而且 MOxFIVE 的博客搜索功能好像没这个问题（至少 Shaun 目前没发现）。这个问题同样只有等以后再说了 (*^__^*) 嘻嘻……。</p><h2 id="后记">后记</h2><p>　　本文添加的本地搜索还很粗糙，还有很多地方需要以后去完善。但这好歹是一个好的开始，搜索功能至少勉强能够正常使用，总比以前是个空壳要好，以后有机会再慢慢去去完善吧 ↖(^ω^)↗。</p><h2 id="参考资料">参考资料</h2><p>[1] <a target="_blank" rel="noopener" href="http://www.hahack.com/codes/local-search-engine-for-hexo/">jQuery-based Local Search Engine for Hexo</a>（<a target="_blank" rel="noopener" href="http://www.hahack.com/categories/codes/" class="uri">http://www.hahack.com/categories/codes/</a>）</p><p>[2] <a target="_blank" rel="noopener" href="http://moxfive.xyz/2016/05/31/hexo-local-search/">让 Hexo 博客支持本地站内搜索</a>（<a target="_blank" rel="noopener" href="http://moxfive.xyz/tags/Hexo/" class="uri">http://moxfive.xyz/tags/Hexo/</a>）</p><p>[3] <a target="_blank" rel="noopener" href="https://www.ezlippi.com/blog/2017/02/hexo-search.html">Hexo博客添加站内搜索</a>（<a target="_blank" rel="noopener" href="https://www.ezlippi.com/categories/hexo/" class="uri">https://www.ezlippi.com/categories/hexo/</a>）</p><p>[4] <a target="_blank" rel="noopener" href="https://www.oyohyee.com/post/Note/LocalSearch.html">Hexo本地搜索及部分SEO优化</a> （<a target="_blank" rel="noopener" href="https://www.oyohyee.com/categories/Note/" class="uri">https://www.oyohyee.com/categories/Note/</a>）</p></div><div class="article-content-more"><button type="button" class="article-more--link"><i class="fa fa-angle-double-down fa-3x" aria-hidden="true"></i></button></div></section></article><article id="post-用OpenCV显示OpenGL图形" class="article div-border"><header class="article-header"><span class="article-date article-title--index"><i class="fa fa-calendar" aria-hidden="true"></i> <a href="/posts/302a6244.html"><time datetime="2017-08-31T01:40:31.000Z">2017-08-31</time></a></span><section class="article-title article-title--index"><a href="/posts/302a6244.html">用OpenCV显示OpenGL图形</a></section><div class="article-label"><div class="article-category label"><i class="fa fa-book" aria-hidden="true"></i> <a class="color4 article-category-link" href="/categories/Image-Graphic/">Image&Graphic</a></div><div class="article-tag label"><i class="fa fa-bookmark" aria-hidden="true"></i> <a class="color5 article-tag-none-link" href="/tags/cv/" rel="tag">cv</a><a class="color5 article-tag-none-link" href="/tags/gl/" rel="tag">gl</a><a class="color5 article-tag-none-link" href="/tags/opencv/" rel="tag">opencv</a><a class="color5 article-tag-none-link" href="/tags/opengl/" rel="tag">opengl</a></div></div></header><section class="article-content"><div class="article-content--excerpt"><h2 id="前言">前言</h2><p>　　本文就是一个小实验，试验 OpenCV 到底能不能支持 OpenGL 图形显示。</p></div><div class="article-content--all"><h2 id="前言">前言</h2><p>　　本文就是一个小实验，试验 OpenCV 到底能不能支持 OpenGL 图形显示。</p><span id="more"></span><h2 id="正文">正文</h2><p>　　如果在 OpenCV 用 CMake 编译时勾选 <strong>WITH_OPENGL</strong> 且编译一切顺利的话，编译和配置的具体步骤和情况可以看 Shaun 写的一篇文档：<a href="https://cniter.github.io/posts/7df528b4.html">Win10＋VS2013＋CMake-gui编译和配置OpenCV-3.2.0</a> ，那么就可以用 OpenCV 窗口显示 OpenGL 图形。</p><p>　　在 VS 下使用 Windows 原有的 OpenGL 函数需要包含以下头文件和库文件：</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false" data-lang="C++"><div class="code-copy"></div><figure class="highlight hljs c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;GL/gl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;GL/glu.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> comment(lib, <span class="meta-string">&quot;OpenGL32.lib&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> comment(lib, <span class="meta-string">&quot;glu32.lib&quot;</span>)</span></span><br></pre></td></tr></table></figure></div><p>　　在 OpenCV 中显示 OpenGL 图形需要 <code>cv::namedWindow(openGLWindowName, cv::WINDOW_OPENGL)</code>，在 namedWindow 函数中添加 cv::WINDOW_OPENGL 参数说明该窗口支持 OpenGL 图形。</p><p>附示例程序：</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false" data-lang="C++"><div class="code-copy"></div><figure class="highlight hljs c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;GL/gl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;GL/glu.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> comment(lib, <span class="meta-string">&quot;OpenGL32.lib&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> comment(lib, <span class="meta-string">&quot;glu32.lib&quot;</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">float</span> vertex_list[][<span class="number">3</span>] =</span><br><span class="line">&#123;</span><br><span class="line">	<span class="number">-0.5f</span>, <span class="number">-0.5f</span>, <span class="number">-0.5f</span>,</span><br><span class="line">	<span class="number">0.5f</span>, <span class="number">-0.5f</span>, <span class="number">-0.5f</span>,</span><br><span class="line">	<span class="number">-0.5f</span>, <span class="number">0.5f</span>, <span class="number">-0.5f</span>,</span><br><span class="line">	<span class="number">0.5f</span>, <span class="number">0.5f</span>, <span class="number">-0.5f</span>,</span><br><span class="line">	<span class="number">-0.5f</span>, <span class="number">-0.5f</span>, <span class="number">0.5f</span>,</span><br><span class="line">	<span class="number">0.5f</span>, <span class="number">-0.5f</span>, <span class="number">0.5f</span>,</span><br><span class="line">	<span class="number">-0.5f</span>, <span class="number">0.5f</span>, <span class="number">0.5f</span>,</span><br><span class="line">	<span class="number">0.5f</span>, <span class="number">0.5f</span>, <span class="number">0.5f</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将要使用的顶点的序号保存到一个数组里面 </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> GLint index_list[][<span class="number">2</span>] =</span><br><span class="line">&#123;</span><br><span class="line">	&#123; <span class="number">0</span>, <span class="number">1</span> &#125;,</span><br><span class="line">	&#123; <span class="number">2</span>, <span class="number">3</span> &#125;,</span><br><span class="line">	&#123; <span class="number">4</span>, <span class="number">5</span> &#125;,</span><br><span class="line">	&#123; <span class="number">6</span>, <span class="number">7</span> &#125;,</span><br><span class="line">	&#123; <span class="number">0</span>, <span class="number">2</span> &#125;,</span><br><span class="line">	&#123; <span class="number">1</span>, <span class="number">3</span> &#125;,</span><br><span class="line">	&#123; <span class="number">4</span>, <span class="number">6</span> &#125;,</span><br><span class="line">	&#123; <span class="number">5</span>, <span class="number">7</span> &#125;,</span><br><span class="line">	&#123; <span class="number">0</span>, <span class="number">4</span> &#125;,</span><br><span class="line">	&#123; <span class="number">1</span>, <span class="number">5</span> &#125;,</span><br><span class="line">	&#123; <span class="number">7</span>, <span class="number">3</span> &#125;,</span><br><span class="line">	&#123; <span class="number">2</span>, <span class="number">6</span> &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">float</span> rotate = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> times = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">GLint windowWidth = <span class="number">800</span>;</span><br><span class="line">GLint windowHeight = <span class="number">800</span>;</span><br><span class="line"></span><br><span class="line">GLfloat xRotAngle = <span class="number">-75.0f</span>;</span><br><span class="line">GLfloat yRotAngle = <span class="number">0.0f</span>;</span><br><span class="line">GLfloat zRotAngle = <span class="number">-135.0f</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">float</span> MIN_X = <span class="number">-200</span>;</span><br><span class="line"><span class="keyword">float</span> MAX_X = <span class="number">200</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">float</span> MIN_Y = <span class="number">-200</span>;</span><br><span class="line"><span class="keyword">float</span> MAX_Y = <span class="number">200</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">float</span> MIN_Z = <span class="number">-200</span>;</span><br><span class="line"><span class="keyword">float</span> MAX_Z = <span class="number">200</span>;</span><br><span class="line"></span><br><span class="line">GLfloat coordinatesize = <span class="number">200.0f</span>;</span><br><span class="line">GLfloat ratio = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">drawLine</span><span class="params">(<span class="keyword">float</span> x1, <span class="keyword">float</span> y1, <span class="keyword">float</span> z1, <span class="keyword">float</span> x2, <span class="keyword">float</span> y2, <span class="keyword">float</span> z2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">glBegin</span>(GL_LINES);</span><br><span class="line">	<span class="built_in">glVertex3f</span>(x1, y1, z1);</span><br><span class="line">	<span class="built_in">glVertex3f</span>(x2, y2, z2);</span><br><span class="line">	<span class="built_in">glEnd</span>();</span><br><span class="line">	<span class="built_in">glFlush</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 绘制立方体</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DrawCube</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> i, j;</span><br><span class="line">	<span class="built_in">glBegin</span>(GL_LINES);</span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">12</span>; ++i) <span class="comment">// 12 条线段</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">2</span>; ++j) <span class="comment">// 每条线段 2个顶点</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">glVertex3fv</span>(vertex_list[index_list[i][j]]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">glEnd</span>();</span><br><span class="line">	<span class="built_in">glFlush</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">reshapeOperate</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">glMatrixMode</span>(GL_PROJECTION);</span><br><span class="line">	<span class="built_in">glLoadIdentity</span>();</span><br><span class="line">	<span class="keyword">if</span> (ratio &lt; <span class="number">1</span>)</span><br><span class="line">		<span class="built_in">glOrtho</span>(-coordinatesize, coordinatesize, -coordinatesize / ratio, coordinatesize / ratio, -coordinatesize, coordinatesize);</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		<span class="built_in">glOrtho</span>(-coordinatesize*ratio, coordinatesize*ratio, -coordinatesize, coordinatesize, -coordinatesize, coordinatesize);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glMatrixMode</span>(GL_MODELVIEW);</span><br><span class="line">	<span class="built_in">glLoadIdentity</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">reshape</span><span class="params">(<span class="keyword">int</span> w, <span class="keyword">int</span> h)</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> ((w == <span class="number">0</span>) || (h == <span class="number">0</span>))</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glViewport</span>(<span class="number">0</span>, <span class="number">0</span>, w, h);</span><br><span class="line"></span><br><span class="line">	ratio = (GLfloat)w / (GLfloat)h;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">reshapeOperate</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GLfloat AngleX = <span class="number">45.0f</span>;</span><br><span class="line">GLfloat AngleY = <span class="number">315.0f</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">reshape1</span><span class="params">(<span class="keyword">int</span> w, <span class="keyword">int</span> h)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	GLfloat aspect = (GLfloat)w / (GLfloat)h;</span><br><span class="line">	GLfloat nRange = <span class="number">100.0f</span>;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glViewport</span>(<span class="number">0</span>, <span class="number">0</span>, w, h);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glMatrixMode</span>(GL_PROJECTION); <span class="comment">//将当前矩阵指定为投影模式  </span></span><br><span class="line">	<span class="built_in">glLoadIdentity</span>();</span><br><span class="line"></span><br><span class="line">	<span class="comment">//设置三维投影区  </span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (w &lt;= h)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">glOrtho</span>(-nRange, nRange, -nRange * aspect, nRange * aspect, -nRange, nRange);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">glOrtho</span>(-nRange, nRange, -nRange / aspect, nRange / aspect, -nRange, nRange);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(<span class="keyword">void</span>*)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// Draw something using OpenGL here  </span></span><br><span class="line">	<span class="comment">//glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);	 //清除所有的像素</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//glMatrixMode(GL_MODELVIEW);</span></span><br><span class="line">	<span class="comment">//glLoadIdentity();</span></span><br><span class="line">	<span class="comment">//glPushMatrix();</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">////glTranslatef(-0.2, 0, 0); // 平移</span></span><br><span class="line">	<span class="comment">////glScalef(2, 1, 1);    // 缩放</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//glRotatef(xRotAngle, 1.0f, 0.0f, 0.0f);</span></span><br><span class="line">	<span class="comment">//glRotatef(yRotAngle, 0.0f, 1.0f, 0.0f);</span></span><br><span class="line">	<span class="comment">//glRotatef(zRotAngle, 0.0f, 0.0f, 1.0f);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//glColor3f(1, 0, 0);</span></span><br><span class="line">	<span class="comment">//drawLine(0, 0, 0, MAX_X, 0, 0); //x轴</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//glColor3f(0, 1, 0);</span></span><br><span class="line">	<span class="comment">//drawLine(0, 0, 0, 0, MAX_Y, 0); //y轴</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//glColor3f(0, 0, 1);</span></span><br><span class="line">	<span class="comment">//drawLine(0, 0, 0, 0, 0, MAX_Z); //z轴</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//times++;</span></span><br><span class="line">	<span class="comment">//if (times &gt; 1)</span></span><br><span class="line">	<span class="comment">//&#123;</span></span><br><span class="line">	<span class="comment">//	times = 0;</span></span><br><span class="line">	<span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//if (times % 1 == 0)</span></span><br><span class="line">	<span class="comment">//&#123;</span></span><br><span class="line">	<span class="comment">//	rotate += 0.3;</span></span><br><span class="line">	<span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//glRotatef(rotate, 0, 1, 0);</span></span><br><span class="line">	<span class="comment">//glRotatef(rotate, 1, 0, 0);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//glColor3f(0, 1, 1);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//DrawCube();</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//glPopMatrix();</span></span><br><span class="line"></span><br><span class="line">	<span class="built_in">reshape1</span>(windowWidth, windowHeight);</span><br><span class="line">	<span class="built_in">glClear</span>(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);</span><br><span class="line">	<span class="built_in">glMatrixMode</span>(GL_MODELVIEW);</span><br><span class="line">	<span class="built_in">glLoadIdentity</span>();</span><br><span class="line">	AngleX++;</span><br><span class="line">	AngleY++;</span><br><span class="line">	<span class="built_in">glPushMatrix</span>();</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">glRotatef</span>(AngleX, <span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>);</span><br><span class="line">		<span class="built_in">glRotatef</span>(AngleY, <span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>);</span><br><span class="line"></span><br><span class="line">		<span class="built_in">glBegin</span>(GL_POLYGON); <span class="comment">//前表面  </span></span><br><span class="line">		<span class="built_in">glColor3ub</span>((GLubyte)<span class="number">255</span>, (GLubyte)<span class="number">255</span>, (GLubyte)<span class="number">255</span>);<span class="comment">//颜色设置为白色  </span></span><br><span class="line">		<span class="built_in">glVertex3f</span>(<span class="number">50.0f</span>, <span class="number">50.0f</span>, <span class="number">50.0f</span>);</span><br><span class="line"></span><br><span class="line">		<span class="built_in">glColor3ub</span>((GLubyte)<span class="number">255</span>, (GLubyte)<span class="number">255</span>, (GLubyte)<span class="number">0</span>);<span class="comment">//颜色设置为黄色  </span></span><br><span class="line">		<span class="built_in">glVertex3f</span>(<span class="number">50.0f</span>, <span class="number">-50.0f</span>, <span class="number">50.0f</span>);</span><br><span class="line"></span><br><span class="line">		<span class="built_in">glColor3ub</span>((GLubyte)<span class="number">255</span>, (GLubyte)<span class="number">0</span>, (GLubyte)<span class="number">0</span>);<span class="comment">//颜色设置为红色  </span></span><br><span class="line">		<span class="built_in">glVertex3f</span>(<span class="number">-50.0f</span>, <span class="number">-50.0f</span>, <span class="number">50.0f</span>);</span><br><span class="line"></span><br><span class="line">		<span class="built_in">glColor3ub</span>((GLubyte)<span class="number">255</span>, (GLubyte)<span class="number">0</span>, (GLubyte)<span class="number">255</span>);<span class="comment">//颜色设置为白色  </span></span><br><span class="line">		<span class="built_in">glVertex3f</span>(<span class="number">-50.0f</span>, <span class="number">50.0f</span>, <span class="number">50.0f</span>);</span><br><span class="line">		<span class="built_in">glEnd</span>();</span><br><span class="line"></span><br><span class="line">		<span class="built_in">glBegin</span>(GL_POLYGON); <span class="comment">//后表面  </span></span><br><span class="line">		<span class="built_in">glColor3f</span>(<span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>);<span class="comment">//颜色设置为青色  </span></span><br><span class="line">		<span class="built_in">glVertex3f</span>(<span class="number">50.0f</span>, <span class="number">50.0f</span>, <span class="number">-50.0f</span>);</span><br><span class="line"></span><br><span class="line">		<span class="built_in">glColor3f</span>(<span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>);<span class="comment">//颜色设置为绿色  </span></span><br><span class="line">		<span class="built_in">glVertex3f</span>(<span class="number">50.0f</span>, <span class="number">-50.0f</span>, <span class="number">-50.0f</span>);</span><br><span class="line"></span><br><span class="line">		<span class="built_in">glColor3f</span>(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>);<span class="comment">//颜色设置为黑色  </span></span><br><span class="line">		<span class="built_in">glVertex3f</span>(<span class="number">-50.0f</span>, <span class="number">-50.0f</span>, <span class="number">-50.0f</span>);</span><br><span class="line"></span><br><span class="line">		<span class="built_in">glColor3f</span>(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>);<span class="comment">//颜色设置为蓝色  </span></span><br><span class="line">		<span class="built_in">glVertex3f</span>(<span class="number">-50.0f</span>, <span class="number">50.0f</span>, <span class="number">-50.0f</span>);</span><br><span class="line">		<span class="built_in">glEnd</span>();</span><br><span class="line"></span><br><span class="line">		<span class="built_in">glBegin</span>(GL_POLYGON); <span class="comment">//上表面  </span></span><br><span class="line">		<span class="built_in">glColor3d</span>(<span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>);<span class="comment">//颜色设置为青色  </span></span><br><span class="line">		<span class="built_in">glVertex3f</span>(<span class="number">50.0f</span>, <span class="number">50.0f</span>, <span class="number">-50.0f</span>);</span><br><span class="line"></span><br><span class="line">		<span class="built_in">glColor3d</span>(<span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>);<span class="comment">//颜色设置为白色  </span></span><br><span class="line">		<span class="built_in">glVertex3f</span>(<span class="number">50.0f</span>, <span class="number">50.0f</span>, <span class="number">50.0f</span>);</span><br><span class="line"></span><br><span class="line">		<span class="built_in">glColor3d</span>(<span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>);<span class="comment">//颜色设置为品红色  </span></span><br><span class="line">		<span class="built_in">glVertex3f</span>(<span class="number">-50.0f</span>, <span class="number">50.0f</span>, <span class="number">50.0f</span>);</span><br><span class="line"></span><br><span class="line">		<span class="built_in">glColor3d</span>(<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>);<span class="comment">//颜色设置为蓝色  </span></span><br><span class="line">		<span class="built_in">glVertex3f</span>(<span class="number">-50.0f</span>, <span class="number">50.0f</span>, <span class="number">-50.0f</span>);</span><br><span class="line">		<span class="built_in">glEnd</span>();</span><br><span class="line"></span><br><span class="line">		<span class="built_in">glBegin</span>(GL_POLYGON); <span class="comment">//下表面  </span></span><br><span class="line">		<span class="built_in">glColor3ub</span>(<span class="number">0u</span>, <span class="number">255u</span>, <span class="number">0u</span>);<span class="comment">//颜色设置为绿色  </span></span><br><span class="line">		<span class="built_in">glVertex3f</span>(<span class="number">50.0f</span>, <span class="number">-50.0f</span>, <span class="number">-50.0f</span>);</span><br><span class="line"></span><br><span class="line">		<span class="built_in">glColor3ub</span>(<span class="number">255u</span>, <span class="number">255u</span>, <span class="number">0u</span>);<span class="comment">//颜色设置为黄色  </span></span><br><span class="line">		<span class="built_in">glVertex3f</span>(<span class="number">50.0f</span>, <span class="number">-50.0f</span>, <span class="number">50.0f</span>);</span><br><span class="line"></span><br><span class="line">		<span class="built_in">glColor3ub</span>(<span class="number">255u</span>, <span class="number">0u</span>, <span class="number">0u</span>);<span class="comment">//颜色设置为红色  </span></span><br><span class="line">		<span class="built_in">glVertex3f</span>(<span class="number">-50.0f</span>, <span class="number">-50.0f</span>, <span class="number">50.0f</span>);</span><br><span class="line"></span><br><span class="line">		<span class="built_in">glColor3ub</span>(<span class="number">0u</span>, <span class="number">0u</span>, <span class="number">0u</span>);<span class="comment">//颜色设置为黑色  </span></span><br><span class="line">		<span class="built_in">glVertex3f</span>(<span class="number">-50.0f</span>, <span class="number">-50.0f</span>, <span class="number">-50.0f</span>);</span><br><span class="line">		<span class="built_in">glEnd</span>();</span><br><span class="line"></span><br><span class="line">		<span class="built_in">glBegin</span>(GL_POLYGON); <span class="comment">//左表面  </span></span><br><span class="line">		<span class="built_in">glColor3ub</span>((GLubyte)<span class="number">255</span>, (GLubyte)<span class="number">255</span>, (GLubyte)<span class="number">255</span>);<span class="comment">//颜色设置为白色  </span></span><br><span class="line">		<span class="built_in">glVertex3f</span>(<span class="number">50.0f</span>, <span class="number">50.0f</span>, <span class="number">50.0f</span>);</span><br><span class="line"></span><br><span class="line">		<span class="built_in">glColor3ub</span>((GLubyte)<span class="number">0</span>, (GLubyte)<span class="number">255</span>, (GLubyte)<span class="number">255</span>);<span class="comment">//颜色设置为青色  </span></span><br><span class="line">		<span class="built_in">glVertex3f</span>(<span class="number">50.0f</span>, <span class="number">50.0f</span>, <span class="number">-50.0f</span>);</span><br><span class="line"></span><br><span class="line">		<span class="built_in">glColor3ub</span>((GLubyte)<span class="number">0</span>, (GLubyte)<span class="number">255</span>, (GLubyte)<span class="number">0</span>);<span class="comment">//颜色设置为绿色  </span></span><br><span class="line">		<span class="built_in">glVertex3f</span>(<span class="number">50.0f</span>, <span class="number">-50.0f</span>, <span class="number">-50.0f</span>);</span><br><span class="line"></span><br><span class="line">		<span class="built_in">glColor3ub</span>((GLubyte)<span class="number">255</span>, (GLubyte)<span class="number">255</span>, (GLubyte)<span class="number">0</span>);<span class="comment">//颜色设置为黄色  </span></span><br><span class="line">		<span class="built_in">glVertex3f</span>(<span class="number">50.0f</span>, <span class="number">-50.0f</span>, <span class="number">50.0f</span>);</span><br><span class="line">		<span class="built_in">glEnd</span>();</span><br><span class="line"></span><br><span class="line">		<span class="built_in">glBegin</span>(GL_POLYGON); <span class="comment">//右表面  </span></span><br><span class="line">		<span class="built_in">glColor3f</span>(<span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>);<span class="comment">//颜色设置为品红色  </span></span><br><span class="line">		<span class="built_in">glVertex3f</span>(<span class="number">-50.0f</span>, <span class="number">50.0f</span>, <span class="number">50.0f</span>);</span><br><span class="line"></span><br><span class="line">		<span class="built_in">glColor3f</span>(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>);<span class="comment">//颜色设置为蓝色  </span></span><br><span class="line">		<span class="built_in">glVertex3f</span>(<span class="number">-50.0f</span>, <span class="number">50.0f</span>, <span class="number">-50.0f</span>);</span><br><span class="line"></span><br><span class="line">		<span class="built_in">glColor3f</span>(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>);<span class="comment">//颜色设置为黑色  </span></span><br><span class="line">		<span class="built_in">glVertex3f</span>(<span class="number">-50.0f</span>, <span class="number">-50.0f</span>, <span class="number">-50.0f</span>);</span><br><span class="line"></span><br><span class="line">		<span class="built_in">glColor3f</span>(<span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>);<span class="comment">//颜色设置为红色  </span></span><br><span class="line">		<span class="built_in">glVertex3f</span>(<span class="number">-50.0f</span>, <span class="number">-50.0f</span>, <span class="number">50.0f</span>);</span><br><span class="line">		<span class="built_in">glEnd</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">glPopMatrix</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">opencvWithOpenGLTest</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	std::string openGLWindowName = <span class="string">&quot;OpenGL Test&quot;</span>;</span><br><span class="line">	cv::<span class="built_in">namedWindow</span>(openGLWindowName, cv::WINDOW_OPENGL);</span><br><span class="line">	cv::<span class="built_in">resizeWindow</span>(openGLWindowName, windowWidth, windowHeight);</span><br><span class="line">	cv::<span class="built_in">setOpenGlContext</span>(openGLWindowName);</span><br><span class="line">	cv::<span class="built_in">setOpenGlDrawCallback</span>(openGLWindowName, onDraw, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> (cv::<span class="built_in">waitKey</span>(<span class="number">30</span>) != <span class="number">27</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		cv::<span class="built_in">updateWindow</span>(openGLWindowName);	<span class="comment">// when needed  </span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">opencvWithOpenGLTest</span>();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>运行成功后可看到一个旋转的彩色立方体。</p><h2 id="结论">结论</h2><p>　　从实验结果来看，OpenCV 确实能支持 OpenGL 图形的显示，但其不足之处也很明显：没有提供鼠标和键盘的交互操作（可能是 Shaun 还没发现，毕竟只是尝试一下看它能不能显示），仅仅只是提供一个显示窗口。如果真想用 OpenGL 做一些好玩的东西，还是用 glut 和 glew 吧，不过 glut 已经停止更新许久，glew 在调试时可能会出现一些莫名其妙的错误，所以网上有人用 freeglut 代替 glut，glee 代替 glew，具体的东西 Shaun 也没试过，Shaun 目前还没做过 OpenGL 相关的事，这次用 OpenCV 显示 OpenGL 图形纯粹是为了好玩 (*^__^ *) 嘻嘻……。</p><h2 id="后记">后记</h2><p>　　本篇文档也是上次编译配置完 OpenCV-3.2 后做的一次小实验，但当时并没有记录，所以还有一些参考资料也已经不知道了 :-(。</p><h2 id="参考资料">参考资料</h2><p>[1] <a target="_blank" rel="noopener" href="http://blog.csdn.net/yang_xian521/article/details/8531058">OpenCV学习笔记（六十一）——建立支持OpenGL的OpenCV工程“Master OpenCV”chp.3</a>（<a target="_blank" rel="noopener" href="http://blog.csdn.net/yang_xian521/article/category/910716" class="uri">http://blog.csdn.net/yang_xian521/article/category/910716</a>）</p><p>[2] <a target="_blank" rel="noopener" href="http://blog.csdn.net/bcbobo21cn/article/details/51058836">几个opengl立方体绘制案例</a>（<a target="_blank" rel="noopener" href="http://blog.csdn.net/bcbobo21cn/article/category/3104565" class="uri">http://blog.csdn.net/bcbobo21cn/article/category/3104565</a>）</p></div><div class="article-content-more"><button type="button" class="article-more--link"><i class="fa fa-angle-double-down fa-3x" aria-hidden="true"></i></button></div></section></article><nav id="pagination--nav" class="text-center"><a class="extend prev" rel="prev" href="/page/6/">&lt;&lt; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/8/">Next &gt;&gt;</a></nav></main><div id="site-tool"><div class="scroll"><a href="#header"><i class="fa fa-arrow-up"></i></a> <a href="#footer"><i class="fa fa-arrow-down"></i></a></div><div></div></div><aside id="right-col" class="col-lg-3 col-sm-12"><div id="sidebar-sticky--bottom"></div><div id="sidebar"><header class="author-info div-border"><a href="/"><img class="header-avatar" src="/img/avatar.jpg"></a><h1 class="header-author"><a href="/" title="Hi Mate" data-toggle="tooltip">Shaun</a></h1><p class="header-slogan">求知！ 视界！ 未来！ ↖(^ω^)↗</p><div class="social-info"><a class="social-icon" target="_blank" href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&email=qNvAyd3G0d3JxujOx9DFycHEhsvHxQ" title="envelope" data-toggle="tooltip"><i class="fa fa-envelope" aria-hidden="true"></i> </a><a class="social-icon" target="_blank" href="https://github.com/cniter" title="github" data-toggle="tooltip"><i class="fa fa-github" aria-hidden="true"></i> </a><a class="social-icon" target="_blank" href="/atom.xml" title="rss" data-toggle="tooltip"><i class="fa fa-rss" aria-hidden="true"></i> </a><a class="social-icon" target="_blank" href="http://sighttp.qq.com/authd?IDKEY=4faf682653b3b7f5f47b9cb6d2bb8b81de8fa7a8fb8cee12" title="qq" data-toggle="tooltip"><i class="fa fa-qq" aria-hidden="true"></i></a></div></header><div class="search div-border" title="搜索" data-toggle="tooltip"><form id="search-form"><input type="text" id="local-search--input" name="q" results="0" placeholder=" Search..." autocomplete="off" autocorrect="off"> <i class="fa fa-times" onclick="resetSearch()"></i></form><div id="local-search--result"></div><p class="no-result">No results found</p></div><div id="tagcloud" class="tagcanvas div-border" title="标签" data-toggle="tooltip"><canvas width="200" height="200" id="tagcloud-canvas"><p>Anything in here will be replaced on browsers that support the canvas element</p><ul><li><a href="/tags/algorithm/" data-weight="7">algorithm</a></li><li><a href="/tags/android/" data-weight="2">android</a></li><li><a href="/tags/bigdata/" data-weight="2">bigdata</a></li><li><a href="/tags/c-cpp/" data-weight="6">c/cpp</a></li><li><a href="/tags/clustering/" data-weight="1">clustering</a></li><li><a href="/tags/container/" data-weight="1">container</a></li><li><a href="/tags/css/" data-weight="1">css</a></li><li><a href="/tags/cv/" data-weight="5">cv</a></li><li><a href="/tags/devtool/" data-weight="1">devtool</a></li><li><a href="/tags/ffmpeg/" data-weight="1">ffmpeg</a></li><li><a href="/tags/geomesa/" data-weight="1">geomesa</a></li><li><a href="/tags/geometry/" data-weight="4">geometry</a></li><li><a href="/tags/gfw/" data-weight="1">gfw</a></li><li><a href="/tags/github/" data-weight="1">github</a></li><li><a href="/tags/gl/" data-weight="1">gl</a></li><li><a href="/tags/golang/" data-weight="1">golang</a></li><li><a href="/tags/hexo/" data-weight="8">hexo</a></li><li><a href="/tags/integration/" data-weight="1">integration</a></li><li><a href="/tags/java/" data-weight="2">java</a></li><li><a href="/tags/k8s/" data-weight="1">k8s</a></li><li><a href="/tags/language/" data-weight="3">language</a></li><li><a href="/tags/latex/" data-weight="1">latex</a></li><li><a href="/tags/mapbox/" data-weight="1">mapbox</a></li><li><a href="/tags/markdown/" data-weight="1">markdown</a></li><li><a href="/tags/matlab/" data-weight="2">matlab</a></li><li><a href="/tags/network/" data-weight="1">network</a></li><li><a href="/tags/note/" data-weight="7">note</a></li><li><a href="/tags/numerical/" data-weight="1">numerical</a></li><li><a href="/tags/opencv/" data-weight="11">opencv</a></li><li><a href="/tags/opendrive/" data-weight="1">opendrive</a></li><li><a href="/tags/opengl/" data-weight="1">opengl</a></li><li><a href="/tags/python/" data-weight="1">python</a></li><li><a href="/tags/qt/" data-weight="2">qt</a></li><li><a href="/tags/record/" data-weight="14">record</a></li><li><a href="/tags/search/" data-weight="1">search</a></li><li><a href="/tags/segmentation/" data-weight="2">segmentation</a></li><li><a href="/tags/tensorflow/" data-weight="1">tensorflow</a></li><li><a href="/tags/thought/" data-weight="3">thought</a></li><li><a href="/tags/unix-like/" data-weight="3">unix-like</a></li><li><a href="/tags/vscode/" data-weight="1">vscode</a></li></ul></canvas><script src="/plugins/TagCanvas/jquery.tagcanvas.min.js" type="text/javascript"></script><script type="text/javascript">$(document).ready((function(){$("#tagcloud-canvas").tagcanvas({initial:[.1,-.1],activeCursor:'url("/img/cursor/link.cur"), auto',reverse:!0,depth:.75,weight:!0,weightFrom:"data-weight",weightMode:"both",weightSizeMin:15,weightSizeMax:50})||$("#tagcloud").hide()}))</script></div><div class="friends div-border" title="友链" data-toggle="tooltip"><a target="_blank" class="friends-link" href="https://cniter.github.io">Shaun&#39;s Space</a></div><div class="revolvermaps div-border" title="访客" data-toggle="tooltip"><script type="text/javascript" src="//rf.revolvermaps.com/0/0/8.js?i=50om5cdoa3h&amp;m=7&amp;c=ff0000&amp;cr1=ffffff&amp;f=arial&amp;l=49" defer></script></div></div><div class="toc-card"><div class="toc-card--head"><i class="fa fa-angle-up" aria-hidden="true"></i></div><div id="toc" class="toc-card--content"><strong class="toc-title">文章列表</strong><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/posts/6be57d7f.html">关于中学的学习方法</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/2eb69b33.html">记一次资源不释放的问题</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/dbbe01e5.html">社畜三年，风雨兼程</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/8e1d1e1d.html">2021 年小结</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/4b1f50ff.html">M1 个人配置</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/9c9b4035.html">Scala 多线程编程小结</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/720275bd.html">Google S2 Geometry 浅解</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/55e674ff.html">K8S 应用开发指北</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/81321445.html">OpenGL坐标系统与渲染管线</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/8d3d87a2.html">Scala 学习小结</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/28416d7c.html">2020年小结</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/b59e3e7b.html">Linux服务器运维文档</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/489fa7b3.html">时空查询之ECQL</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/9978824c.html">GeoMesa踩坑指北</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/3692cd6.html">IDEA使用Docker环境开发调试</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/af5e9ace.html">大数据环境搭建笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/ae780057.html">设计模式浅谈</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/eee1c041.html">积分计算</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/a5661762.html">Geometry增量更新</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/e225d8fd.html">Mapbox显示GeoServer地图</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/3d8ab974.html">Docker使用小结</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/6694a214.html">空间中三角形与三角形相交</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/5315fcfd.html">计算几何基础</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/b7d79231.html">OpenDrive解析小结</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/39a3c99e.html">一张纹理做天空盒</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/a250bb21.html">Windows Terminal 尝鲜小记</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/ae5f9dce.html">读大学</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/cf97ba7c.html">2019，既是结束又是开始</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/ff29de94.html">快速判断三角形与长方体相交</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/70a807da.html">网页菜单纯 css 实现</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/abe58f8c.html">个人游记</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/26d437be.html">hexo-theme-chi主题更新小记</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/3578e309.html">［译］为什么深度学习没有取代传统的计算机视觉</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/37b89a23.html">再也不见，18年</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/ac4679b5.html">hexo-theme-chi主题开发小记</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/64889158.html">Matlab和OpenCV混合编程小结</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/be7949e4.html">Android实践小结</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/fc1165b7.html">C++数组中的坑</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/cafdd60d.html">Android开发环境配置</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/27a4c8b6.html">Windows实用技巧</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/6315717b.html">FFmpeg提取与合并命令使用小结</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/fd823bf9.html">解决VSCode使用Cmder作为默认终端问题</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/fddd1e17.html">图割算法之NCuts浅见</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/c42ff8d4.html">图割算法之Graph Cuts浅见</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/b93d943b.html">C++中static用法小结</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/8fb9f004.html">斐波那契数列的三种写法</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/bcdf334e.html">LaTex语法指北</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/982ff584.html">搜索技巧</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/7cebf0ee.html">17年走了，18年来了</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/e124baa1.html">矩阵的应用之图像仿射变换</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/aef52be2.html">本人常用小工具安利</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/376168c6.html">解决无法打开某个网页问题</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/5f54aa2c.html">PyQt5使用小结</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/82d3b275.html">TensorFlow Object Detection API使用小结</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/2a3d46b0.html">C语言中整型提升问题</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/dece8eba.html">TXT数据转OpenCV中的Mat数据</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/e8b35736.html">OpenCV中滑动条和鼠标事件响应操作的使用小结</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/b6fb6109.html">利用回调函数计算函数运行时间</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/df943c4f.html">论如何科学的上网</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/b1e9411b.html">Hexo的SPFK主题修改小记</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/22c3daf1.html">解决Qt中Qlabel显示OpenCV的Mat数据图像产生扭曲现象问题</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/509ee93b.html">解决OpenCV-2.4.11调用摄像头显示拍摄视频出错问题</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/3bc0decc.html">Hexo添加各种小部件</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/fd0f8195.html">OpenCV中显著性检测算法的使用</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/35132cb7.html">OpenCV中Selective Search算法的使用</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/170c76cc.html">别了，漆黑的象牙塔</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/c3f26b1.html">Win10以树形结构显示文件目录结构</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/68065b99.html">ACGN作品个人印象简评</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/4f6225b7.html">Hexo添加站内本地搜索</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/302a6244.html">用OpenCV显示OpenGL图形</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/7df528b4.html">Win10＋VS2013＋CMake-gui编译和配置OpenCV-3.2.0</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/17017530.html">MyThoughts</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/7d5bc07b.html">解决写上篇文档“Hexo+GitHub搭建个人博客”遇到的问题</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/d7965b48.html">Hexo+GitHub搭建个人博客</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/4a17b156.html">Hello World</a></li></ul></div></div></aside></div></div><span id="cursor-trail"></span> <span class="click-halo"></span><footer id="footer" class="text-center"><div class="copyright-info">&copy; 2017 - 2024 <a href="/">Shaun</a></div><span class="site-visitor"><i class="fa fa-user-o" aria-hidden="true"></i> <span id="busuanzi_value_site_uv"><i class="fa fa-spinner fa-spin"></i></span> &nbsp;|&nbsp; <i class="fa fa-eye" aria-hidden="true"></i> <span id="busuanzi_value_site_pv"><i class="fa fa-spinner fa-spin"></i></span> &nbsp;|&nbsp; <i class="fa fa-hand-o-up" aria-hidden="true"></i> <span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span></span><div class="site-info"><a href="http://hexo.io/" target="_blank">Hexo </a>theme <a href="https://github.com/cniter/hexo-theme-chi" target="_blank">Chi </a>by <a href="https://github.com/cniter" target="_blank">Shaun</a></div></footer><script type="text/javascript" async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML" integrity="sha256-WUED7NFzpsmHtLO7bswSz4JSfkhE+cD4ncKeOznwFSY=" crossorigin="anonymous"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }

        , TeX: {
            extensions: ["extpfeil.js"]
        }
    });
    
    MathJax.Hub.Queue(function() {
        let all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';                 
        }       
    });</script><script type="text/javascript">const MutationObserver=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,config={attributes:!0,childList:!0,characterData:!0};let target=document.querySelector("#local-search--result"),$local_search_result=$("#local-search--result"),$no_result=$(".no-result"),observer=new MutationObserver((function(e){e.forEach((function(e){$local_search_result.text()||""==$local_search_result.html()?$no_result.hide():$no_result.show(200)}))})),inputArea=document.querySelector("#local-search--input"),getSearchFile=function(){let e="search.xml";0==e.length&&(e="search.xml"),searchFunc("/"+e,"local-search--input","local-search--result"),observer.observe(target,config)};inputArea.onfocus=function(){getSearchFile()};let $resetButton=$("#search-form .fa-times"),$resultArea=$("#local-search--result");inputArea.oninput=function(){$resetButton.show()};let resetSearch=function(){$resultArea.html(""),document.querySelector("#search-form").reset(),$resetButton.hide(),$no_result.hide(),observer.disconnect()};inputArea.onkeydown=function(e){if(13==e.keyCode)return!1};let searchFunc=function(e,t,r){"use strict";$.ajax({url:e,dataType:"xml",success:function(e){let n=$("entry",e).map((function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}})).get(),l=document.getElementById(t),s=document.getElementById(r);l.addEventListener("input",(function(){let e='<ul class="search-result--list">',t=this.value.trim().toLowerCase().split(/[\s\-]+/);s.innerHTML="",this.value.trim().length<=0||(n.forEach((function(r){let n=!0,l=r.title.trim().toLowerCase(),s=r.content.trim().replace(/<[^>]+>/g,"").toLowerCase(),c=r.url,o=-1,a=-1,u=-1;if(""!=l&&""!=s&&t.forEach((function(e,t){o=l.indexOf(e),a=s.indexOf(e),o<0&&a<0?n=!1:(a<0&&(a=0),0==t&&(u=a))})),n){e+="<li><a href='"+c+"' class='search-result--title' target='_blank'>> "+l+"</a>";let n=r.content.trim().replace(/<[^>]+>/g,"");if(u>=0){let r=u-6,l=u+6;r<0&&(r=0),0==r&&(l=10),l>n.length&&(l=n.length);let s=n.substr(r,l);t.forEach((function(e){let t=new RegExp(e,"gi");s=s.replace(t,'<em class="search-keyword">'+e+"</em>")})),e+='<p class="search-result">'+s+"...</p>"}}})),s.innerHTML=e)}))}})}</script><script>function loadScript(e,t){let a=document.createElement("script");a.type="text/javascript",a.async=!0,a.readyState?a.onreadystatechange=function(){"loaded"!=a.readyState&&"complete"!=a.readyState||(a.onreadystatechange=null,t())}:a.onload=function(){t()},a.src=e,document.getElementsByTagName("body")[0].appendChild(a)}</script><script type="module" src="/js/main.js"></script><script>$(document).ready((function(){$("del").attr("title","你知道的太多了ヾ(▼ﾍ▼；) (#｀皿´メ)"),$(".toc-card").width($("#right-col").width()),$("a.footnote-ref").each((function(t,e){let i=$(this).parents("article").attr("id"),o=$(this).attr("href");e.setAttribute("data-toggle","tooltip"),e.setAttribute("data-html","true"),e.setAttribute("title",$("#"+i+" "+o).html())})),setInterval(()=>{$("#site-bg").fadeTo(1e3,.1,()=>{$("#site-bg").css("background-image",'url("/img/site-bg/bg-'+Math.floor(8*Math.random())+'.jpg")')}),$("#site-bg").fadeTo(2e3,.2)},3e4),siteBgElem=document.getElementById("site-bg"),siteBgElem&&siteBgElem.clientWidth>0&&siteBgElem.clientHeight>0&&loadScript("/js/widget/canvas-nest.js",()=>{new CanvasNest(siteBgElem,{opacity:1,pointColor:"255,255,0",color:"255,255,0",count:30})})})),$(window).on("load",(function(){$("#sidebar-sticky--bottom").height($("#right-col").height()-$("#sidebar").height()-$("#footer").height())})),$((function(){$("[data-toggle='tooltip']").tooltip()}))</script></body></html>