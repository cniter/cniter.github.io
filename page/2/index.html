<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><title>Shaun&#39;s Space</title><meta name="description" content="Shaun之所见所学所想所得"><link rel="icon" href="/img/favicon.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha256-eSi1q2PG6J7g7ib17yAaWMcrr5GrtohYChqibrV7PBE=" crossorigin="anonymous"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/fork-awesome/1.1.5/css/fork-awesome.min.css" integrity="sha256-P64qV9gULPHiZTdrS1nM59toStkgjM0dsf5mK/UwBV4=" crossorigin="anonymous"><script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><script src="//cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha256-ZvOgfh+ptkpoa2Y4HkRY28ir89u/+VRyDE7sB7hEEcI=" crossorigin="anonymous"></script><script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha256-VsEqElsCHSGmnmHXGQzvoWjWwoznFSZc6hs7ARLRacQ=" crossorigin="anonymous"></script><script src="//cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/pace.min.js" integrity="sha256-EPrkNjGEmCWyazb3A/Epj+W7Qm2pB9vnfXw+X6LImPM=" crossorigin="anonymous"></script><script src="//cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/gitalk/1.6.2/gitalk.min.css" integrity="sha512-rx3CPzDhA62PgmbTqj/Z/FHBR9/CrMcHtuylW9I75in7eONhEBFpcFmfjCTKwn9sFyKY1Nwbl0hM7QMbk/I3bg==" crossorigin="anonymous"><script src="//cdnjs.cloudflare.com/ajax/libs/gitalk/1.6.2/gitalk.min.js" integrity="sha512-rdP841RJYVS0QrnTWV27dz7sJL/bhNTdOlXSy5uI+chevnZyFVmtN+zq+w6njz4wMWKu9yFVTUWHTqIbUq/6Vw==" crossorigin="anonymous"></script><link rel="stylesheet" href="/css/style.css"><style>body{cursor:url(/img/cursor/normal.cur),auto}#navbar-toggler--btn,.highlight-wrap[data-lang]::before,a,button{cursor:url(/img/cursor/link.cur),auto}</style><script>const bdshareURL = "/plugins/baidushare/";</script></head><body><!--[if lt IE 9]>
        <link rel="stylesheet" href="/css/ie9.css">
        <div class="alert alert-danger topframe" role="alert">
            嘿，朋友！您的浏览器已<strong>过期</strong>，不建议继续食用。
            <a target="_blank" class="alert-link" href="http://browsehappy.com">这里</a> 有些新玩意儿，何不试试？
        </div>
    <![endif]--><header id="header"><nav id="navbar" class="navbar navbar-expand-md"><div class="container"><h1 id="site-title"><a href="/" class="navbar-brand"><img src="/img/favicon.png"> <span>Shaun&#39;s Space</span></a></h1><button id="navbar-toggler--btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapsibleNavbar"><span><i class="fa fa-list-ul" aria-hidden="true"></i></span></button><div class="collapse navbar-collapse" id="collapsibleNavbar"><ul class="navbar-nav"><li class="nav-item"><a class="nav-link" href="/" title="首页" data-toggle="tooltip" data-placement="bottom"><i class="nav-icon fa fa-home"></i> 首页</a></li><li class="nav-item"><a class="nav-link" href="/archives" title="所有文章" data-toggle="tooltip" data-placement="bottom"><i class="nav-icon fa fa-archive"></i> 归档</a></li><li class="nav-item"><a class="nav-link" href="/categories" title="全部分类" data-toggle="tooltip" data-placement="bottom"><i class="nav-icon fa fa-folder"></i> 分类</a></li><li class="nav-item"><a class="nav-link" href="/tags" title="全部标签" data-toggle="tooltip" data-placement="bottom"><i class="nav-icon fa fa-tags"></i> 标签</a></li><li class="nav-item"><a class="nav-link" href="/about" title="关于本站" data-toggle="tooltip" data-placement="bottom"><i class="nav-icon fa fa-user"></i> 关于</a></li></ul></div></div></nav></header><div class="container"><div class="row"><aside id="left-col" class="col-md-1"></aside><main class="col-lg-8 col-sm-12"><article id="post-一张纹理做天空盒" class="article div-border"><header class="article-header"><span class="article-date article-title--index"><i class="fa fa-calendar" aria-hidden="true"></i> <a href="/posts/39a3c99e.html"><time datetime="2020-08-01T14:46:32.000Z">2020-08-01</time></a></span><section class="article-title article-title--index"><a href="/posts/39a3c99e.html">一张纹理做天空盒</a></section><div class="article-label"><div class="article-category label"><i class="fa fa-book" aria-hidden="true"></i> <a class="color1 article-category-link" href="/categories/Image-Graphic/">Image&Graphic</a></div><div class="article-tag label"><i class="fa fa-bookmark" aria-hidden="true"></i> <a class="color2 article-tag-link" href="/tags/algorithm/">algorithm</a></div></div></header><section class="article-content"><div class="article-content--excerpt"><h2 id="前言">前言</h2><p>　　前段时间做了一件很有意思的事，使用一张普通纹理图片做成了一个天空盒（SkyBox），其实是半个，因为最终形成的天空盒是上下对称的，看起来有天空之境的感觉。</p></div><div class="article-content--all"><h2 id="前言">前言</h2><p>　　前段时间做了一件很有意思的事，使用一张普通纹理图片做成了一个天空盒（SkyBox），其实是半个，因为最终形成的天空盒是上下对称的，看起来有天空之境的感觉。</p><a id="more"></a><h2 id="天空盒篇">天空盒篇</h2><p>　　常见的天空盒一般采用立方体包围盒做 geometry，再使用 CubeMap 将 6 张纹理图贴到立方体包围盒上，但是如果只用一张纹理图片，要映射到立方体包围盒上，无论怎么展 UV，都会造成部分棱和顶点 UV 聚集或突变，从而在这样的地方造成贴图扭曲或错位的不协调现象。</p><p>　　既然立方体包围盒不可行，就只有采用另一种 geometry —— 球 了，但是直接用球作为 geometry 会造成两种问题：1、球的极点处会有扭曲现象，因为球极点处的 UV 是聚集的，同一个位置，V 都为 1 或 0，而 U 则为 [0, 1] 都有，即在该位置处一个 V 对应多个 U，自然会造成扭曲；2、由于球是一个圆周，所以 U 为 0 的位置和 U 为 1 的位置是同一个，对于一张普通纹理图，这就会造成错位，能看到非常明显的接缝线。所以需要重新展开球面的 UV，而常见的展 UV 方法主要有以下几种：</p><ol type="1"><li>对于平面，uv 坐标自然通过线性归一化解决，取左下角坐标和右上角坐标，得到平面的宽度和长度，再用当前坐标减去左下角坐标，最后除以平面宽度和长度得到 uv 坐标。</li><li>对于球面，自然是取水平方位角 <span class="math inline">\(θ, \theta \in [-\pi, \pi]\)</span> 和 垂直仰角 <span class="math inline">\(φ, φ\in [0, \pi]\)</span> 作为 uv 坐标。对于 threejs 而言，方位角在 XZ 平面上，可计算 <span class="math inline">\(\theta = Math.atan2(z, x)\)</span>，仰角 <span class="math inline">\(φ = Math.acos(-y)\)</span>，其中 <span class="math inline">\(x,y,z\)</span> 为当前坐标归一化后的值，则 <span class="math inline">\(u = (θ +\pi)/(2*\pi)\)</span>，<span class="math inline">\(v=φ/\pi\)</span>。</li><li>对于一般的曲面，可能会依据当前顶点的法线计算 uv 坐标。对法线向量 x,y,z 三个分量的值进行排序，取最小的两个作为 uv，或者将最小的两个除以最大的一个作为 uv（CubeMap 中通常用这种进行 6 个面的纹理映射，最大的那个决定映射 6 个面中的哪一面），或者取固定的两个分量作为 uv ，或者得到最小的两个分量索引取对应顶点坐标的分量值作为 uv 等等，若 uv 取值为 [-1,1]，则还需要做 <span class="math inline">\(uv = uv *0.5+0.5\)</span> 。根据法线计算 uv 一般需要根据不同的使用情况选择不同的 uv 计算策略。</li></ol><p>　　Shaun 很快的解决了第二个问题，想要将一张普通纹理图片贴在整个球面上而不留下接缝线是不现实的，而铺在半个球面上，另一半球面做对称，这个是可行的，而且看起来的效果也不错，计算 uv 就很简单了，原始的 v 不需要改变，只需要将 u 从 [0, 0.5] 映射为 [0, 1]，从 [0.5, 1] 映射为 [1, 0]，即 <span class="math display">\[ f(u)=\begin{cases} 2*u,　0 \le u \le 0.5 \\ 2*(1-u),　0.5 \le u \le 1 \end{cases} \]</span> ，接缝线问题使用对称性巧妙的解决了，但第一个问题，极点扭曲现象，还是没法解决，接下来才是真正的难点 ╯︿╰。</p><p>　　为了解决极点扭曲问题，首先需要知道极点扭曲的根本原因是同一个位置对应了多个 uv，所以要么将这些 uv 给散开，要么抛弃一部分 uv，散开 uv 的方式 Shaun 没想出来，抛弃一部分 uv 倒是有一种简单的方式，不过抛弃 uv 也意味着会损失一部分纹理，就这个天空盒而言，抛弃一部分 uv 是能接受的，不然平面到球面必然有形变。具体抛弃方法为，将球面铺平，变为一个大圆面，即忽略球面顶点坐标的 z 值，求出球的 AABB，将 AABB 铺平，即为大圆的外接正方形，用计算平面 uv 的方式重新球上各顶点的 uv 坐标，这种方式的确能解决极点扭曲的问题，但又带来了一个更为严重的问题。</p><p>　　这个问题就是，球面上半部分显示很正常，但是越靠近底部大圆的部分，纹理拉伸的越厉害，造成天空盒四周都出现很严重的纹理拉伸现象。出现纹理拉伸现象的原因也很好理解，那就是越靠近底部大圆的顶点，uv 坐标之间的间隔越小，即同样的 uv 间隔，顶点之间的距离变大了，在进行纹理插值时，自然会导致纹理拉伸现象。知道问题出现的原因了，那怎么解决了？这又是一个新问题 😔。</p><p>　　导致纹理拉伸现象的原因是线性映射，那能不能对计算好的 uv 进行非线性映射，从而抵消 OpenGL 线性纹理插值的影响，非线性映射最重要的是找到合适的非线性函数，常见非线性函数一般有幂函数（伽马变换就是一种幂函数变换，幂 &lt; 1 拉伸小值，幂 &gt; 1 拉伸大值），对数函数，指数等，对于 Shaun 这里的情况，常规的非线性函数肯定是不行的，只能自己想一个函数。</p><p>　　注意到，这是在球面上，要取一个非线性映射函数，自然需要从圆的弧长入手，先计算圆的弧长。计算弧长的本质是勾股定理 <span class="math inline">\(ds=\sqrt{(dx)^2 + (dy)^2} = \sqrt{1+(dy/dx)^2} * dx\)</span>，对于圆 <span class="math inline">\(x^2 + y^2 = r^2,　y \ge 0\)</span>，即 <span class="math inline">\(y=\sqrt{r^2-x^2}\)</span>，有 <span class="math inline">\(dy/dx = -x/ \sqrt{r^2-x^2}\)</span>，则对于圆的弧长 <span class="math inline">\(L=\int \sqrt{1+x^2/(r^2-x^2)}dx = r \int 1/ \sqrt{1-(x/r)^2}d(x/r) = r*arcsin(x/r)|\)</span>，即对于圆在第一象限的弧长可以为 <span class="math inline">\(L=r*arcsin(x/r),　0\le x \le r\)</span> 。</p><p>　　由于 v 是均匀的，所以只需要对 u 进行拉伸即可，离圆心越近的点，则越接近 0.5， 离圆心越远的点则越偏离 0.5，非线性拉伸公式为 $ u = α * (u-0.5) + 0.5$，其中 <span class="math inline">\(α = L / (\pi*r/2),　L中的x为点到圆心的距离\)</span>，使用这种拉伸后，天空盒四周的纹理拉伸现象确实不见了，但是又引入了新的问题，天空盒顶部出现了局部拉伸现象，出现微弱的纹理模糊，虽然区域不大，依靠一些手段可以让用户看不到这块区域，但是不能自欺欺人，这一块存在总让 Shaun 觉得很不舒服，于是，就有了下面的终极解决方案。</p><p>　　Shaun 最终想出解决方案是：既然单纯的拉伸不能完美解决问题，那还是只能从问题根源入手，完全重新计算 uv 坐标，这次计算 uv 坐标，还是需要借助上文的 <span class="math inline">\(α\)</span>。具体计算 uv 坐标的方式如下：</p><ol type="1"><li>先计算球面上顶点相对大圆圆心的角度，即 <span class="math inline">\(angle = Math.atan2(y - center.y, x - center.x)\)</span>，其中 center 即为大圆圆心（0, 0）。</li><li>根据顶点到圆心的距离得到 <span class="math inline">\(\alpha\)</span>，计算 <span class="math inline">\(α_x = α * cos(angle)， α_y=α * sin(angle)\)</span> 。</li><li>计算 uv：<span class="math inline">\(u = α_x * 0.5 + 0.5， v=α_y*0.5+0.5\)</span> 。</li></ol><p>　　使用这个方式计算 uv，天空盒的全部问题都解决了，天空盒没有任何拉伸扭曲等令人看起来不协调的地方，至于对称也说的过去，Shaun 个人感觉挺漂亮的 (￣▽￣)&quot;。自此天空盒的事就算是告一段落了。</p><h2 id="后记">后记</h2><p>　　做这个天空盒，确实花费了 Shaun 了不少力气，在做的那两天，满脑子都是为什么会拉伸扭曲，以及如何解决拉伸扭曲，最终想出了这套方案，简单优雅，最后的效果也是完美达到了 Shaun 的预期。不过一般人应该也用不到 Shaun 这套方案，这只是 Shaun 自己想做做而已，搞不出来没关系，搞出来当然是好的。</p></div><div class="article-content-more"><button type="button" class="article-more--link"><i class="fa fa-angle-double-down fa-3x" aria-hidden="true"></i></button></div></section></article><article id="post-Windows-Terminal-尝鲜小记" class="article div-border"><header class="article-header"><span class="article-date article-title--index"><i class="fa fa-calendar" aria-hidden="true"></i> <a href="/posts/a250bb21.html"><time datetime="2020-07-26T08:52:42.000Z">2020-07-26</time></a></span><section class="article-title article-title--index"><a href="/posts/a250bb21.html">Windows Terminal 尝鲜小记</a></section><div class="article-label"><div class="article-category label"><i class="fa fa-book" aria-hidden="true"></i> <a class="color2 article-category-link" href="/categories/Share/">Share</a></div><div class="article-tag label"><i class="fa fa-bookmark" aria-hidden="true"></i> <a class="color5 article-tag-link" href="/tags/record/">record</a></div></div></header><section class="article-content"><div class="article-content--excerpt"><h2 id="前言">前言</h2><p>　　Windows Terminal 正式版在两个月之前终于发布了，正好最近找了点时间尝尝鲜，感觉确实可以，Cmder 可以退休了。</p></div><div class="article-content--all"><h2 id="前言">前言</h2><p>　　Windows Terminal 正式版在两个月之前终于发布了，正好最近找了点时间尝尝鲜，感觉确实可以，Cmder 可以退休了。</p><a id="more"></a><h2 id="尝鲜篇">尝鲜篇</h2><p>　　直接在 <a href="https://aka.ms/terminal" target="_blank" rel="external">Microsoft Store</a> 安装，顺便安装好 <a href="https://docs.microsoft.com/en-us/windows/terminal/tutorials/powerline-setup" target="_blank" rel="external">Powerline</a>，执行以下三个命令：</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false" data-lang="POWERSHELL"><figure class="highlight hljs powershell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Install-Module posh-git -Scope CurrentUser</div><div class="line">Install-Module oh-my-posh -Scope CurrentUser</div><div class="line">Install-Module -Name PSReadLine -Scope CurrentUser -Force -SkipPublisherCheck // 使用 powershell core 则必选</div></pre></td></tr></table></figure></div><p>然后执行 <code>notepad $PROFILE</code> ，在弹出的记事本中添加：</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false" data-lang="POWERSHELL"><figure class="highlight hljs powershell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">Import-Module</span> posh-git</div><div class="line"><span class="built_in">Import-Module</span> oh-my-posh</div><div class="line">Set-Theme Paradox</div></pre></td></tr></table></figure></div><p>重启 terminal，若出现 “无法加载文件 ***.ps1, 因为此系统上禁止运行脚本”，则需要执行 <code>set-executionpolicy RemoteSigned</code>，使powershell 能顺利执行该脚本。</p><p>　　由于目前 Windows Terminal 不会自动注册右键快捷菜单，所以需要手动修改注册表，执行 <code>mkdir &quot;%USERPROFILE%\AppData\Local\terminal&quot;</code> 后，在网上找一个终端图标，命名为 wt_32.ico，将该图标复制到 <code>%USERPROFILE%\AppData\Local\terminal</code> 目录中， 新建 wt.reg 文件后直接双击执行，该注册表文件的内容如下：</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false" data-lang="PLAIN"><figure class="highlight hljs plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">Windows Registry Editor Version 5.00</div><div class="line"></div><div class="line">[HKEY_CLASSES_ROOT\Directory\Background\shell\wt]</div><div class="line">@=&quot;Windows terminal here&quot;</div><div class="line">&quot;Icon&quot;=&quot;%USERPROFILE%\\AppData\\Local\\terminal\\wt_32.ico&quot;</div><div class="line"></div><div class="line">[HKEY_CLASSES_ROOT\Directory\Background\shell\wt\command]</div><div class="line">@=&quot;C:\\Users\\[user_name]\\AppData\\Local\\Microsoft\\WindowsApps\\wt.exe&quot;</div></pre></td></tr></table></figure></div><p>其中 [user_name] 是使用者电脑的用户名，wt_32.ico 可以是随便找的一张缩略图，也可以直接用 <a href="https://github.com/yanglr/WindowsDevTools/tree/master/awosomeTerminal/icons" target="_blank" rel="external">icons - yanglr</a> 中的 wt_32.ico。</p><p>　　为了简单美化一下 Windows Terminal 界面，需要安装 <a href="https://github.com/microsoft/cascadia-code/releases" target="_blank" rel="external">Cascadia Code GitHub releases page</a> 中 Cascadia Code PL 或 Cascadia Mono PL 字体，Shaun 因为只是尝鲜所以就简单配置了一下：</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false" data-lang="PLAIN"><figure class="highlight hljs plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">&quot;theme&quot;: &quot;dark&quot;,</div><div class="line">&quot;profiles&quot;:</div><div class="line">&#123;</div><div class="line">    &quot;defaults&quot;:</div><div class="line">    &#123;</div><div class="line">        // Put settings here that you want to apply to all profiles.</div><div class="line">    &#125;,</div><div class="line">    &quot;list&quot;:</div><div class="line">    [</div><div class="line">        &#123;</div><div class="line">            // Make changes here to the powershell.exe profile.</div><div class="line">            &quot;guid&quot;: &quot;&#123;61c54bbd-c2c6-5271-96e7-009a87ff44bf&#125;&quot;,</div><div class="line">            &quot;name&quot;: &quot;Windows PowerShell&quot;,</div><div class="line">            &quot;commandline&quot;: &quot;powershell.exe&quot;,</div><div class="line">            &quot;hidden&quot;: false,</div><div class="line">            &quot;startingDirectory&quot; : &quot;.&quot;,</div><div class="line">            &quot;acrylicOpacity&quot; : 0.00000001,</div><div class="line">            &quot;colorScheme&quot; : &quot;Campbell&quot;,</div><div class="line">            &quot;cursorColor&quot; : &quot;#00CCFF&quot;,</div><div class="line">            &quot;fontFace&quot; : &quot;Cascadia Mono PL&quot;,</div><div class="line">            &quot;useAcrylic&quot; : true</div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">            // Make changes here to the cmd.exe profile.</div><div class="line">            &quot;guid&quot;: &quot;&#123;0caa0dad-35be-5f56-a8ff-afceeeaa6101&#125;&quot;,</div><div class="line">            &quot;name&quot;: &quot;命令提示符&quot;,</div><div class="line">            &quot;commandline&quot;: &quot;cmd.exe&quot;,</div><div class="line">            &quot;hidden&quot;: false</div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">            &quot;guid&quot;: &quot;&#123;b453ae62-4e3d-5e58-b989-0a998ec441b8&#125;&quot;,</div><div class="line">            &quot;hidden&quot;: false,</div><div class="line">            &quot;name&quot;: &quot;Azure Cloud Shell&quot;,</div><div class="line">            &quot;source&quot;: &quot;Windows.Terminal.Azure&quot;</div><div class="line">        &#125;</div><div class="line">    ]</div><div class="line">&#125;,</div></pre></td></tr></table></figure></div><p>　　为了在 VSCode 中使用 Windows Terminal ，需要简单设置一下默认终端，首先将设置默认终端 <code>&quot;terminal.integrated.shell.windows&quot;</code> 注释掉或者直接不设置，添加设置：</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false" data-lang="PLAIN"><figure class="highlight hljs plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&quot;terminal.external.windowsExec&quot;: &quot;C:\\Users\\[user_name]\\AppData\\Local\\Microsoft\\WindowsApps\\wt.exe&quot;,</div><div class="line">&quot;terminal.integrated.fontFamily&quot;: &quot;Cascadia Mono PL&quot;,</div></pre></td></tr></table></figure></div><p>如此可在 VSCode 中集成 Windows Terminal，并将其作为默认终端。</p><h2 id="后记">后记</h2><p>　　在这两三天的使用过程中，发现 Windows Terminal 和 Cmder 之间还是存在差距的（如在输入命令过快的时候，tab 键补全跟不上等问题），暂时就两者先并行使用一段时间吧，等后续更新巨硬修复这些问题，相信 Windows Terminal 是能代替 Cmder 成为 Windows 首选终端的。</p><h2 id="参考资料">参考资料</h2><p>[1] <a href="https://blog.csdn.net/qq_44831027/article/details/107068177" target="_blank" rel="external">【避坑】PowerShell：因为在此系统上禁止运行脚本 附原因和解决办法</a></p><p>[2] <a href="https://www.zhihu.com/question/325948326" target="_blank" rel="external">新发布的Windows Terminal如何添加到右键菜单？</a></p><p>[3] <a href="https://offering.solutions/blog/articles/2020/03/24/setting-windows-terminal-as-default-external-terminal-in-visual-studio-code/" target="_blank" rel="external">Setting Windows Terminal as Default External Terminal in Visual Studio Code</a></p></div><div class="article-content-more"><button type="button" class="article-more--link"><i class="fa fa-angle-double-down fa-3x" aria-hidden="true"></i></button></div></section></article><article id="post-快速判断三角形与长方体相交" class="article div-border"><header class="article-header"><span class="article-date article-title--index"><i class="fa fa-calendar" aria-hidden="true"></i> <a href="/posts/ff29de94.html"><time datetime="2020-02-02T14:06:39.000Z">2020-02-02</time></a></span><section class="article-title article-title--index"><a href="/posts/ff29de94.html">快速判断三角形与长方体相交</a></section><div class="article-label"><div class="article-category label"><i class="fa fa-book" aria-hidden="true"></i> <a class="color2 article-category-link" href="/categories/Image-Graphic/">Image&Graphic</a></div><div class="article-tag label"><i class="fa fa-bookmark" aria-hidden="true"></i> <a class="color5 article-tag-link" href="/tags/algorithm/">algorithm</a><a class="color5 article-tag-link" href="/tags/geometry/">geometry</a></div></div></header><section class="article-content"><div class="article-content--excerpt"><h2 id="前言">前言</h2><p>　　一种快速判断空间中三角形与 box 相交的方法，出自论文：<em>Tomas Akenine-Moller. Fast 3D triangle-box overlap testing. A. K. Peters, Ltd. 2002.</em></p></div><div class="article-content--all"><h2 id="前言">前言</h2><p>　　一种快速判断空间中三角形与 box 相交的方法，出自论文：<em>Tomas Akenine-Moller. Fast 3D triangle-box overlap testing. A. K. Peters, Ltd. 2002.</em></p><a id="more"></a><h2 id="预备篇">预备篇</h2><p>　　该论文的理论基础来自分离轴理论（separating axis theorem， AST），AST 常用于检测两凸多边形是否相交。一句话描述 AST 即为：若两多边形能用一条直线分隔开，则两多边形不相交。如何判断该直线存在即为 AST 的关键。常用的判断方法为找出两多边形所有边向量（多边形相邻两点构成的向量，顺时针或逆时针都行）的法向量，使用向量点积分别计算两多边形在各法向量上的投影（一般以多边形上的点和原点构成一个向量与法向量做点积），从而得到两个投影集合，判断两集合是否相交（找出两个集合的最大值和最小值，若最小值大于最大值，则不相交），若不相交，则 AST 中的直线存在，即两多边形不相交，若相交，则继续判断在其它法向量上的投影，若所有法向量上的投影都相交，则两凸多边形相交。AST 常用于二维下判断两凸多边形的相交情况，三维下的情况比较复杂。</p><h2 id="正文篇">正文篇</h2><p>　　该论文给定 13 个向量，若 box 的边和三角形的边在这 13 个向量中的投影均相交，则认为 box 与三角形相交。为简化运算，box 直接假定为轴向包围盒（axis-aligned bounding box， AABB），坐标轴原点为 box 中心，由于可以将普通 box 通过旋转平移等一系列变换，变成以原点为中心的 AABB， 所以该假定是有效的。设三角形的顶点为 <span class="math inline">\(v_0, v_1, v_2\)</span> ，box 的<strong>一半</strong>长宽高为 <span class="math inline">\(h_x, h_y, h_z\)</span> ，则这 13 个向量分别为 <span class="math inline">\(e_0(1, 0, 0), e_1(0, 1, 0), e_2(0, 0, 1)\)</span> ，三角形的法向量 <span class="math inline">\(n\)</span> （通过三角形两边向量叉乘得到），剩下九个向量分别为 <span class="math inline">\(a_{ij} = e_i \times f_j , i,j \in \{0, 1, 2\}\)</span> ，其中 <span class="math inline">\(f\)</span> 为三角形的边向量 <span class="math inline">\(f_0 = v_1 - v_0, f_1 = v_2 - v_1, f_2 = v_0 - v_2\)</span> ， <span class="math inline">\(\times\)</span> 代表向量叉乘。若直接这样一个个的计算投影是否相交，虽然能达到目的，但快速就无法体现了，所以作者根据向量计算方法和一些策略将其中一些需要计算投影的地方极大的简化了，所以加快的计算速度。具体简化过程为：</p><ol type="1"><li><p>首先来看最后九个向量，<span class="math inline">\(a_{00} = e_0 \times f_0 = (0, -f_{0z}, f_{0y})\)</span> ，三角形三个顶点在在该向量上的投影分别为：</p><p><span class="math inline">\(p_0 = a_{00} \cdot v_0 = (0, -f_{0z}, f_{0y}) \cdot v_0 = v_{0z}v_{1y} - v_{0y}v_{1z}\)</span></p><p><span class="math inline">\(p_1 = a_{00} \cdot v_1 = (0, -f_{0z}, f_{0y}) \cdot v_1 = v_{0z}v_{1y} - v_{0y}v_{1z} = p_0\)</span></p><p>$p_2 = a_{00} v_2 = (0, -f_{0z}, f_{0y}) v_2 = (v_{1y} - v_{0y})v_{2z} - (v_{1z} - v_{0z})v_{2y} $</p><p>由于 <span class="math inline">\(p_0 == p_1\)</span>， 所以在求最大最小值时只需要做一次比较，接着求 box 在该向量上的投影，box 中心在原点，所以投影半径 <span class="math inline">\(r\)</span> 可以以一种简单的方式求出：</p><p><span class="math inline">\(r = h_x|a_{00x}| + h_y|a_{00y}| + h_z|a_{00z}| = h_y|a_{00y}| + h_z|a_{00z}|\)</span></p><p>计算投影是否重合也很简单：</p><p><span class="math inline">\(if(min(p_0, p_2) &gt; r \ || \ max(p_0, p_2) &lt; -r) \quad return \ false\)</span> 否则两者投影相交，继续计算其它向量。</p></li><li><p>三个轴向单位向量 e 中的投影是否重合就更好判断了，完全不需要计算投影，只需要计算三角形的最小 AABB，判断两个 AABB 是否相交即可（取两个 AABB 最小的顶点和最大的顶点，从三维上判断最小是否的大于最大的即可，若任意一个维度上最小的比最大的大，则两者不相交），</p></li><li><p>至于判断最后一个向量——三角形的法向量上的投影是否重合，相当于判断三角形所在平面是否与 box 相交。判断 box 与平面相交有一种简单快速的方式，即通过公式 <span class="math inline">\(|d| &lt;= a_1 |n \cdot A^1| + a_2|n \cdot A^2| + a_3 |n \cdot A^3|\)</span> ，其中 <span class="math inline">\(d\)</span> 为 box 中心到平面的距离（中心点到平面上一点构成的向量与平面法向量做点积），<span class="math inline">\(n\)</span> 为平面法向量，<span class="math inline">\(A^1\)</span> 为 box 侧面法向量，对于 AABB 可为 <span class="math inline">\((1, 0, 0)\)</span>，<span class="math inline">\(a_1\)</span> 为 box 中心到侧面的距离，对于 AABB 可为 <span class="math inline">\(h_x\)</span>，同理 <span class="math inline">\(A^2\)</span> 为 box 顶面法向量，对于 AABB 可为 <span class="math inline">\((0, 1, 0)\)</span>，<span class="math inline">\(a_2\)</span> 为 box 中心到顶面距离，对于 AABB 可为 <span class="math inline">\(h_y\)</span>，<span class="math inline">\(A^3\)</span> 为 box 正面法向量，对于 AABB 可为 <span class="math inline">\((0, 0, 1)\)</span>，<span class="math inline">\(a_3\)</span> 为 box 中心到正面距离，对于 AABB 可为 <span class="math inline">\(h_z\)</span>，即在 AABB 中，该公式可简化为 <span class="math inline">\(|d| &lt;= h_x|n_x| + h_y|n_y| + h_z|n_z|\)</span> ，满足该公式，即可判定平面与 AABB 相交。</p></li></ol><p>　　如此 13 个向量全部判断完毕，如全都相交，则可认定三角形与长方体相交，若其中一个不相交，则三角形与长方体不相交。三维的都能判断，二维的三角形与矩形相交判断就更简单了，分成两类法向量后，利用向量运算先简化运算量，再计算投影是否相交即可。</p><h2 id="附录">附录</h2><p>　　还有一种根据距离判断两个 AABB 是否相交的办法，即先取两个 AABB 的中心 <span class="math inline">\((x_1, y_1, z_1)\)</span> 和 <span class="math inline">\((x_2, y_2, z_2)\)</span>，然后计算两个中心点之间的三个维度的距离，将 x 维度的距离与两个AABB 的 <span class="math inline">\(h_x\)</span> 之和比较，若中心点 x 维度的距离较大，则不相交。即：<span class="math inline">\(if (|x_1 - x_2| &gt; h_{x1} + h_{x2}) \quad return \ false\)</span> ，否则比较 y 维度， z 维度，若所有都小，则两 AABB 相交。这种方式是 Shaun 在一次面试中被问到没答出后在网上找到的答案，其实感觉和比较最小最大顶点也差不多，都是从不相交出发，因为直接判断相交基本不可能，而不相交很容易判断，把所有的不相交情况判断完，那就只剩相交了，可惜面试官只想要这种方案 ╮(╯▽╰)╭。</p><h2 id="参考资料">参考资料</h2><p>[1] <a href="http://fileadmin.cs.lth.se/cs/Personal/Tomas_Akenine-Moller/code/" target="_blank" rel="external">Code by Tomas Akenine-Möller</a></p><p>[2] <a href="https://www.gamasutra.com/view/feature/131790/simple_intersection_tests_for_games.php?print=1" target="_blank" rel="external">Simple Intersection Tests For Games</a></p></div><div class="article-content-more"><button type="button" class="article-more--link"><i class="fa fa-angle-double-down fa-3x" aria-hidden="true"></i></button></div></section></article><article id="post-网页菜单纯-css-实现" class="article div-border"><header class="article-header"><span class="article-date article-title--index"><i class="fa fa-calendar" aria-hidden="true"></i> <a href="/posts/70a807da.html"><time datetime="2019-10-28T02:18:36.000Z">2019-10-28</time></a></span><section class="article-title article-title--index"><a href="/posts/70a807da.html">网页菜单纯 css 实现</a></section><div class="article-label"><div class="article-category label"><i class="fa fa-book" aria-hidden="true"></i> <a class="color3 article-category-link" href="/categories/Study/">Study</a></div><div class="article-tag label"><i class="fa fa-bookmark" aria-hidden="true"></i> <a class="color1 article-tag-link" href="/tags/css/">css</a></div></div></header><section class="article-content"><div class="article-content--excerpt"><h2 id="前言">前言</h2><p>　　最近搞了些前端的工作，本来做菜单栏的时候想直接用 bootstrap 的，但是感觉 bootstrap 太大了，而且依赖有点多，在 webpack 中也不是很好打包（虽然可以绕过去），所以就索性自己在网上找了一些实现方式，改改感觉也还可以。这次主要实现了两种菜单栏，具体如下。</p></div><div class="article-content--all"><h2 id="前言">前言</h2><p>　　最近搞了些前端的工作，本来做菜单栏的时候想直接用 bootstrap 的，但是感觉 bootstrap 太大了，而且依赖有点多，在 webpack 中也不是很好打包（虽然可以绕过去），所以就索性自己在网上找了一些实现方式，改改感觉也还可以。这次主要实现了两种菜单栏，具体如下。</p><a id="more"></a><h2 id="鼠标悬停下拉菜单">鼠标悬停下拉菜单</h2><p>　　鼠标悬停下拉菜单应该是最常见的一种菜单栏了，当鼠标悬停在菜单栏上时，子菜单缓缓下拉，看起来就很舒服，用 flex 布局结合列表也很好实现（不用像以前那种 <code>float</code> 了，舒服）。具体实现方式如下：</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false" data-lang="HTML"><figure class="highlight hljs html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></div><div class="line"><span class="css">    <span class="selector-class">.flex-body</span> &#123;</span></div><div class="line"><span class="undefined">        display: flex;</span></div><div class="line"><span class="undefined">        flex-direction: column;</span></div><div class="line"><span class="undefined">    &#125;</span></div><div class="line"><span class="undefined"></span></div><div class="line"><span class="undefined">    header &#123;</span></div><div class="line"><span class="undefined">        z-index: 1;</span></div><div class="line"><span class="undefined">    &#125;</span></div><div class="line"><span class="undefined"></span></div><div class="line"><span class="undefined">    ul,</span></div><div class="line"><span class="undefined">    ul li &#123;</span></div><div class="line"><span class="undefined">        list-style: none;</span></div><div class="line"><span class="undefined">        margin: 0;</span></div><div class="line"><span class="undefined">        padding: 0;</span></div><div class="line"><span class="undefined">    &#125;</span></div><div class="line"><span class="undefined"></span></div><div class="line"><span class="css">    <span class="selector-class">.menu</span> &#123;</span></div><div class="line"><span class="undefined">        display: flex;</span></div><div class="line"><span class="undefined">        justify-content: start;</span></div><div class="line"><span class="undefined">    &#125;</span></div><div class="line"><span class="undefined"></span></div><div class="line"><span class="undefined">    ul li &#123;</span></div><div class="line"><span class="undefined">        width: 100px;</span></div><div class="line"><span class="undefined">        height: 50px;</span></div><div class="line"><span class="undefined">        line-height: 50px;</span></div><div class="line"><span class="undefined">    &#125;</span></div><div class="line"><span class="undefined"></span></div><div class="line"><span class="css">    <span class="selector-class">.menu</span> <span class="selector-tag">li</span> <span class="selector-class">.submenu</span> &#123;</span></div><div class="line"><span class="css">        <span class="comment">/* display: none; */</span></span></div><div class="line"><span class="undefined">        background-color: aqua;</span></div><div class="line"><span class="undefined">    &#125;</span></div><div class="line"><span class="undefined"></span></div><div class="line"><span class="css">    <span class="selector-class">.submenu</span> <span class="selector-tag">li</span> &#123;</span></div><div class="line"><span class="undefined">        height: 0;</span></div><div class="line"><span class="undefined">        line-height: 0;</span></div><div class="line"><span class="undefined">        opacity: 0;</span></div><div class="line"><span class="undefined">        visibility: hidden;</span></div><div class="line"><span class="undefined">    &#125;</span></div><div class="line"><span class="undefined"></span></div><div class="line"><span class="css">    <span class="selector-class">.menu</span> <span class="selector-tag">li</span><span class="selector-pseudo">:hover</span> <span class="selector-class">.submenu</span> <span class="selector-tag">li</span> &#123;</span></div><div class="line"><span class="css">        <span class="comment">/* display: block; */</span></span></div><div class="line"><span class="undefined">        height: 50px;</span></div><div class="line"><span class="undefined">        line-height: 50px;</span></div><div class="line"><span class="undefined">        opacity: 1;</span></div><div class="line"><span class="undefined">        visibility: visible;</span></div><div class="line"><span class="undefined">        transition: all 1s;</span></div><div class="line"><span class="undefined">    &#125;</span></div><div class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"flex-body"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">header</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"menu"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">a</span>&gt;</span>menu1<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"submenu"</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span>&gt;</span>submenu1<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span>&gt;</span>submenu1<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span>&gt;</span>submenu1<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">                <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">a</span>&gt;</span>menu2<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"submenu"</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span>&gt;</span>submenu1<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span>&gt;</span>submenu1<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span>&gt;</span>submenu1<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">                <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">a</span>&gt;</span>menu3<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"submenu"</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span>&gt;</span>submenu1<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span>&gt;</span>submenu1<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span>&gt;</span>submenu1<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">                <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">header</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">main</span>&gt;</span>mainmainmainmainmainmainmainmainmainmain<span class="tag">&lt;/<span class="name">main</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure></div><p>　　<strong><em>※注：</em></strong> 实现该菜单栏有两个需要注意的点：1、不能用 <code>display: none</code> 和 <code>block</code> 来使子菜单消失或出现，因为这样会造成缓缓下拉的动画失效，<code>transition</code> 并不支持 <code>display</code>，所以只能用 <code>visibility</code> 和 <code>height</code> 来共同实现，以达到下拉动画效果；2、因为使用了 <code>flex</code> 布局，所以 <code>z-index</code> 只对同级 <code>flex-item</code> 有效，所以为防止菜单栏下面的内容出现在子菜单之上，即将子菜单栏位于最上层，需要将整个页面的布局都设置为 <code>flex</code>，并使 <code>header</code> 的 <code>z-index</code> 最大，如此才能保证子菜单的菜单覆盖 <code>main</code> 中的内容，不然就会有重叠干扰现象。</p><h2 id="鼠标点击手风琴菜单">鼠标点击手风琴菜单</h2><p>　　手风琴特效也算是非常常见的了，一般的手风琴是鼠标悬停展开，这种比较好实现，难的是如何保持这种展开状态，<code>focus</code> 可以短暂保持展开状态，但是不能点击其他地方，局限性太大。所以需要引入其它的东西来记录这种展开状态，可以用 <code>checkbox</code> 或 <code>radio</code> 的 <code>checked</code> 来记录这种状态，从而只用 css 即可实现该菜单，具体实现如下：</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false" data-lang="HTML"><figure class="highlight hljs html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></div><div class="line"><span class="css">    <span class="selector-tag">input</span><span class="selector-attr">[data-prop="menu-recorder"]</span> &#123;</span></div><div class="line"><span class="undefined">        display: none;</span></div><div class="line"><span class="undefined">    &#125;</span></div><div class="line"><span class="undefined"></span></div><div class="line"><span class="css">    <span class="selector-class">.menu-title</span> &#123;</span></div><div class="line"><span class="undefined">        display: block;</span></div><div class="line"><span class="undefined">        width: 500px;</span></div><div class="line"><span class="undefined">        height: 50px;</span></div><div class="line"><span class="undefined">        line-height: 50px;</span></div><div class="line"><span class="undefined">        border: 1px solid black;</span></div><div class="line"><span class="undefined">    &#125;</span></div><div class="line"><span class="undefined"></span></div><div class="line"><span class="css">    <span class="selector-class">.menu-content</span> &#123;</span></div><div class="line"><span class="undefined">        width: 500px;</span></div><div class="line"><span class="undefined">        max-height: 100px;</span></div><div class="line"><span class="undefined">        overflow-y: auto;</span></div><div class="line"><span class="undefined">    &#125;</span></div><div class="line"><span class="undefined"></span></div><div class="line"><span class="css">    <span class="selector-class">.menu-content</span>&gt;<span class="selector-tag">li</span> &#123;</span></div><div class="line"><span class="undefined">        height: 0;</span></div><div class="line"><span class="undefined">        line-height: 20px;</span></div><div class="line"><span class="undefined">        overflow: auto;</span></div><div class="line"><span class="undefined">        opacity: 0;</span></div><div class="line"><span class="undefined">        visibility: hidden;</span></div><div class="line"><span class="undefined">        transition: all 1s;</span></div><div class="line"><span class="undefined">    &#125;</span></div><div class="line"><span class="undefined"></span></div><div class="line"><span class="css">    <span class="selector-tag">input</span><span class="selector-attr">[data-prop="menu-recorder"]</span><span class="selector-pseudo">:checked+.menu-content</span>&gt;<span class="selector-tag">li</span> &#123;</span></div><div class="line"><span class="undefined">        height: 20px;</span></div><div class="line"><span class="undefined">        line-height: 20px;</span></div><div class="line"><span class="undefined">        opacity: 1;</span></div><div class="line"><span class="undefined">        visibility: visible;</span></div><div class="line"><span class="undefined">        transition: all 1s;</span></div><div class="line"><span class="undefined">    &#125;</span></div><div class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"accordion-menu"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">"menu-item"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"menu-title"</span> <span class="attr">for</span>=<span class="string">"menu1"</span>&gt;</span>menu1<span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"menu1"</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">data-prop</span>=<span class="string">"menu-recorder"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"menu-content"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>test<span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>test<span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>test<span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>test<span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>test<span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>test<span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>test<span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">section</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">"menu-item"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"menu-title"</span> <span class="attr">for</span>=<span class="string">"menu2"</span>&gt;</span>menu2<span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"menu2"</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">data-prop</span>=<span class="string">"menu-recorder"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"menu-content"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>test<span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>test<span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>test<span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">section</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">"menu-item"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"menu-title"</span> <span class="attr">for</span>=<span class="string">"menu3"</span>&gt;</span>menu3<span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"menu3"</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">data-prop</span>=<span class="string">"menu-recorder"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"menu-content"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>test<span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>test<span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>test<span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>test<span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">section</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">"menu-item"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"menu-title"</span> <span class="attr">for</span>=<span class="string">"menu4"</span>&gt;</span>menu4<span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"menu4"</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">data-prop</span>=<span class="string">"menu-recorder"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"menu-content"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>test<span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>test<span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>test<span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>test<span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>test<span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">section</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure></div><p>　　这里需要注意一点的就是 height 从 0 到 100% 并不会触发 transition 渐变动画，而是需要确切的高度值变化才能触发，所以上文这里添加了个 <code>&lt;li&gt;</code> 标签，直接在该标签上添加动画，还有一种就是在 <code>.menu-content</code> 上设定确定的 <code>max-height</code>，也能触发动画，但是有个缺点就是前后 <code>max-height</code> 的差距太大时，动画效果就很不理想了，这时可能只能依靠 js 了。上文中 <code>checkbox</code> 也可用 <code>radio</code> 替换，效果略有差异，一个是能全部展开或收起，而另一个则是能且仅能展开一个。</p><h2 id="tab-标签页切换菜单">Tab 标签页切换菜单</h2><p>　　这个菜单和上面那个菜单的实现非常相似，先上代码：</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false" data-lang="HTML"><figure class="highlight hljs html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></div><div class="line"><span class="css">    <span class="selector-class">.tab-menu</span> &#123;</span></div><div class="line"><span class="undefined">        display: flex;</span></div><div class="line"><span class="undefined">        position: relative;</span></div><div class="line"><span class="undefined">        width: 500px;</span></div><div class="line"><span class="undefined">        height: 300px;</span></div><div class="line"><span class="undefined">    &#125;</span></div><div class="line"><span class="undefined"></span></div><div class="line"><span class="css">    <span class="selector-tag">input</span><span class="selector-attr">[data-prop="menu-recorder"]</span> &#123;</span></div><div class="line"><span class="undefined">        display: none;</span></div><div class="line"><span class="undefined">    &#125;</span></div><div class="line"><span class="undefined"></span></div><div class="line"><span class="css">    <span class="selector-class">.menu-title</span> &#123;</span></div><div class="line"><span class="undefined">        display: block;</span></div><div class="line"><span class="undefined">        width: 100px;</span></div><div class="line"><span class="undefined">        line-height: 50px;</span></div><div class="line"><span class="undefined">        text-align: center;</span></div><div class="line"><span class="undefined">        border: 1px solid black;</span></div><div class="line"><span class="undefined">        border-right: 0;</span></div><div class="line"><span class="undefined">        box-sizing: border-box;</span></div><div class="line"><span class="undefined">        transition: all 1s;</span></div><div class="line"><span class="undefined">    &#125;</span></div><div class="line"><span class="undefined"></span></div><div class="line"><span class="css">    <span class="selector-class">.tab-menu</span> <span class="selector-class">.menu-item</span><span class="selector-pseudo">:last-child</span> <span class="selector-class">.menu-title</span> &#123;</span></div><div class="line"><span class="undefined">        border-right: 1px solid black;</span></div><div class="line"><span class="undefined">    &#125;</span></div><div class="line"><span class="undefined"></span></div><div class="line"><span class="css">    <span class="selector-class">.menu-content</span> &#123;</span></div><div class="line"><span class="undefined">        position: absolute;</span></div><div class="line"><span class="undefined">        left: 0;</span></div><div class="line"><span class="undefined">        top: 51px;</span></div><div class="line"><span class="undefined">        height: calc(100% - 50px);</span></div><div class="line"><span class="undefined">        overflow-y: auto;</span></div><div class="line"><span class="undefined">        width: 100%;</span></div><div class="line"><span class="css">        <span class="selector-tag">border</span>: 1<span class="selector-tag">px</span> <span class="selector-tag">solid</span> <span class="selector-id">#000</span>;</span></div><div class="line"><span class="undefined">        box-sizing: border-box;</span></div><div class="line"><span class="undefined">        font-size: 24px;</span></div><div class="line"><span class="undefined">        text-align: center;</span></div><div class="line"><span class="undefined">        opacity: 0;</span></div><div class="line"><span class="undefined">        visibility: hidden;</span></div><div class="line"><span class="undefined">        transition: all 1s;</span></div><div class="line"><span class="undefined"></span></div><div class="line"><span class="undefined">    &#125;</span></div><div class="line"><span class="undefined"></span></div><div class="line"><span class="css">    <span class="selector-tag">input</span><span class="selector-attr">[data-prop="menu-recorder"]</span><span class="selector-pseudo">:checked+.menu-content</span> &#123;</span></div><div class="line"><span class="undefined">        opacity: 1;</span></div><div class="line"><span class="undefined">        visibility: visible;</span></div><div class="line"><span class="undefined">        transition: all 1s;</span></div><div class="line"><span class="undefined">    &#125;</span></div><div class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"tab-menu"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">"menu-item"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"menu-title"</span> <span class="attr">for</span>=<span class="string">"menu1"</span>&gt;</span>menu1<span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"menu1"</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"tab-control"</span> <span class="attr">data-prop</span>=<span class="string">"menu-recorder"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"menu-content"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>test<span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>test<span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>test<span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>test<span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>test<span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>test<span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>test<span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">section</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">"menu-item"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"menu-title"</span> <span class="attr">for</span>=<span class="string">"menu2"</span>&gt;</span>menu2<span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"menu2"</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"tab-control"</span> <span class="attr">data-prop</span>=<span class="string">"menu-recorder"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"menu-content"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>test<span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>test<span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>test<span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">section</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">"menu-item"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"menu-title"</span> <span class="attr">for</span>=<span class="string">"menu3"</span>&gt;</span>menu3<span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"menu3"</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"tab-control"</span> <span class="attr">data-prop</span>=<span class="string">"menu-recorder"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"menu-content"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>test<span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>test<span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>test<span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>test<span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">section</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">"menu-item"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"menu-title"</span> <span class="attr">for</span>=<span class="string">"menu4"</span>&gt;</span>menu4<span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"menu4"</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"tab-control"</span> <span class="attr">data-prop</span>=<span class="string">"menu-recorder"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"menu-content"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>test<span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>test<span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>test<span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>test<span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>test<span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">section</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure></div><p>　　从代码上看关键点就是 <code>.menu-content</code> 的定位方式了，采用了绝对定位，并将整个菜单栏设置为相对定位，以保证所有 tab 标签页内容位置和大小保持一致。当然 tab 标签页肯定是唯一的，所以只能用 <code>radio</code> 记录显示标签页了。其中为了保证 <code>.menu-title</code> 和 <code>.menu-content</code> 的边框不重叠，所以在 <code>.menu-title</code> 中只设置 <code>line-height</code>，而 <code>.menu-content</code> 的 <code>top</code> 比其多一个像素。</p><h2 id="后记">后记</h2><p>　　这三种菜单应该是最常见也是用的最多的了，纯 css 实现的方式也比较类似，无非就是 flex 布局以及借助 css3 强大的选择器功能（父类选择器不知要到猴年马月了，比较遗憾 😥），就能相对简单的实现了，当然借助一些 js 库或框架可能会更简单一些 ，但能用 css 为何不用呢 😄。</p><h2 id="参考资料">参考资料</h2><p>[1] <a href="https://blog.csdn.net/colorfulqq/article/details/79886331" target="_blank" rel="external">利用flex实现的二级导航栏</a></p><p>[2] <a href="https://blog.csdn.net/touchingt/article/details/48630291" target="_blank" rel="external">CSS3动画下拉菜单（当transition遇到display的坑）</a></p><p>[3] <a href="https://www.jqhtml.com/962.html" target="_blank" rel="external">CSS3手风琴下拉菜单</a></p><p>[4] <a href="https://www.jianshu.com/p/cc0ac7845ded" target="_blank" rel="external">教你两招用纯CSS写Tab切换</a></p></div><div class="article-content-more"><button type="button" class="article-more--link"><i class="fa fa-angle-double-down fa-3x" aria-hidden="true"></i></button></div></section></article><article id="post-hexo-theme-chi主题更新小记" class="article div-border"><header class="article-header"><span class="article-date article-title--index"><i class="fa fa-calendar" aria-hidden="true"></i> <a href="/posts/26d437be.html"><time datetime="2019-04-06T09:02:39.000Z">2019-04-06</time></a></span><section class="article-title article-title--index"><a href="/posts/26d437be.html">hexo-theme-chi主题更新小记</a></section><div class="article-label"><div class="article-category label"><i class="fa fa-book" aria-hidden="true"></i> <a class="color5 article-category-link" href="/categories/建站小记/">建站小记</a></div><div class="article-tag label"><i class="fa fa-bookmark" aria-hidden="true"></i> <a class="color1 article-tag-link" href="/tags/hexo/">hexo</a></div></div></header><section class="article-content"><div class="article-content--excerpt"><h2 id="前言">前言</h2><p>　　Chi 主题的大体结构功能算是写完了，但是还有一些个性化的东西需要添加，所以以后有关于 Chi 主题更新的部分就都写在这里吧。但是由于是 Shaun 个性化定制的一些东西，所以如果不是大 Bug 或大优化的更新，一般就不进 <a href="https://github.com/cniter/hexo-theme-chi" target="_blank" rel="external">Chi 主题仓库</a> 中了。</p></div><div class="article-content--all"><h2 id="前言">前言</h2><p>　　Chi 主题的大体结构功能算是写完了，但是还有一些个性化的东西需要添加，所以以后有关于 Chi 主题更新的部分就都写在这里吧。但是由于是 Shaun 个性化定制的一些东西，所以如果不是大 Bug 或大优化的更新，一般就不进 <a href="https://github.com/cniter/hexo-theme-chi" target="_blank" rel="external">Chi 主题仓库</a> 中了。</p><a id="more"></a><h2 id="功能篇">功能篇</h2><h3 id="脚注提示功能">1. 脚注提示功能</h3><p><strong>功能描述：</strong> 鼠标悬停在脚注上即可显示对应脚注内容。 Shaun 的脚注由于是采用 pandoc 渲染的，所以也是属于个性化定制，就不将这个功能放进 Chi 主题仓库中了。</p><p><strong>解决方案：</strong> 还是利用 Bootstrap 的 tooltip 提示插件，具体实现代码如下：</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false" data-lang="JAVASCRIPT"><figure class="highlight hljs javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$(<span class="string">'a.footnote-ref'</span>).each(<span class="function"><span class="keyword">function</span> (<span class="params">index, elem</span>) </span>&#123;</div><div class="line">    <span class="keyword">let</span> post_id = $(<span class="keyword">this</span>).parents(<span class="string">'article'</span>).attr(<span class="string">'id'</span>);</div><div class="line">    <span class="keyword">let</span> fn_href = $(<span class="keyword">this</span>).attr(<span class="string">'href'</span>);</div><div class="line">    elem.setAttribute(<span class="string">'data-toggle'</span>, <span class="string">'tooltip'</span>);</div><div class="line">    elem.setAttribute(<span class="string">'data-html'</span>, <span class="string">'true'</span>);</div><div class="line">    elem.setAttribute(<span class="string">'title'</span>, $(<span class="string">"#"</span> + post_id + <span class="string">" "</span> + fn_href).html());</div><div class="line">&#125;);</div></pre></td></tr></table></figure></div><p>遍历脚注，先获取文章 id，再获取对应文章下的对应脚注内容，使用 tooltip 提示。</p><h2 id="bug-篇">Bug 篇</h2><h3 id="图片没居中">1. 图片没居中</h3><p><strong>问题描述：</strong> 上次那篇翻译的文章有几张图片，在放置的时候发现图片没有居中，查看代码后发现居中样式没写，但由于其图片标签 <code>&lt;img&gt;</code> 是放在一个 <code>&lt;figure&gt;</code> 标签中，由于不确定是不是 pandoc 渲染的问题，所以就没将这个修正放进 Chi 主题仓库中了。</p><p><strong>解决办法：</strong> 在 <code>style.styl</code> 文件中添加样式：</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false" data-lang="CSS"><figure class="highlight hljs css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">figure</span> &#123;</div><div class="line">	<span class="attribute">text-align</span>: center;</div><div class="line">&#125;</div></pre></td></tr></table></figure></div><p>即可让图片居中。</p><h2 id="动画篇">动画篇</h2><h3 id="鼠标跟随动画">1. 鼠标跟随动画</h3><p>　　其实一直都想把『奥日与黑暗森林』中的鼠标轨迹特效移植过来，但是苦于水平有限，一直没法做到，恰好 19 年 StackOverflow 的愚人节彩蛋中有个鼠标跟随动画很有意思，有好事者还专门将该彩蛋做了个脚本：<a href="https://meta.stackexchange.com/questions/326037/will-there-be-an-option-to-permanently-keep-this-years-april-fools-design-activ" target="_blank" rel="external">Will there be an option to permanently keep this year’s April Fools design active?</a> 。查看代码，知道实现原理后，发现用 jQuery 和 CSS3 实现一个类似的效果也不算很难，于是 Shaun 就尝试做了一下，并简单的美化了一下，感觉效果还行，就加到自己的个性化主题上了。至于在 Chrome 中的小尾巴和 Firefox 中的卡顿现象，是 Shaun 故意的，因为 Shaun 觉得这个小尾巴很有意思，从这个动画看，Chrome 确实比 Firefox 要流畅一点。最终实现代码如下：</p><p>css 代码：</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false" data-lang="CSS"><figure class="highlight hljs css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.cursor-trail--item</span> &#123;</div><div class="line">    <span class="attribute">display</span>: inline-block;</div><div class="line">    <span class="attribute">line-height</span>: <span class="number">1px</span>;</div><div class="line">    <span class="attribute">position</span>: fixed;</div><div class="line">    <span class="attribute">pointer-events</span>: none;</div><div class="line">    <span class="attribute">touch-action</span>: none;</div><div class="line">    <span class="attribute">z-index</span>: <span class="number">9999999</span>;</div><div class="line">    <span class="attribute">will-change</span>: transform;</div><div class="line">    <span class="attribute">font-size</span>: <span class="number">10px</span>;</div><div class="line">    <span class="attribute">color</span>: <span class="built_in">rgba</span>(186, 227, 240, 0.1);</div><div class="line">    <span class="attribute">text-shadow</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">2px</span> <span class="number">#6CC2F8</span>;</div><div class="line">    <span class="attribute">-webkit-animation</span>: cursorTrail <span class="number">0.9s</span> ease;</div><div class="line">    <span class="attribute">animation</span>: cursorTrail <span class="number">0.9s</span> ease;</div><div class="line">&#125;</div><div class="line"></div><div class="line">@<span class="keyword">keyframes</span> cursorTrail &#123;</div><div class="line">    0% &#123;</div><div class="line">        <span class="attribute">opacity</span>: <span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    20% &#123;</div><div class="line">        <span class="attribute">opacity</span>: <span class="number">0.5</span>;</div><div class="line">        <span class="attribute">transform</span>: <span class="built_in">scale</span>(5);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    100% &#123;</div><div class="line">        <span class="attribute">opacity</span>: <span class="number">0</span>;</div><div class="line">        <span class="attribute">transform</span>: <span class="built_in">translate3D</span>(0, -20px, 0) <span class="built_in">scale</span>(1) <span class="built_in">rotate</span>(90deg);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></div><p>js 代码如下：</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false" data-lang="JAVASCRIPT"><figure class="highlight hljs javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">$(<span class="built_in">document</span>).on(<span class="string">'mousemove'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</div><div class="line">    e.preventDefault();</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.time &amp;&amp; (<span class="built_in">Date</span>.now() - <span class="keyword">this</span>.time) &lt; <span class="number">16</span>) <span class="keyword">return</span>;</div><div class="line">    <span class="keyword">this</span>.time = <span class="built_in">Date</span>.now();</div><div class="line">    <span class="keyword">let</span> trail_character = <span class="string">'•'</span>;</div><div class="line">    <span class="keyword">let</span> mouse_x = e.originalEvent.x || e.originalEvent.layerX || <span class="number">0</span>; </div><div class="line">    <span class="keyword">let</span> mouse_y = e.originalEvent.y || e.originalEvent.layerY || <span class="number">0</span>;</div><div class="line">    mouse_x = mouse_x + <span class="number">20</span>;</div><div class="line">    mouse_y = mouse_y + <span class="number">26</span>;</div><div class="line">    </div><div class="line"></div><div class="line">    $(<span class="string">'#cursor-trail'</span>).append(</div><div class="line">        <span class="string">'&lt;span class="cursor-trail--item" style="left:'</span> </div><div class="line">        + mouse_x </div><div class="line">        + <span class="string">'px;top:'</span> </div><div class="line">        + mouse_y </div><div class="line">        + <span class="string">'px;"&gt;'</span> </div><div class="line">        + trail_character </div><div class="line">        + <span class="string">'&lt;/span&gt;'</span></div><div class="line">    );</div><div class="line"></div><div class="line">    $(<span class="string">'.cursor-trail--item'</span>).each(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">let</span> item = $(<span class="keyword">this</span>);</div><div class="line">        setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; </div><div class="line">            $(item).remove(); </div><div class="line">        &#125;, <span class="number">900</span>);</div><div class="line">    &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></div><p>若不要小尾巴，则只需要将移除元素的时间改快一点就行了，除开上面的代码，还需要在 html 页面中添加一个元素 <code>&lt;span id=&quot;cursor-trail&quot;&gt;&lt;/span&gt;</code> 。</p><h3 id="点击波纹">2. 点击波纹</h3><p>　　一次偶然的机会，看到一篇这样的文章：<a href="https://juejin.im/post/5ba5ab8ce51d450e7762cca5" target="_blank" rel="external">还原一个 Windows 10 Metro 布局</a> 。感觉其中的点击波纹动画很有意思，Shaun 决定把这个动画也放进自己的个性化主题中。至于代码就不贴了，毕竟就是上面文章提供的代码，只是用这个动画的时候发现了 Chrome 的一个问题，就是在进行模糊动画的时候会出现正方形的右边框和下边框，单个模糊不进行动画，不会有边框，进行动画但没模糊也不会有边框，两个同时一起就会出现问题，Firefox 没有这个问题，但 Firefox 存在另一个问题，就是鼠标快速连点的时候，鼠标跟随动画可能会出现问题。浏览器的问题 Shaun 暂时没法解决了，就先这样吧 ╮(╯▽╰)╭。虽然对 Chrome 为啥会出现这样的问题有些猜想，但还是不说出来丢人了，万一不是 Shaun 想的这样就尴尬了 ,,ԾㅂԾ,, 。</p><h2 id="后记">后记</h2><p>有更新再继续更新吧。</p></div><div class="article-content-more"><button type="button" class="article-more--link"><i class="fa fa-angle-double-down fa-3x" aria-hidden="true"></i></button></div></section></article><article id="post-［译］为什么深度学习没有取代传统的计算机视觉" class="article div-border"><header class="article-header"><span class="article-date article-title--index"><i class="fa fa-calendar" aria-hidden="true"></i> <a href="/posts/3578e309.html"><time datetime="2019-03-26T04:50:28.000Z">2019-03-26</time></a></span><section class="article-title article-title--index"><a href="/posts/3578e309.html">［译］为什么深度学习没有取代传统的计算机视觉</a></section><div class="article-label"><div class="article-category label"><i class="fa fa-book" aria-hidden="true"></i> <a class="color3 article-category-link" href="/categories/Share/">Share</a></div><div class="article-tag label"><i class="fa fa-bookmark" aria-hidden="true"></i> <a class="color2 article-tag-link" href="/tags/cv/">cv</a></div></div></header><section class="article-content"><div class="article-content--excerpt"><h2 id="前言">前言</h2><p>　　这是一篇<strong>译文</strong>，译自：<a href="http://zbigatron.com/has-deep-learning-superseded-traditional-computer-vision-techniques/?spm=a2c4e.11153940.blogcont543029.21.3ec3c1c3DsQmF2" target="_blank" rel="external">Why Deep Learning Has Not Superseded Traditional Computer Vision</a>，原作者为：<a href="http://zbigatron.com/author/zbigatron/" target="_blank" rel="external">Zbigatron</a> 。Shaun 水平有限，仅供参考学习，更多内容还请自行查看原文。</p><p>至于为什么要翻译这篇文章，算是回答别人的一个问题吧。</p></div><div class="article-content--all"><h2 id="前言">前言</h2><p>　　这是一篇<strong>译文</strong>，译自：<a href="http://zbigatron.com/has-deep-learning-superseded-traditional-computer-vision-techniques/?spm=a2c4e.11153940.blogcont543029.21.3ec3c1c3DsQmF2" target="_blank" rel="external">Why Deep Learning Has Not Superseded Traditional Computer Vision</a>，原作者为：<a href="http://zbigatron.com/author/zbigatron/" target="_blank" rel="external">Zbigatron</a> 。Shaun 水平有限，仅供参考学习，更多内容还请自行查看原文。</p><p>至于为什么要翻译这篇文章，算是回答别人的一个问题吧。</p><a id="more"></a><h2 id="为什么深度学习还没有取代传统的计算机视觉">为什么深度学习还没有取代传统的计算机视觉？</h2><figure><img src="http://zbigatron.com/wp-content/uploads/2018/01/scale-done_small.jpg" alt="scale-cv-dl"><figcaption>scale-cv-dl</figcaption></figure><p>　　编写这篇文章的原因是在论坛中经常有人问：深度学习是否取代了传统的计算机视觉？或者类似的问题：深度学习效果这么好，还有继续研究传统计算机视觉的必要？</p><p>　　这是个好问题，深度学习（DL）确实彻底改变了计算机视觉（CV）和人工智能，许多曾经看起来不可能解决的问题都解决了，甚至达到了 <a href="https://www.theguardian.com/global/2015/may/13/baidu-minwa-supercomputer-better-than-humans-recognising-images" target="_blank" rel="external">机器的结果比人类更好</a> 的程度，比如图像分类。正如 <a href="http://zbigatron.com/the-reasons-behind-the-recent-growth-of-computer-vision/" target="_blank" rel="external">我之前讨论的</a>，<strong>深度学习确实为计算机视觉做了很大的贡献</strong>。</p><p>　　但是深度学习只是计算机视觉的一个工具，并不是解决所有问题的万能药，所以，在这篇文章中，<strong>我想详细说明一下为什么传统的计算机视觉仍然非常有用</strong>，并且应该继续学习。</p><p>这篇文章主要有一下几个观点：</p><ul><li>深度学习需要大量数据；</li><li>深度学习有时大材小用了；</li><li>传统的计算机视觉可以辅助深度学习。</li></ul><p>　　但是在我开始讨论这些观点之前，需要先解释一下什么是传统的计算机视觉，什么是深度学习，以及深度学习为何这么 dio。</p><h3 id="背景知识">背景知识</h3><p>　　在深度学习之前，如果要实现图像分类这样的功能，需要首先进行 <a href="https://en.wikipedia.org/wiki/Feature_extraction" target="_blank" rel="external">特征提取</a>。特征即为图像中的信息块，能代表图像的部分信息，可以通过 <a href="https://en.wikipedia.org/wiki/Edge_detection" target="_blank" rel="external">边缘检测</a>，<a href="https://en.wikipedia.org/wiki/Corner_detection" target="_blank" rel="external">角点检测</a>，<a href="https://en.wikipedia.org/wiki/Object_detection" target="_blank" rel="external">物体检测</a> 等技术来提取特征。</p><p>　　在进行特征提取和图像分类之类的工作时，一个想法是从一类对象（例如椅子，马等）的图像中提取尽可能多的特征，并将这些特征视为对象的一种定义（比如 <a href="https://en.wikipedia.org/wiki/Bag-of-words_model_in_computer_vision" target="_blank" rel="external">词袋模型</a>），然后在其他图像中查找这些定义，若另一个图像中的特征和定义的特征很相似，则该图像可能包含该特定的对象（如椅子，马等）。</p><p>　　在图像分类中，这种特征提取的难点在于<strong>每个图像都必须选择哪些特征进行查找</strong>，当需要分类的类别开始增加时，比如 10 或 20 种类别，这种方式将变得很麻烦以至于不可能实现。当然也可以考虑角点、边缘和纹理信息，使用不同的特征可以更好的描述不同类别的对象，但是如果选择使用很多特征，则必须处理大量参数，所有这些参数都必须微调。</p><p>　　深度学习中有一个<strong>端到端学习</strong>的概念，其含义为告诉机器要针对每个特定类别对象<strong>学习</strong>需要查找的特征，它为每个对象设计了最具描述性和显著性的特征，换言之，<strong>告诉神经网络要发现图像中每个类别的基本模式</strong>。</p><p>　　因此，通过端到端学习，不需要再决定使用哪种传统的计算机视觉技术来描述特征，机器自动选择好了，<a href="https://www.wired.com/2016/05/the-end-of-code/" target="_blank" rel="external">Wired magazine</a> 说过：</p><blockquote><p>如果想教一个神经网络识别一只猫，不需要让它寻找胡须、耳朵、皮毛和眼睛，只需要给它大量猫的图像，它就会自动识别猫，若它将狐狸错认成猫，不需要重写代码，只需要继续训练即可。</p></blockquote><p>下图表示了特征提取（使用传统计算机视觉）和端到端学习之间的差异：</p><figure><img src="http://zbigatron.com/wp-content/uploads/2018/03/Screen-Shot-2018-03-16-at-3.06.48-PM.png" alt="traditional-cv-and-dl"><figcaption>traditional-cv-and-dl</figcaption></figure><p>　　以上就是需要的背景知识，下面开始深入探讨为什么传统的计算机视觉仍然有存在的必要。</p><h3 id="深度学习需要大量数据">深度学习需要大量数据</h3><p>　　首先，深度学习需要大量的数据，那些著名的图像分类模型就是在海量数据集上训练的，训练数据集中最大的三个是：</p><ul><li><a href="http://www.image-net.org/" target="_blank" rel="external">ImageNet</a> – <strong>150 万张图片</strong>，包含有 1000 个对象类别；</li><li><a href="http://cocodataset.org/" target="_blank" rel="external">Microsoft Common Objects in Context</a> (COCO) – <strong>250 万张图片</strong>，91 个对象类别；</li><li><a href="http://host.robots.ox.ac.uk/pascal/VOC/" target="_blank" rel="external">PASCAL VOC Dataset</a> – <strong>50 万张图片</strong>，20 个对象类别。</li></ul><p>　　一般的图像分类任务不需要这么多图片，但仍然需要很多，如果没办法获得这么多图片怎么办？我们还是得训练我们所有的数据（有些方法可以增多我们的训练数据，但这些都是人工方法）。但是，没有足够的数据支持，训练出来的模型可能会在训练集之外表现不好，因为机器没有洞察能力，无法对没有的数据进行分类。而且无法直观查看训练好的模型并手动调整里面的数据，因为<strong>深度学习模型里面有数百万个参数</strong>，并且这些参数在训练时会自动微调，某种程度上，深度学习模型就是一个黑盒子。</p><p>　　传统的计算机视觉完全透明，可以很清楚的判断自己的解决方案在训练数据之外是否可行，而且<strong>可以深入了解算法中存在的问题</strong>。如果有没法解决的问题，也可以更容易的找出原因并调整。</p><h3 id="深度学习有时大材小用了">深度学习有时大材小用了</h3><p>　　这可能是我支持传统计算机视觉技术研究的最佳理由。</p><p>　　训练深度神经网络需要很长时间，而且需要专门的硬件（高性能 GPU），如果想在普通的笔记本上训练最先进的图像分类模型，可以去外面玩一个星期，回来之后应该还没训练完 ：) 。而且，如果训练好的模型表现不好怎么办？必须调整训练参数并重新开始训练，这个过程有时会重复数百次。</p><p>　　但有时候使用深度学习是完全没有必要的，因为<strong>有时传统的计算机视觉技术可以比深度学习更有效的解决问题并且代码更少</strong>。比如，我曾经做过一个项目来检测传送带上每个罐头是否都有红色的勺子，解决这个问题可以训练深度神经网络来检测勺子，也可以针对红色编写一个简单的阈值分割算法（红色的某个范围内的像素点为白色，其它像素点为黑色），然后计算有多少个白色像素点，后者明显简单的多，一个小时就完成了。</p><p>　　<strong>了解传统的计算机视觉有时会节省大量时间和避免不必要的麻烦</strong>。</p><h3 id="传统计算机视觉提高改进深度学习技能">传统计算机视觉提高改进深度学习技能</h3><p>　　了解传统的计算机视觉可以帮助我们更好地进行深度学习。</p><p>　　例如，计算机视觉中使用的最常见的神经网络是卷积神经网络。但什么是卷积？它实际上是一种广泛使用的图像处理技术（例如 <a href="https://en.wikipedia.org/wiki/Sobel_operator" target="_blank" rel="external">Sobel边缘检测</a>）。了解这一点可以帮助我们了解神经网络正在做什么，并因此可以更好的设计和调整神经网络来解决问题。</p><p>　　深度学习中还可以对图像进行<strong>预处理</strong>，所谓的预处理是指对训练的数据进行一定的处理（Shaun 注：比如图像增强，图像去噪等），这些预处理操作一般由传统的计算机视觉技术完成，比如：当没有足够的训练数据时，可以使用一种叫<strong>数据增强</strong>的技术，使用数据增强让图像进行旋转，平移，裁剪等操作，从而增加“新”图像，通过执行这些操作，可以成倍的增加训练数据集。</p><h3 id="总结">总结</h3><p>　　在这篇文章中，我解释了为什么深度学习还没有取代传统的计算机视觉技术，因此还需要研究后者。首先我发现了深度学习要想表现的足够好需要大量数据的问题，有时候没法获得大量数据，这时只能用传统计算机视觉技术代替；其次，对于特定的任务，使用深度学习可能大材小用了，传统计算机视觉有时比深度学习更有效且代码量也更少；最后了解传统的计算机视觉可以更好的学习深度学习，因为这可以使我们更好的了解深度学习的内部机制，并且可以使用某些预处理操作来改善深度学习结果。</p><p>　　简而言之，深度学习只是计算机视觉的一个工具，不是万能药，不要只是因为它现在很流行所以使用它，传统的计算机视觉技术仍然十分有用，了解它可以节省时间和避免许多麻烦。</p><h2 id="后记">后记</h2><p>　　翻译这篇文章的原因在于，因为某些原因，Shaun 不得不回答一个 “为什么不用深度学习？” 的问题，虽然这里面有极大的因素是客观原因（设备不够 ╮(╯▽╰)╭），但 Shaun 不能明说，正好在网上看到这篇文章，加上也看到过一个问题（类似于 “既然已经能用深度学习做高层次的工作，为何还要用深度学习做底层的工作？”，比如深度学习能做全景分割（可以说是基本完成了图像理解），为何还要做目标检测，图像分割），预计以后有很大的概率也会被问到，所以就需要借用文中的一些观点来进行回答。至于为啥还要用深度学习做底层的工作，可以这样认为，如果用深度学习做底层工作效果不错的话，应该可以对上层工作进行一些辅助，并且可以为上层工作的做法提供一些新的思路。</p></div><div class="article-content-more"><button type="button" class="article-more--link"><i class="fa fa-angle-double-down fa-3x" aria-hidden="true"></i></button></div></section></article><nav id="pagination--nav" class="text-center"><a class="extend prev" rel="prev" href="/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/3/">Next &raquo;</a></nav></main><div id="site-tool"><div class="scroll"><a href="#header"><i class="fa fa-arrow-up"></i></a> <a href="#footer"><i class="fa fa-arrow-down"></i></a></div><div></div></div><aside id="right-col" class="col-lg-3 col-sm-12"><div id="sidebar-sticky--bottom"></div><div id="sidebar"><header class="author-info div-border"><a href="/"><img class="header-avatar" src="/img/avatar.jpg"></a><h1 class="header-author"><a href="/" title="Hi Mate" data-toggle="tooltip">Shaun</a></h1><p class="header-slogan">求知！ 视界！ 未来！ ↖(^ω^)↗</p><div class="social-info"><a class="social-icon" target="_blank" href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&email=qNvAyd3G0d3JxujOx9DFycHEhsvHxQ" title="envelope" data-toggle="tooltip"><i class="fa fa-envelope" aria-hidden="true"></i> </a><a class="social-icon" target="_blank" href="https://github.com/cniter" title="github" data-toggle="tooltip"><i class="fa fa-github" aria-hidden="true"></i> </a><a class="social-icon" target="_blank" href="/atom.xml" title="rss" data-toggle="tooltip"><i class="fa fa-rss" aria-hidden="true"></i> </a><a class="social-icon" target="_blank" href="http://sighttp.qq.com/authd?IDKEY=4faf682653b3b7f5f47b9cb6d2bb8b81de8fa7a8fb8cee12" title="qq" data-toggle="tooltip"><i class="fa fa-qq" aria-hidden="true"></i></a></div></header><div class="search div-border" title="搜索" data-toggle="tooltip"><form id="search-form"><input type="text" id="local-search--input" name="q" results="0" placeholder=" Search..." autocomplete="off" autocorrect="off"> <i class="fa fa-times" onclick="resetSearch()"></i></form><div id="local-search--result"></div><p class="no-result">No results found</p></div><div id="tagcloud" class="tagcanvas div-border" title="标签" data-toggle="tooltip"><canvas width="200" height="200" id="tagcloud-canvas"><p>Anything in here will be replaced on browsers that support the canvas element</p><ul><li><a href="/tags/algorithm/" data-weight="6">algorithm</a></li><li><a href="/tags/android/" data-weight="2">android</a></li><li><a href="/tags/bigdata/" data-weight="2">bigdata</a></li><li><a href="/tags/c-cpp/" data-weight="6">c/cpp</a></li><li><a href="/tags/clustering/" data-weight="1">clustering</a></li><li><a href="/tags/container/" data-weight="1">container</a></li><li><a href="/tags/css/" data-weight="1">css</a></li><li><a href="/tags/cv/" data-weight="5">cv</a></li><li><a href="/tags/devtool/" data-weight="1">devtool</a></li><li><a href="/tags/ffmpeg/" data-weight="1">ffmpeg</a></li><li><a href="/tags/geomesa/" data-weight="1">geomesa</a></li><li><a href="/tags/geometry/" data-weight="3">geometry</a></li><li><a href="/tags/gfw/" data-weight="1">gfw</a></li><li><a href="/tags/git/" data-weight="0">git</a></li><li><a href="/tags/github/" data-weight="1">github</a></li><li><a href="/tags/gl/" data-weight="1">gl</a></li><li><a href="/tags/hexo/" data-weight="8">hexo</a></li><li><a href="/tags/integration/" data-weight="1">integration</a></li><li><a href="/tags/java/" data-weight="2">java</a></li><li><a href="/tags/latex/" data-weight="0">latex</a></li><li><a href="/tags/markdown/" data-weight="1">markdown</a></li><li><a href="/tags/matlab/" data-weight="2">matlab</a></li><li><a href="/tags/network/" data-weight="1">network</a></li><li><a href="/tags/note/" data-weight="5">note</a></li><li><a href="/tags/numerical/" data-weight="1">numerical</a></li><li><a href="/tags/opencv/" data-weight="11">opencv</a></li><li><a href="/tags/opendrive/" data-weight="1">opendrive</a></li><li><a href="/tags/opengl/" data-weight="1">opengl</a></li><li><a href="/tags/python/" data-weight="1">python</a></li><li><a href="/tags/qt/" data-weight="2">qt</a></li><li><a href="/tags/record/" data-weight="9">record</a></li><li><a href="/tags/search/" data-weight="1">search</a></li><li><a href="/tags/segmentation/" data-weight="2">segmentation</a></li><li><a href="/tags/tensorflow/" data-weight="1">tensorflow</a></li><li><a href="/tags/thought/" data-weight="3">thought</a></li><li><a href="/tags/unix-like/" data-weight="2">unix-like</a></li><li><a href="/tags/vscode/" data-weight="1">vscode</a></li></ul></canvas><script src="/plugins/TagCanvas/jquery.tagcanvas.min.js" type="text/javascript"></script><script type="text/javascript">$(document).ready(function(){$("#tagcloud-canvas").tagcanvas({initial:[.1,-.1],activeCursor:'url("/img/cursor/link.cur"), auto',reverse:!0,depth:.75,weight:!0,weightFrom:"data-weight",weightMode:"both",weightSizeMin:15,weightSizeMax:50})||$("#tagcloud").hide()})</script></div><div class="friends div-border" title="友链" data-toggle="tooltip"><a target="_blank" class="friends-link" href="https://cniter.github.io">Shaun&#39;s Space</a></div><div class="revolvermaps div-border" title="访客" data-toggle="tooltip"><script type="text/javascript" src="//rf.revolvermaps.com/0/0/8.js?i=50om5cdoa3h&amp;m=7&amp;c=ff0000&amp;cr1=ffffff&amp;f=arial&amp;l=49" defer></script></div></div><div class="toc-card"><div class="toc-card--head"><i class="fa fa-angle-up" aria-hidden="true"></i></div><div id="toc" class="toc-card--content"><strong class="toc-title">文章列表</strong><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/posts/9978824c.html">GeoMesa踩坑指北</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/3692cd6.html">IDEA使用Docker环境开发调试</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/af5e9ace.html">大数据环境搭建笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/ae780057.html">设计模式浅谈</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/eee1c041.html">积分计算</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/a5661762.html">Geometry增量更新</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/3d8ab974.html">Docker使用小结</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/6694a214.html">空间中三角形与三角形相交</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/5315fcfd.html">计算几何基础</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/b7d79231.html">OpenDrive解析小结</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/39a3c99e.html">一张纹理做天空盒</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/a250bb21.html">Windows Terminal 尝鲜小记</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/ae5f9dce.html">读大学</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/cf97ba7c.html">2019，既是结束又是开始</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/ff29de94.html">快速判断三角形与长方体相交</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/70a807da.html">网页菜单纯 css 实现</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/abe58f8c.html">个人游记</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/26d437be.html">hexo-theme-chi主题更新小记</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/3578e309.html">［译］为什么深度学习没有取代传统的计算机视觉</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/37b89a23.html">再也不见，18年</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/ac4679b5.html">hexo-theme-chi主题开发小记</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/64889158.html">Matlab和OpenCV混合编程小结</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/be7949e4.html">Android实践小结</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/fc1165b7.html">C++数组中的坑</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/cafdd60d.html">Android开发环境配置</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/27a4c8b6.html">Windows实用技巧</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/6315717b.html">FFmpeg提取与合并命令使用小结</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/fd823bf9.html">解决VSCode使用Cmder作为默认终端问题</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/fddd1e17.html">图割算法之NCuts浅见</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/c42ff8d4.html">图割算法之Graph Cuts浅见</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/b93d943b.html">C++中static用法小结</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/8fb9f004.html">斐波那契数列的三种写法</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/982ff584.html">搜索技巧</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/7cebf0ee.html">17年走了，18年来了</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/e124baa1.html">矩阵的应用之图像仿射变换</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/aef52be2.html">本人常用小工具安利</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/376168c6.html">解决无法打开某个网页问题</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/5f54aa2c.html">PyQt5使用小结</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/82d3b275.html">TensorFlow Object Detection API使用小结</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/2a3d46b0.html">C语言中整型提升问题</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/dece8eba.html">TXT数据转OpenCV中的Mat数据</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/e8b35736.html">OpenCV中滑动条和鼠标事件响应操作的使用小结</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/b6fb6109.html">利用回调函数计算函数运行时间</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/df943c4f.html">论如何科学的上网</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/b1e9411b.html">Hexo的SPFK主题修改小记</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/22c3daf1.html">解决Qt中Qlabel显示OpenCV的Mat数据图像产生扭曲现象问题</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/509ee93b.html">解决OpenCV-2.4.11调用摄像头显示拍摄视频出错问题</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/3bc0decc.html">Hexo添加各种小部件</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/fd0f8195.html">OpenCV中显著性检测算法的使用</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/35132cb7.html">OpenCV中Selective Search算法的使用</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/170c76cc.html">别了，漆黑的象牙塔</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/c3f26b1.html">Win10以树形结构显示文件目录结构</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/68065b99.html">ACGN作品个人印象简评</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/4f6225b7.html">Hexo添加站内本地搜索</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/302a6244.html">用OpenCV显示OpenGL图形</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/7df528b4.html">Win10＋VS2013＋CMake-gui编译和配置OpenCV-3.2.0</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/17017530.html">MyThoughts</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/7d5bc07b.html">解决写上篇文档“Hexo+GitHub搭建个人博客”遇到的问题</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/d7965b48.html">Hexo+GitHub搭建个人博客</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/4a17b156.html">Hello World</a></li></ul></div></div></aside></div></div><span id="cursor-trail"></span> <span class="click-halo"></span><footer id="footer" class="text-center"><div class="copyright-info">&copy; 2017 - 2021 <a href="/">Shaun</a></div><span class="site-visitor"><i class="fa fa-user-o" aria-hidden="true"></i> <span id="busuanzi_value_site_uv"><i class="fa fa-spinner fa-spin"></i></span> &nbsp;|&nbsp; <i class="fa fa-eye" aria-hidden="true"></i> <span id="busuanzi_value_site_pv"><i class="fa fa-spinner fa-spin"></i></span> &nbsp;|&nbsp; <i class="fa fa-hand-o-up" aria-hidden="true"></i> <span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span></span><div class="site-info"><a href="http://hexo.io/" target="_blank">Hexo </a>theme <a href="https://github.com/cniter/hexo-theme-chi" target="_blank">Chi </a>by <a href="https://github.com/cniter" target="_blank">Shaun</a></div></footer><script type="text/javascript" async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML" integrity="sha256-WUED7NFzpsmHtLO7bswSz4JSfkhE+cD4ncKeOznwFSY=" crossorigin="anonymous"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }

        , TeX: {
            extensions: ["extpfeil.js"]
        }
    });
    
    MathJax.Hub.Queue(function() {
        let all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';                 
        }       
    });</script><script type="text/javascript">// 监听搜索结果是否发生变化
    const MutationObserver = window.MutationObserver || window.WebKitMutationObserver || window.MozMutationObserver;  // Firefox和Chrome早期版本中带有前缀
    const config = { attributes: true, childList: true, characterData: true }; // 配置观察选项
    let target = document.querySelector('#local-search--result');
    let $local_search_result = $("#local-search--result");
    let $no_result = $(".no-result");
    let observer = new MutationObserver(function (mutations) {  // 创建观察者对象
        mutations.forEach(function (mutation) {
            // console.log(mutation.type);
            if (!$local_search_result.text() && $local_search_result.html() != '') {    // 无搜索结果
                $no_result.show(200);
            } else {
                $no_result.hide();
            }
        });
    });
    

    // 激活搜索框时才搜索
    let inputArea = document.querySelector("#local-search--input");
    let getSearchFile = function () {
        // 调用搜索函数
        let search_path = "search.xml";
        if (search_path.length == 0) {
            search_path = "search.xml";
        }
        let path = "/" + search_path;
        searchFunc(path, 'local-search--input', 'local-search--result');
        observer.observe(target, config);   // 传入目标节点和观察选项
    }
    inputArea.onfocus = function () { getSearchFile() }

    // 搜索重置
    let $resetButton = $("#search-form .fa-times");
    let $resultArea = $("#local-search--result");
    inputArea.oninput = function () { $resetButton.show(); }
    let resetSearch = function () {
        $resultArea.html("");
        document.querySelector("#search-form").reset();
        $resetButton.hide();
        $no_result.hide();
        observer.disconnect();  // 停止观察
    }

    // 屏蔽回车
    inputArea.onkeydown = function (event) { if (event.keyCode == 13) return false }

    // 搜索函数
    let searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                let datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                let $input = document.getElementById(search_id);
                let $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    let str = '<ul class=\"search-result--list\">';
                    let keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        let isMatch = true;
                        let content_index = [];
                        let data_title = data.title.trim().toLowerCase();
                        let data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        let data_url = data.url;
                        let index_title = -1;
                        let index_content = -1;
                        let first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title != '' && data_content != '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i == 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='/" + data_url + "' class='search-result--title' target='_blank'>" + "> " + data_title + "</a>";
                            let content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out characters
                                let start = first_occur - 6;
                                let end = first_occur + 6;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start == 0) {
                                    end = 10;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                let match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    let regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                })
                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                        }
                    })
                    $resultContent.innerHTML = str;
                })
            }
        })
    }</script><script type="module" src="/js/main.js"></script><script>$(document).ready(function() {
            $("del").attr("title","你知道的太多了ヾ(▼ﾍ▼；) (#｀皿´メ)");
            $('.toc-card').width($('#right-col').width());  // 使目录栏与右侧栏宽度一致            
            
            // 添加脚注提示
            $('a.footnote-ref').each(function (index, elem) {
                let post_id = $(this).parents('article').attr('id');
                let fn_href = $(this).attr('href');
                elem.setAttribute('data-toggle', 'tooltip');
                elem.setAttribute('data-html', 'true');
                elem.setAttribute('title', $("#" + post_id + " " + fn_href).html());
            });
        });
        $(window).on('load', function () {
            $('#sidebar-sticky--bottom').height($('#right-col').height() - $('#sidebar').height() - $('#footer').height());  // 完全填充#right-col高度
        });
        $(function () { $("[data-toggle='tooltip']").tooltip(); });</script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"Tia/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/Tia/Tia.model.json"},"display":{"position":"left","width":150,"height":300,"hOffset":0,"vOffset":-76},"mobile":{"show":false},"react":{"opacity":0.7},"log":false});</script></body></html>